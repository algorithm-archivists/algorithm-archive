
<!DOCTYPE HTML>
<html lang="" >
    <head>
        <meta charset="UTF-8">
        <title>Stable Marriage Problem Â· Arcane Algorithm Archive</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="HonKit 3.6.22">
        
        
        
    
    <link rel="stylesheet" href="../../gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-bibtex-cite/style.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-api-language-selector/api-language-selector.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-prism/prism-tomorrow.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-search/search.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
        <link rel="stylesheet" href="../../styles/website.css">
        
    
        
    
        
    
        
    
        
    
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../../gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="../../gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="../differential_equations/differential_equations.html" />
    
    
    <link rel="prev" href="../decision_problems/decision_problems.html" />
    

    </head>
    <body>
        
<div class="book honkit-cloak">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="Type to search" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        
    
        <li class="chapter " data-level="1.1" data-path="../../">
            
                <a href="../../">
            
                    
                    Algorithm Archive
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2" data-path="../introduction/introduction.html">
            
                <a href="../introduction/introduction.html">
            
                    
                    Introduction
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3" data-path="../how_to_contribute/how_to_contribute.html">
            
                <a href="../how_to_contribute/how_to_contribute.html">
            
                    
                    How To Contribute
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4" data-path="../plotting/plotting.html">
            
                <a href="../plotting/plotting.html">
            
                    
                    Plotting
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.4.1" data-path="../domain_coloring/domain_coloring.html">
            
                <a href="../domain_coloring/domain_coloring.html">
            
                    
                    Domain Coloring
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.2" data-path="../IFS/IFS.html">
            
                <a href="../IFS/IFS.html">
            
                    
                    Iterated Function Systems
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.4.2.1" data-path="../barnsley/barnsley.html">
            
                <a href="../barnsley/barnsley.html">
            
                    
                    The Barnsley Fern
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.5" data-path="../data_structures/data_structures.html">
            
                <a href="../data_structures/data_structures.html">
            
                    
                    Data Structures
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.5.1" data-path="../stacks_and_queues/stacks_and_queues.html">
            
                <a href="../stacks_and_queues/stacks_and_queues.html">
            
                    
                    Stacks and Queues
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.6" data-path="../mathematical_background/mathematical_background.html">
            
                <a href="../mathematical_background/mathematical_background.html">
            
                    
                    Mathematical Background
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.6.1" data-path="../notation/notation.html">
            
                <a href="../notation/notation.html">
            
                    
                    Complexity Notation
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.2" data-path="../affine_transformations/affine_transformations.html">
            
                <a href="../affine_transformations/affine_transformations.html">
            
                    
                    Affine Transformations
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.3" data-path="../bitlogic/bitlogic.html">
            
                <a href="../bitlogic/bitlogic.html">
            
                    
                    Bit Logic
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.4" data-path="../taylor_series_expansion/taylor_series_expansion.html">
            
                <a href="../taylor_series_expansion/taylor_series_expansion.html">
            
                    
                    Taylor Series
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.5" data-path="../convolutions/convolutions.html">
            
                <a href="../convolutions/convolutions.html">
            
                    
                    Convolutions
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.6.5.1" data-path="../convolutions/1d/1d.html">
            
                <a href="../convolutions/1d/1d.html">
            
                    
                    Convolutions in 1D
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.5.2" data-path="../convolutions/multiplication/multiplication.html">
            
                <a href="../convolutions/multiplication/multiplication.html">
            
                    
                    Multiplication as a Convolution
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.5.3" data-path="../convolutions/2d/2d.html">
            
                <a href="../convolutions/2d/2d.html">
            
                    
                    Convolutions of Images (2D)
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.5.4" data-path="../convolutions/convolutional_theorem/convolutional_theorem.html">
            
                <a href="../convolutions/convolutional_theorem/convolutional_theorem.html">
            
                    
                    Convolutional Theorem
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.7" data-path="../tree_traversal/tree_traversal.html">
            
                <a href="../tree_traversal/tree_traversal.html">
            
                    
                    Tree Traversal
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8" data-path="../euclidean_algorithm/euclidean_algorithm.html">
            
                <a href="../euclidean_algorithm/euclidean_algorithm.html">
            
                    
                    Euclidean Algorithm
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9" data-path="../monte_carlo_integration/monte_carlo_integration.html">
            
                <a href="../monte_carlo_integration/monte_carlo_integration.html">
            
                    
                    Monte Carlo
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10" data-path="../matrix_methods/matrix_methods.html">
            
                <a href="../matrix_methods/matrix_methods.html">
            
                    
                    Matrix Methods
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.10.1" data-path="../gaussian_elimination/gaussian_elimination.html">
            
                <a href="../gaussian_elimination/gaussian_elimination.html">
            
                    
                    Gaussian Elimination
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.2" data-path="../thomas_algorithm/thomas_algorithm.html">
            
                <a href="../thomas_algorithm/thomas_algorithm.html">
            
                    
                    Thomas Algorithm
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.11" data-path="../computational_geometry/computational_geometry.html">
            
                <a href="../computational_geometry/computational_geometry.html">
            
                    
                    Computational Geometry
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.11.1" data-path="../gift_wrapping/gift_wrapping.html">
            
                <a href="../gift_wrapping/gift_wrapping.html">
            
                    
                    Gift Wrapping
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.11.1.1" data-path="../jarvis_march/jarvis_march.html">
            
                <a href="../jarvis_march/jarvis_march.html">
            
                    
                    Jarvis March
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.11.1.2" data-path="../graham_scan/graham_scan.html">
            
                <a href="../graham_scan/graham_scan.html">
            
                    
                    Graham Scan
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.12" data-path="../cooley_tukey/cooley_tukey.html">
            
                <a href="../cooley_tukey/cooley_tukey.html">
            
                    
                    FFT
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.13" data-path="../decision_problems/decision_problems.html">
            
                <a href="../decision_problems/decision_problems.html">
            
                    
                    Decision Problems
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter active" data-level="1.13.1" data-path="stable_marriage_problem.html">
            
                <a href="stable_marriage_problem.html">
            
                    
                    Stable Marriage Problem
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.14" data-path="../differential_equations/differential_equations.html">
            
                <a href="../differential_equations/differential_equations.html">
            
                    
                    Differential Equation Solvers
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.14.1" data-path="../forward_euler_method/forward_euler_method.html">
            
                <a href="../forward_euler_method/forward_euler_method.html">
            
                    
                    Forward Euler Method
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.15" data-path="../physics_solvers/physics_solvers.html">
            
                <a href="../physics_solvers/physics_solvers.html">
            
                    
                    Physics Solvers
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.15.1" data-path="../verlet_integration/verlet_integration.html">
            
                <a href="../verlet_integration/verlet_integration.html">
            
                    
                    Verlet Integration
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.15.2" data-path="../quantum_systems/quantum_systems.html">
            
                <a href="../quantum_systems/quantum_systems.html">
            
                    
                    Quantum Systems
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.15.2.1" data-path="../split-operator_method/split-operator_method.html">
            
                <a href="../split-operator_method/split-operator_method.html">
            
                    
                    Split-Operator Method
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.16" data-path="../data_compression/data_compression.html">
            
                <a href="../data_compression/data_compression.html">
            
                    
                    Data Compression
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.16.1" data-path="../huffman_encoding/huffman_encoding.html">
            
                <a href="../huffman_encoding/huffman_encoding.html">
            
                    
                    Huffman Encoding
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.17" data-path="../computer_graphics/computer_graphics.html">
            
                <a href="../computer_graphics/computer_graphics.html">
            
                    
                    Computer Graphics
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.17.1" data-path="../flood_fill/flood_fill.html">
            
                <a href="../flood_fill/flood_fill.html">
            
                    
                    Flood Fill
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.18" data-path="../quantum_information/quantum_information.html">
            
                <a href="../quantum_information/quantum_information.html">
            
                    
                    Quantum Information
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.19" data-path="../computus/computus.html">
            
                <a href="../computus/computus.html">
            
                    
                    Computus
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.20" data-path="../approximate_counting/approximate_counting.html">
            
                <a href="../approximate_counting/approximate_counting.html">
            
                    
                    Approximate Counting Algorithm
            
                </a>
            

            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://github.com/honkit/honkit" target="blank" class="gitbook-link">
            Published with HonKit
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href="../.." >Stable Marriage Problem</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <h1 id="the-stable-marriage-problem">The Stable Marriage Problem</h1>
<p>Imagine you have two groups, each of size <script type="math/tex; ">n</script>.
Each individual within a group has an internal ranking associated with all members of the opposing group.
The <em>Stable Matching Problem</em> attempts to unite both groups into stable pairs.
In this case, a set of pairs is considered stable if there are no pairs that like each other more than their current partners.
This doesn&apos;t mean that everyone gets their top choices, but if an individual prefers someone else who also prefers them back, the set of pairs is not stable.</p>
<p>Now, this is often told as a story.
One group is male, the other is female, and everyone gets married, hence the name the <em>Stable Marriage Problem</em>.
This problem is solved by the Gale-Shapley algorithm, which can be simply described as follows:</p>
<ol>
<li>All the men propose to their top choice of women.</li>
<li>The women become tentatively engaged to their top choice of the men who have proposed to them.</li>
<li>All rejected men propose to their next choice, and the women again select whichever man they prefer, possibly rejecting the one they were already engaged to.</li>
</ol>
<p>This process continues until all individuals are paired, which means that this algorithm guarantees stable matching and also has a <script type="math/tex; ">\mathcal{O}(n^2)</script> runtime.
To be clear, even though this algorithm seems conceptually simple, it is rather tricky to implement correctly.
I do not at all claim that the code provided here is efficient and we will definitely be coming back to this problem in the future when we have more tools under our belt.
I am incredibly interested to see what you guys do and how you implement the algorithm.</p>
<h2 id="video-explanation">Video Explanation</h2>
<p>Here is a video describing the stable marriage problem:</p>
<div style="text-align:center">
<iframe width="560" height="315" src="https://www.youtube.com/embed/A7xRZQAQU8s" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
</div>

<h2 id="example-code">Example Code</h2>
<div class="code-method"><div class="code-method-definition"></div><div class="code-method-code"><div class="code-method-sample" data-lang="ruby" data-name="Ruby"><pre class="language-"><code class="lang-ruby"><span class="token keyword">class</span> <span class="token class-name">Person</span>
    <span class="token keyword">def</span> <span class="token method-definition"><span class="token function">initialize</span></span><span class="token punctuation">(</span>id<span class="token punctuation">,</span> name<span class="token punctuation">,</span> prefs<span class="token punctuation">)</span>
        <span class="token variable">@id</span>      <span class="token operator">=</span> id
        <span class="token variable">@name</span>    <span class="token operator">=</span> name
        <span class="token variable">@prefs</span>   <span class="token operator">=</span> prefs
        <span class="token variable">@partner</span> <span class="token operator">=</span> <span class="token keyword">nil</span>
        <span class="token variable">@choices</span> <span class="token operator">=</span> <span class="token number">0</span>
    <span class="token keyword">end</span>

    <span class="token keyword">def</span> <span class="token method-definition"><span class="token function">lonely</span></span><span class="token operator">?</span>
        <span class="token variable">@partner</span><span class="token punctuation">.</span><span class="token keyword">nil</span><span class="token operator">?</span>
    <span class="token keyword">end</span>

    <span class="token keyword">def</span> <span class="token method-definition"><span class="token function">propose</span></span><span class="token punctuation">(</span>partners<span class="token punctuation">)</span>
        <span class="token keyword">unless</span> <span class="token keyword">self</span><span class="token punctuation">.</span>lonely<span class="token operator">?</span>
            <span class="token keyword">raise</span> <span class="token string">&apos;%s is not lonely!&apos;</span> <span class="token operator">%</span> <span class="token keyword">self</span><span class="token punctuation">.</span>name
        <span class="token keyword">end</span>
        choice <span class="token operator">=</span> <span class="token variable">@prefs</span><span class="token punctuation">[</span><span class="token variable">@choices</span><span class="token punctuation">]</span>
        partners<span class="token punctuation">[</span>choice<span class="token punctuation">]</span><span class="token punctuation">.</span>onPropose<span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">)</span>
        <span class="token variable">@choices</span> <span class="token operator">+</span><span class="token operator">=</span> <span class="token number">1</span>
    <span class="token keyword">end</span>

    <span class="token keyword">def</span> <span class="token method-definition"><span class="token function">to_s</span></span>
      <span class="token string">&quot;<span class="token interpolation"><span class="token delimiter tag">#{</span><span class="token variable">@name</span><span class="token punctuation">.</span>rjust<span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token delimiter tag">}</span></span>: <span class="token interpolation"><span class="token delimiter tag">#{</span><span class="token keyword">self</span><span class="token punctuation">.</span>lonely<span class="token operator">?</span> <span class="token operator">&amp;&amp;</span> <span class="token string">&quot;Lonely&quot;</span> <span class="token operator">||</span> <span class="token variable">@partner</span><span class="token punctuation">.</span>name<span class="token delimiter tag">}</span></span>&quot;</span>
    <span class="token keyword">end</span>

    <span class="token keyword">def</span> <span class="token method-definition"><span class="token keyword">self</span><span class="token punctuation">.</span><span class="token function">generate</span></span><span class="token punctuation">(</span>size<span class="token punctuation">,</span> prefix<span class="token punctuation">,</span> r<span class="token punctuation">)</span>
        <span class="token builtin">Array</span><span class="token punctuation">.</span><span class="token keyword">new</span><span class="token punctuation">(</span>size<span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token operator">|</span>i<span class="token operator">|</span>
            <span class="token constant">Person</span><span class="token punctuation">.</span><span class="token keyword">new</span><span class="token punctuation">(</span>
                i<span class="token punctuation">,</span>
                <span class="token string">&quot;<span class="token interpolation"><span class="token delimiter tag">#{</span>prefix<span class="token delimiter tag">}</span></span> <span class="token interpolation"><span class="token delimiter tag">#{</span>i<span class="token delimiter tag">}</span></span>&quot;</span><span class="token punctuation">,</span>
                <span class="token punctuation">(</span><span class="token number">0</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> size<span class="token punctuation">)</span><span class="token punctuation">.</span>to_a<span class="token punctuation">.</span>shuffle<span class="token punctuation">(</span>random<span class="token punctuation">:</span> r<span class="token punctuation">)</span>
            <span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token keyword">end</span>

    <span class="token keyword">protected</span>
    attr_reader <span class="token symbol">:id</span><span class="token punctuation">,</span> <span class="token symbol">:name</span>
    attr_writer <span class="token symbol">:partner</span>

    <span class="token comment"># Acts upon a given Proposal</span>
    <span class="token keyword">def</span> <span class="token method-definition"><span class="token function">onPropose</span></span><span class="token punctuation">(</span>partner<span class="token punctuation">)</span>
        <span class="token keyword">unless</span> <span class="token keyword">self</span><span class="token punctuation">.</span>lonely<span class="token operator">?</span>
            offer <span class="token operator">=</span> score<span class="token punctuation">(</span>partner<span class="token punctuation">)</span>
            current <span class="token operator">=</span> score<span class="token punctuation">(</span><span class="token variable">@partner</span><span class="token punctuation">)</span>
            <span class="token keyword">return</span> <span class="token keyword">unless</span> offer <span class="token operator">&gt;</span> current 
            <span class="token variable">@partner</span><span class="token punctuation">.</span>partner <span class="token operator">=</span> <span class="token keyword">nil</span>
        <span class="token keyword">end</span>
        <span class="token variable">@partner</span> <span class="token operator">=</span> partner
        partner<span class="token punctuation">.</span>partner <span class="token operator">=</span> <span class="token keyword">self</span>
    <span class="token keyword">end</span>

    <span class="token keyword">private</span>
    <span class="token comment"># Determines the preference of a given partner</span>
    <span class="token keyword">def</span> <span class="token method-definition"><span class="token function">score</span></span><span class="token punctuation">(</span>partner<span class="token punctuation">)</span>
        <span class="token keyword">return</span> <span class="token number">0</span> <span class="token keyword">if</span> partner<span class="token punctuation">.</span><span class="token keyword">nil</span><span class="token operator">?</span>
        <span class="token variable">@prefs</span><span class="token punctuation">.</span>size <span class="token operator">-</span> <span class="token variable">@prefs</span><span class="token punctuation">.</span>index<span class="token punctuation">(</span>partner<span class="token punctuation">.</span>id<span class="token punctuation">)</span>
    <span class="token keyword">end</span>
<span class="token keyword">end</span>

<span class="token comment"># Deterministic Output, feel free to change seed</span>
r <span class="token operator">=</span> <span class="token constant">Random</span><span class="token punctuation">.</span><span class="token keyword">new</span><span class="token punctuation">(</span><span class="token number">42</span><span class="token punctuation">)</span>

<span class="token comment"># Determines Output Columns</span>
men <span class="token operator">=</span> <span class="token constant">Person</span><span class="token punctuation">.</span>generate<span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token string">&quot;Man&quot;</span><span class="token punctuation">,</span> r<span class="token punctuation">)</span>
women <span class="token operator">=</span> <span class="token constant">Person</span><span class="token punctuation">.</span>generate<span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token string">&quot;Woman&quot;</span><span class="token punctuation">,</span> r<span class="token punctuation">)</span>

<span class="token comment"># Assume no Name is longer than 20 characters</span>
spacer <span class="token operator">=</span> <span class="token string">&apos;-&apos;</span> <span class="token operator">*</span> <span class="token punctuation">(</span><span class="token number">20</span> <span class="token operator">*</span> <span class="token number">2</span> <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">)</span>

<span class="token comment"># Solve the Problem</span>
<span class="token number">1.</span>step <span class="token keyword">do</span> <span class="token operator">|</span>round<span class="token operator">|</span>
    singles <span class="token operator">=</span> men<span class="token punctuation">.</span>select<span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token symbol">:lonely?</span><span class="token punctuation">)</span>
    singles<span class="token punctuation">.</span><span class="token keyword">each</span> <span class="token keyword">do</span> <span class="token operator">|</span>m<span class="token operator">|</span>
        m<span class="token punctuation">.</span>propose<span class="token punctuation">(</span>women<span class="token punctuation">)</span>
    <span class="token keyword">end</span>

    <span class="token keyword">break</span> <span class="token keyword">if</span> singles<span class="token punctuation">.</span>empty<span class="token operator">?</span>

    puts <span class="token string">&quot;Round <span class="token interpolation"><span class="token delimiter tag">#{</span>round<span class="token delimiter tag">}</span></span>&quot;</span>
    puts spacer
    puts men<span class="token punctuation">,</span> women
    puts spacer
<span class="token keyword">end</span>
</code></pre>
</div><div class="code-method-sample" data-lang="jl" data-name="Julia"><pre class="language-"><code class="lang-julia"><span class="token keyword">using</span> Random

<span class="token keyword">const</span> mnames <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">&quot;A&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;B&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;C&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;D&quot;</span><span class="token punctuation">]</span>
<span class="token keyword">const</span> wnames <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">&quot;E&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;F&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;G&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;H&quot;</span><span class="token punctuation">]</span>

<span class="token keyword">const</span> Preferences <span class="token operator">=</span> Dict<span class="token punctuation">{</span>String<span class="token punctuation">,</span>Vector<span class="token punctuation">{</span>String<span class="token punctuation">}</span><span class="token punctuation">}</span>
<span class="token keyword">const</span> Pairs <span class="token operator">=</span> Dict<span class="token punctuation">{</span>String<span class="token punctuation">,</span>String<span class="token punctuation">}</span>

<span class="token comment"># Returns a name =&gt; preference list dictionary, in decreasing order of preference</span>
<span class="token keyword">function</span> genpreferences<span class="token punctuation">(</span>mannames<span class="token punctuation">::</span>Vector<span class="token punctuation">{</span>String<span class="token punctuation">}</span><span class="token punctuation">,</span> womannames<span class="token punctuation">::</span>Vector<span class="token punctuation">{</span>String<span class="token punctuation">}</span><span class="token punctuation">)</span>
    men   <span class="token operator">=</span> Dict<span class="token punctuation">(</span>map<span class="token punctuation">(</span>m <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token punctuation">(</span>m<span class="token punctuation">,</span> shuffle<span class="token punctuation">(</span>womannames<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> mannames<span class="token punctuation">)</span><span class="token punctuation">)</span>
    women <span class="token operator">=</span> Dict<span class="token punctuation">(</span>map<span class="token punctuation">(</span>w <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token punctuation">(</span>w<span class="token punctuation">,</span> shuffle<span class="token punctuation">(</span>mannames<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> womannames<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> men<span class="token punctuation">,</span> women
<span class="token keyword">end</span>

<span class="token comment"># Returns if `person` prefers the `first` candidate over the `second` one.</span>
<span class="token comment"># This translates to `first` appearing *sooner* in the preference list</span>
prefers<span class="token punctuation">(</span>prefs<span class="token punctuation">,</span> person<span class="token punctuation">,</span> first<span class="token punctuation">,</span> second<span class="token punctuation">)</span> <span class="token operator">=</span>
    findfirst<span class="token punctuation">(</span>m <span class="token operator">-</span><span class="token operator">&gt;</span> m <span class="token operator">==</span> first<span class="token punctuation">,</span> prefs<span class="token punctuation">[</span>person<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span>
    findfirst<span class="token punctuation">(</span>m <span class="token operator">-</span><span class="token operator">&gt;</span> m <span class="token operator">==</span> second<span class="token punctuation">,</span> prefs<span class="token punctuation">[</span>person<span class="token punctuation">]</span><span class="token punctuation">)</span>

isfree<span class="token punctuation">(</span>person<span class="token punctuation">,</span> pairs<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token operator">!</span>haskey<span class="token punctuation">(</span>pairs<span class="token punctuation">,</span> person<span class="token punctuation">)</span>

<span class="token keyword">function</span> galeshapley<span class="token punctuation">(</span>men<span class="token punctuation">::</span>Preferences<span class="token punctuation">,</span> women<span class="token punctuation">::</span>Preferences<span class="token punctuation">)</span>
    mentowomen <span class="token operator">=</span> Dict<span class="token punctuation">{</span>String<span class="token punctuation">,</span>String<span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    womentomen <span class="token operator">=</span> Dict<span class="token punctuation">{</span>String<span class="token punctuation">,</span>String<span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">while</span> <span class="token boolean">true</span>
        bachelors <span class="token operator">=</span> <span class="token punctuation">[</span>m <span class="token keyword">for</span> m <span class="token keyword">in</span> keys<span class="token punctuation">(</span>men<span class="token punctuation">)</span> <span class="token keyword">if</span> isfree<span class="token punctuation">(</span>m<span class="token punctuation">,</span> mentowomen<span class="token punctuation">)</span><span class="token punctuation">]</span>
        <span class="token keyword">if</span> length<span class="token punctuation">(</span>bachelors<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span>
            <span class="token keyword">return</span> mentowomen<span class="token punctuation">,</span> womentomen
        <span class="token keyword">end</span>

        <span class="token keyword">for</span> bachelor <span class="token keyword">in</span> bachelors
            <span class="token keyword">for</span> candidate <span class="token keyword">in</span> men<span class="token punctuation">[</span>bachelor<span class="token punctuation">]</span>
                <span class="token keyword">if</span> isfree<span class="token punctuation">(</span>candidate<span class="token punctuation">,</span> womentomen<span class="token punctuation">)</span>
                    mentowomen<span class="token punctuation">[</span>bachelor<span class="token punctuation">]</span> <span class="token operator">=</span> candidate
                    womentomen<span class="token punctuation">[</span>candidate<span class="token punctuation">]</span> <span class="token operator">=</span> bachelor
                    <span class="token keyword">break</span>
                <span class="token keyword">elseif</span> prefers<span class="token punctuation">(</span>women<span class="token punctuation">,</span> candidate<span class="token punctuation">,</span> bachelor<span class="token punctuation">,</span> womentomen<span class="token punctuation">[</span>candidate<span class="token punctuation">]</span><span class="token punctuation">)</span>
                    delete<span class="token operator">!</span><span class="token punctuation">(</span>mentowomen<span class="token punctuation">,</span> womentomen<span class="token punctuation">[</span>candidate<span class="token punctuation">]</span><span class="token punctuation">)</span>
                    mentowomen<span class="token punctuation">[</span>bachelor<span class="token punctuation">]</span> <span class="token operator">=</span> candidate
                    womentomen<span class="token punctuation">[</span>candidate<span class="token punctuation">]</span> <span class="token operator">=</span> bachelor
                    <span class="token keyword">break</span>
                <span class="token keyword">end</span>
            <span class="token keyword">end</span>
        <span class="token keyword">end</span>
    <span class="token keyword">end</span>
<span class="token keyword">end</span>

<span class="token keyword">function</span> isstable<span class="token punctuation">(</span>men<span class="token punctuation">::</span>Preferences<span class="token punctuation">,</span> women<span class="token punctuation">::</span>Preferences<span class="token punctuation">,</span> mentowomen<span class="token punctuation">::</span>Pairs<span class="token punctuation">,</span> womentoman<span class="token punctuation">::</span>Pairs<span class="token punctuation">)</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span>husband<span class="token punctuation">,</span> wife<span class="token punctuation">)</span> <span class="token keyword">in</span> mentowomen
        <span class="token keyword">for</span> candidate <span class="token keyword">in</span> men<span class="token punctuation">[</span>husband<span class="token punctuation">]</span>
            <span class="token keyword">if</span> candidate <span class="token operator">!=</span> wife <span class="token operator">&amp;&amp;</span>
               prefers<span class="token punctuation">(</span>men<span class="token punctuation">,</span> husband<span class="token punctuation">,</span> candidate<span class="token punctuation">,</span> wife<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span>
               prefers<span class="token punctuation">(</span>women<span class="token punctuation">,</span> candidate<span class="token punctuation">,</span> husband<span class="token punctuation">,</span> womentoman<span class="token punctuation">[</span>candidate<span class="token punctuation">]</span><span class="token punctuation">)</span>
                <span class="token keyword">return</span> <span class="token boolean">false</span>
            <span class="token keyword">end</span>
        <span class="token keyword">end</span>
    <span class="token keyword">end</span>
    <span class="token keyword">return</span> <span class="token boolean">true</span>
<span class="token keyword">end</span>

<span class="token keyword">function</span> main<span class="token punctuation">(</span><span class="token punctuation">)</span>
    men<span class="token punctuation">,</span> women <span class="token operator">=</span> genpreferences<span class="token punctuation">(</span>mnames<span class="token punctuation">,</span> wnames<span class="token punctuation">)</span>
    mentowomen<span class="token punctuation">,</span> womentomen <span class="token operator">=</span> galeshapley<span class="token punctuation">(</span>men<span class="token punctuation">,</span> women<span class="token punctuation">)</span>
    <span class="token keyword">println</span><span class="token punctuation">(</span>mentowomen<span class="token punctuation">)</span>
    <span class="token keyword">println</span><span class="token punctuation">(</span>isstable<span class="token punctuation">(</span>men<span class="token punctuation">,</span> women<span class="token punctuation">,</span> mentowomen<span class="token punctuation">,</span> womentomen<span class="token punctuation">)</span> <span class="token punctuation">?</span> <span class="token string">&quot;Stable&quot;</span> <span class="token punctuation">:</span> <span class="token string">&quot;Unstable&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">end</span>

main<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre>
</div><div class="code-method-sample" data-lang="py" data-name="Python"><pre class="language-"><code class="lang-python"><span class="token comment"># Submitted by Marius Becker</span>
<span class="token comment"># Updated by Amaras</span>


<span class="token keyword">from</span> random <span class="token keyword">import</span> shuffle
<span class="token keyword">from</span> copy <span class="token keyword">import</span> copy
<span class="token keyword">from</span> string <span class="token keyword">import</span> ascii_uppercase<span class="token punctuation">,</span> ascii_lowercase


<span class="token keyword">def</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># Set this to however many men and women you want, up to 26</span>
    num_pairs <span class="token operator">=</span> <span class="token number">5</span>

    <span class="token comment"># Create all Person objects</span>
    men <span class="token operator">=</span> <span class="token punctuation">[</span>Person<span class="token punctuation">(</span>name<span class="token punctuation">)</span> <span class="token keyword">for</span> name <span class="token keyword">in</span> ascii_uppercase<span class="token punctuation">[</span><span class="token punctuation">:</span>num_pairs<span class="token punctuation">]</span><span class="token punctuation">]</span>
    women <span class="token operator">=</span> <span class="token punctuation">[</span>Person<span class="token punctuation">(</span>name<span class="token punctuation">)</span> <span class="token keyword">for</span> name <span class="token keyword">in</span> ascii_lowercase<span class="token punctuation">[</span><span class="token punctuation">:</span>num_pairs<span class="token punctuation">]</span><span class="token punctuation">]</span>

    <span class="token comment"># Set everyone&apos;s preferences</span>
    <span class="token keyword">for</span> man <span class="token keyword">in</span> men<span class="token punctuation">:</span>
        man<span class="token punctuation">.</span>preference <span class="token operator">=</span> copy<span class="token punctuation">(</span>women<span class="token punctuation">)</span>
        shuffle<span class="token punctuation">(</span>man<span class="token punctuation">.</span>preference<span class="token punctuation">)</span>

    <span class="token keyword">for</span> woman <span class="token keyword">in</span> women<span class="token punctuation">:</span>
        woman<span class="token punctuation">.</span>preference <span class="token operator">=</span> copy<span class="token punctuation">(</span>men<span class="token punctuation">)</span>
        shuffle<span class="token punctuation">(</span>woman<span class="token punctuation">.</span>preference<span class="token punctuation">)</span>

    <span class="token comment"># Run the algorithm</span>
    stable_marriage<span class="token punctuation">(</span>men<span class="token punctuation">,</span> women<span class="token punctuation">)</span>

    <span class="token comment"># Print preferences and the result</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&apos;Preferences of the men:&apos;</span><span class="token punctuation">)</span>
    <span class="token keyword">for</span> man <span class="token keyword">in</span> men<span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span>man<span class="token punctuation">)</span>

    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&apos;Preferences of the women:&apos;</span><span class="token punctuation">)</span>
    <span class="token keyword">for</span> woman <span class="token keyword">in</span> women<span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span>woman<span class="token punctuation">)</span>

    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&apos;\n&apos;</span><span class="token punctuation">)</span>

    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&apos;The algorithm gave this solution:&apos;</span><span class="token punctuation">)</span>
    <span class="token keyword">for</span> man <span class="token keyword">in</span> men<span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&apos;</span><span class="token interpolation"><span class="token punctuation">{</span>man<span class="token punctuation">.</span>name<span class="token punctuation">}</span></span><span class="token string"> + </span><span class="token interpolation"><span class="token punctuation">{</span>man<span class="token punctuation">.</span>partner<span class="token punctuation">.</span>name<span class="token punctuation">}</span></span><span class="token string">&apos;</span></span><span class="token punctuation">)</span>


<span class="token keyword">def</span> <span class="token function">stable_marriage</span><span class="token punctuation">(</span>men<span class="token punctuation">,</span> women<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">&quot;&quot;&quot;Finds pairs with stable marriages&quot;&quot;&quot;</span>

    <span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>
        <span class="token comment"># Let every man without a partner propose to a woman</span>
        <span class="token keyword">for</span> man <span class="token keyword">in</span> men<span class="token punctuation">:</span>
            <span class="token keyword">if</span> <span class="token keyword">not</span> man<span class="token punctuation">.</span>has_partner<span class="token punctuation">:</span>
                man<span class="token punctuation">.</span>propose_to_next<span class="token punctuation">(</span><span class="token punctuation">)</span>

        <span class="token comment"># Let the women pick their favorites</span>
        <span class="token keyword">for</span> woman <span class="token keyword">in</span> women<span class="token punctuation">:</span>
            woman<span class="token punctuation">.</span>pick_preferred<span class="token punctuation">(</span><span class="token punctuation">)</span>

        <span class="token comment"># Continue only when someone is still left without a partner</span>
        <span class="token keyword">if</span> <span class="token builtin">all</span><span class="token punctuation">(</span><span class="token punctuation">(</span>man<span class="token punctuation">.</span>has_partner <span class="token keyword">for</span> man <span class="token keyword">in</span> men<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span>


<span class="token keyword">class</span> <span class="token class-name">Person</span><span class="token punctuation">:</span>

    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> name<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>name <span class="token operator">=</span> name
        self<span class="token punctuation">.</span>preference <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        self<span class="token punctuation">.</span>candidates <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        self<span class="token punctuation">.</span>pref_index <span class="token operator">=</span> <span class="token number">0</span>
        self<span class="token punctuation">.</span>_partner <span class="token operator">=</span> <span class="token boolean">None</span>

    <span class="token decorator annotation punctuation">@property</span>
    <span class="token keyword">def</span> <span class="token function">next_choice</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">&quot;&quot;&quot;Return the next person in the own preference list&quot;&quot;&quot;</span>
        <span class="token keyword">try</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span> self<span class="token punctuation">.</span>preference<span class="token punctuation">[</span>self<span class="token punctuation">.</span>pref_index<span class="token punctuation">]</span>
        <span class="token keyword">except</span> IndexError<span class="token punctuation">:</span>
            <span class="token keyword">return</span> <span class="token boolean">None</span>

    <span class="token keyword">def</span> <span class="token function">propose_to_next</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">&quot;&quot;&quot;Propose to the next person in the own preference list&quot;&quot;&quot;</span>
        person <span class="token operator">=</span> self<span class="token punctuation">.</span>next_choice
        person<span class="token punctuation">.</span>candidates<span class="token punctuation">.</span>append<span class="token punctuation">(</span>self<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>pref_index <span class="token operator">+=</span> <span class="token number">1</span>

    <span class="token keyword">def</span> <span class="token function">pick_preferred</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">&quot;&quot;&quot;Pick a new partner or stay with the old one if they are preferred&quot;&quot;&quot;</span>
        <span class="token comment"># Iterate own preferences in order</span>
        <span class="token keyword">for</span> person <span class="token keyword">in</span> self<span class="token punctuation">.</span>preference<span class="token punctuation">:</span>
            <span class="token comment"># Pick the first person that&apos;s either a new candidate or the</span>
            <span class="token comment"># current partner</span>
            <span class="token keyword">if</span> person <span class="token operator">==</span> self<span class="token punctuation">.</span>partner<span class="token punctuation">:</span>
                <span class="token keyword">break</span>
            <span class="token keyword">elif</span> person <span class="token keyword">in</span> self<span class="token punctuation">.</span>candidates<span class="token punctuation">:</span>
                self<span class="token punctuation">.</span>partner <span class="token operator">=</span> person
                <span class="token keyword">break</span>

        <span class="token comment"># Rejected candidates don&apos;t get a second chance</span>
        self<span class="token punctuation">.</span>candidates<span class="token punctuation">.</span>clear<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token decorator annotation punctuation">@property</span>
    <span class="token keyword">def</span> <span class="token function">partner</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> self<span class="token punctuation">.</span>_partner

    <span class="token comment"># The call self.partner = person sets self._partner as person</span>
    <span class="token comment"># However, since engagement is symmetrical, self._partner._partner</span>
    <span class="token comment"># (which is then person._partner) also needs to be set to self</span>
    <span class="token decorator annotation punctuation">@partner<span class="token punctuation">.</span>setter</span>
    <span class="token keyword">def</span> <span class="token function">partner</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> person<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">&quot;&quot;&quot;Set a person as the new partner and sets the partner of that
        person as well&quot;&quot;&quot;</span>

        <span class="token comment"># Do nothing if nothing would change</span>
        <span class="token keyword">if</span> person <span class="token operator">!=</span> self<span class="token punctuation">.</span>_partner<span class="token punctuation">:</span>
            <span class="token comment"># Remove self from current partner</span>
            <span class="token keyword">if</span> self<span class="token punctuation">.</span>_partner <span class="token keyword">is</span> <span class="token keyword">not</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
                self<span class="token punctuation">.</span>_partner<span class="token punctuation">.</span>_partner <span class="token operator">=</span> <span class="token boolean">None</span>

            <span class="token comment"># Set own and the other person&apos;s partner</span>
            self<span class="token punctuation">.</span>_partner <span class="token operator">=</span> person
            <span class="token keyword">if</span> self<span class="token punctuation">.</span>_partner <span class="token keyword">is</span> <span class="token keyword">not</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
                self<span class="token punctuation">.</span>_partner<span class="token punctuation">.</span>_partner <span class="token operator">=</span> self

    <span class="token comment"># This allows use of self.has_partner instead of self.has_partner()</span>
    <span class="token decorator annotation punctuation">@property</span>
    <span class="token keyword">def</span> <span class="token function">has_partner</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">&quot;&quot;&quot;Determine whether this person currently has a partner or not.&quot;&quot;&quot;</span>
        <span class="token keyword">return</span> self<span class="token punctuation">.</span>partner <span class="token keyword">is</span> <span class="token keyword">not</span> <span class="token boolean">None</span>

    <span class="token comment"># This allows the preferences to be printed more elegantly</span>
    <span class="token keyword">def</span> <span class="token function">__str__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token string-interpolation"><span class="token string">f&apos;</span><span class="token interpolation"><span class="token punctuation">{</span>self<span class="token punctuation">.</span>name<span class="token punctuation">}</span></span><span class="token string">: </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token string">&quot;, &quot;</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span>p<span class="token punctuation">.</span>name <span class="token keyword">for</span> p <span class="token keyword">in</span> self<span class="token punctuation">.</span>preference<span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string">&apos;</span></span>


<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">&apos;__main__&apos;</span><span class="token punctuation">:</span>
    main<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre>
</div><div class="code-method-sample" data-lang="hs" data-name="Haskell"><pre class="language-"><code class="lang-haskell"><span class="token import-statement"><span class="token keyword">import</span>           Data<span class="token punctuation">.</span>Map <span class="token keyword">as</span> M</span> <span class="token punctuation">(</span><span class="token constant">Map</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token import-statement"><span class="token keyword">import</span> <span class="token keyword">qualified</span> Data<span class="token punctuation">.</span>Map <span class="token keyword">as</span> M</span>
<span class="token import-statement"><span class="token keyword">import</span>           Data<span class="token punctuation">.</span>List</span> <span class="token punctuation">(</span><span class="token hvariable">elemIndex</span><span class="token punctuation">)</span>
<span class="token import-statement"><span class="token keyword">import</span>           Control<span class="token punctuation">.</span>Monad<span class="token punctuation">.</span>State</span>

<span class="token hvariable">stableMatching</span> <span class="token operator">::</span> <span class="token punctuation">(</span><span class="token constant">Ord</span> <span class="token hvariable">a</span><span class="token punctuation">,</span> <span class="token constant">Ord</span> <span class="token hvariable">b</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token hvariable">a</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token hvariable">b</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token operator">-&gt;</span> <span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token hvariable">b</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token hvariable">a</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token operator">-&gt;</span> <span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token hvariable">a</span><span class="token punctuation">,</span> <span class="token hvariable">b</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
<span class="token hvariable">stableMatching</span> <span class="token hvariable">men</span> <span class="token hvariable">women</span> <span class="token operator">=</span> <span class="token hvariable">evalState</span> <span class="token punctuation">(</span><span class="token hvariable">propose</span> <span class="token punctuation">(</span><span class="token hvariable">M<span class="token punctuation">.</span>fromList</span> <span class="token hvariable">women</span><span class="token punctuation">)</span> <span class="token hvariable">men</span><span class="token punctuation">)</span> <span class="token hvariable">M<span class="token punctuation">.</span>empty</span>

<span class="token hvariable">propose</span> <span class="token operator">::</span> <span class="token punctuation">(</span><span class="token constant">Ord</span> <span class="token hvariable">a</span><span class="token punctuation">,</span> <span class="token constant">Ord</span> <span class="token hvariable">b</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token constant">Map</span> <span class="token hvariable">b</span> <span class="token punctuation">[</span><span class="token hvariable">a</span><span class="token punctuation">]</span> <span class="token operator">-&gt;</span>
                            <span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token hvariable">a</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token hvariable">b</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token operator">-&gt;</span>
                            <span class="token constant">State</span> <span class="token punctuation">(</span><span class="token constant">Map</span> <span class="token hvariable">b</span> <span class="token punctuation">(</span><span class="token hvariable">a</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token hvariable">b</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token hvariable">a</span><span class="token punctuation">,</span> <span class="token hvariable">b</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
<span class="token hvariable">propose</span> <span class="token hvariable">_</span> <span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token hvariable">get</span> <span class="token operator">&gt;&gt;=</span>  <span class="token builtin">return</span> <span class="token operator">.</span> <span class="token builtin">map</span> <span class="token punctuation">(</span><span class="token operator">\</span><span class="token punctuation">(</span><span class="token hvariable">w</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token hvariable">m</span><span class="token punctuation">,</span><span class="token hvariable">_</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">(</span><span class="token hvariable">m</span><span class="token punctuation">,</span> <span class="token hvariable">w</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">.</span> <span class="token hvariable">M<span class="token punctuation">.</span>assocs</span>
<span class="token hvariable">propose</span> <span class="token hvariable">women</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token hvariable">man</span><span class="token punctuation">,</span> <span class="token hvariable">pref</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token hvariable">bachelors</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token keyword">do</span>
  <span class="token keyword">let</span> <span class="token hvariable">theOne</span> <span class="token operator">=</span> <span class="token builtin">head</span> <span class="token hvariable">pref</span>
  <span class="token hvariable">couples</span> <span class="token operator">&lt;-</span> <span class="token hvariable">get</span>
  <span class="token keyword">case</span> <span class="token constant">M</span><span class="token punctuation">.</span><span class="token builtin">lookup</span> <span class="token hvariable">theOne</span> <span class="token hvariable">couples</span> <span class="token keyword">of</span>
    <span class="token constant">Nothing</span> <span class="token operator">-&gt;</span> <span class="token keyword">do</span>
      <span class="token hvariable">modify</span> <span class="token operator">$</span> <span class="token hvariable">M<span class="token punctuation">.</span>insert</span> <span class="token hvariable">theOne</span> <span class="token punctuation">(</span><span class="token hvariable">man</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token builtin">tail</span> <span class="token hvariable">pref</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
      <span class="token hvariable">propose</span> <span class="token hvariable">women</span> <span class="token hvariable">bachelors</span>
    <span class="token constant">Just</span> <span class="token punctuation">(</span><span class="token hvariable">boyfriend</span><span class="token punctuation">,</span> <span class="token hvariable">planB</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token keyword">do</span>
      <span class="token keyword">let</span> <span class="token hvariable">rank</span> <span class="token hvariable">x</span> <span class="token operator">=</span> <span class="token hvariable">elemIndex</span> <span class="token hvariable">x</span> <span class="token punctuation">(</span><span class="token hvariable">women</span><span class="token operator">!</span><span class="token hvariable">theOne</span><span class="token punctuation">)</span>
      <span class="token keyword">if</span> <span class="token hvariable">rank</span> <span class="token hvariable">boyfriend</span> <span class="token operator">&lt;</span> <span class="token hvariable">rank</span> <span class="token hvariable">man</span>
        <span class="token keyword">then</span> <span class="token hvariable">propose</span> <span class="token hvariable">women</span> <span class="token operator">$</span> <span class="token punctuation">(</span><span class="token hvariable">man</span><span class="token punctuation">,</span> <span class="token builtin">tail</span> <span class="token hvariable">pref</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token hvariable">bachelors</span>
        <span class="token keyword">else</span> <span class="token keyword">do</span>
          <span class="token hvariable">modify</span> <span class="token operator">$</span> <span class="token hvariable">M<span class="token punctuation">.</span>insert</span> <span class="token hvariable">theOne</span> <span class="token punctuation">(</span><span class="token hvariable">man</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token builtin">tail</span> <span class="token hvariable">pref</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">.</span> <span class="token hvariable">M<span class="token punctuation">.</span>delete</span> <span class="token hvariable">theOne</span>
          <span class="token hvariable">propose</span> <span class="token hvariable">women</span> <span class="token operator">$</span> <span class="token punctuation">(</span><span class="token hvariable">boyfriend</span><span class="token punctuation">,</span> <span class="token hvariable">planB</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token hvariable">bachelors</span>

<span class="token hvariable">main</span> <span class="token operator">=</span> <span class="token keyword">do</span>
  <span class="token keyword">let</span> <span class="token hvariable">aPref</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token char string">&apos;A&apos;</span><span class="token punctuation">,</span><span class="token string">&quot;YXZ&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token char string">&apos;B&apos;</span><span class="token punctuation">,</span><span class="token string">&quot;ZYX&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token char string">&apos;C&apos;</span><span class="token punctuation">,</span> <span class="token string">&quot;XZY&quot;</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
      <span class="token hvariable">bPref</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token char string">&apos;X&apos;</span><span class="token punctuation">,</span><span class="token string">&quot;BAC&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token char string">&apos;Y&apos;</span><span class="token punctuation">,</span><span class="token string">&quot;CBA&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token char string">&apos;Z&apos;</span><span class="token punctuation">,</span> <span class="token string">&quot;ACB&quot;</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
  <span class="token builtin">print</span> <span class="token operator">$</span> <span class="token hvariable">stableMatching</span> <span class="token hvariable">aPref</span> <span class="token hvariable">bPref</span>
</code></pre>
</div><div class="code-method-sample" data-lang="c" data-name="C"><pre class="language-"><code class="lang-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdbool.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdlib.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;string.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;time.h&gt;</span></span>

<span class="token keyword">struct</span> <span class="token class-name">person</span> <span class="token punctuation">{</span>
    <span class="token keyword">int</span> id<span class="token punctuation">;</span>
    <span class="token keyword">struct</span> <span class="token class-name">person</span> <span class="token operator">*</span>partner<span class="token punctuation">;</span>
    <span class="token class-name">size_t</span> <span class="token operator">*</span>prefers<span class="token punctuation">;</span>
    <span class="token class-name">size_t</span> index<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">void</span> <span class="token function">shuffle</span><span class="token punctuation">(</span><span class="token class-name">size_t</span> <span class="token operator">*</span>array<span class="token punctuation">,</span> <span class="token class-name">size_t</span> size<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">size_t</span> i <span class="token operator">=</span> size <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token operator">--</span>i<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">size_t</span> j <span class="token operator">=</span> <span class="token function">rand</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token punctuation">(</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">size_t</span> tmp <span class="token operator">=</span> array<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
        array<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> array<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">;</span>
        array<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">=</span> tmp<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token function">create_group</span><span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">person</span> <span class="token operator">*</span>group<span class="token punctuation">,</span> <span class="token class-name">size_t</span> size<span class="token punctuation">,</span> bool are_men<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">size_t</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> size<span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        group<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>id <span class="token operator">=</span> i<span class="token punctuation">;</span>
        group<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>partner <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>
        group<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>prefers <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">size_t</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token function">malloc</span><span class="token punctuation">(</span><span class="token keyword">sizeof</span><span class="token punctuation">(</span><span class="token class-name">size_t</span><span class="token punctuation">)</span> <span class="token operator">*</span> size<span class="token punctuation">)</span><span class="token punctuation">;</span>
        group<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>index <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">size_t</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> size<span class="token punctuation">;</span> <span class="token operator">++</span>j<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            group<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>prefers<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">=</span> j<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token function">shuffle</span><span class="token punctuation">(</span>group<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>prefers<span class="token punctuation">,</span> size<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

bool <span class="token function">prefers_partner</span><span class="token punctuation">(</span><span class="token class-name">size_t</span> <span class="token operator">*</span>prefers<span class="token punctuation">,</span> <span class="token class-name">size_t</span> partner<span class="token punctuation">,</span> <span class="token class-name">size_t</span> id<span class="token punctuation">,</span> <span class="token class-name">size_t</span> size<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">size_t</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> size<span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>prefers<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">==</span> partner<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> true<span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>prefers<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">==</span> id<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> false<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token function">stable_marriage</span><span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">person</span> <span class="token operator">*</span>men<span class="token punctuation">,</span> <span class="token keyword">struct</span> <span class="token class-name">person</span> <span class="token operator">*</span>women<span class="token punctuation">,</span> <span class="token class-name">size_t</span> size<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">struct</span> <span class="token class-name">person</span> <span class="token operator">*</span>bachelors<span class="token punctuation">[</span>size<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token class-name">size_t</span> bachelors_size <span class="token operator">=</span> size<span class="token punctuation">;</span>

    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">size_t</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> size<span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        bachelors<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token operator">&amp;</span>men<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">while</span> <span class="token punctuation">(</span>bachelors_size <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">struct</span> <span class="token class-name">person</span> <span class="token operator">*</span>man <span class="token operator">=</span> bachelors<span class="token punctuation">[</span>bachelors_size <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token keyword">struct</span> <span class="token class-name">person</span> <span class="token operator">*</span>woman <span class="token operator">=</span> <span class="token operator">&amp;</span>women<span class="token punctuation">[</span>man<span class="token operator">-&gt;</span>prefers<span class="token punctuation">[</span>man<span class="token operator">-&gt;</span>index<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>woman<span class="token operator">-&gt;</span>partner<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            woman<span class="token operator">-&gt;</span>partner <span class="token operator">=</span> man<span class="token punctuation">;</span>
            man<span class="token operator">-&gt;</span>partner <span class="token operator">=</span> woman<span class="token punctuation">;</span>
            bachelors<span class="token punctuation">[</span><span class="token operator">--</span>bachelors_size<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">prefers_partner</span><span class="token punctuation">(</span>woman<span class="token operator">-&gt;</span>prefers<span class="token punctuation">,</span> woman<span class="token operator">-&gt;</span>partner<span class="token operator">-&gt;</span>id<span class="token punctuation">,</span> man<span class="token operator">-&gt;</span>id<span class="token punctuation">,</span>
                                   size<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

            woman<span class="token operator">-&gt;</span>partner<span class="token operator">-&gt;</span>index<span class="token operator">++</span><span class="token punctuation">;</span>
            bachelors<span class="token punctuation">[</span>bachelors_size <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> woman<span class="token operator">-&gt;</span>partner<span class="token punctuation">;</span>
            woman<span class="token operator">-&gt;</span>partner <span class="token operator">=</span> man<span class="token punctuation">;</span>
            man<span class="token operator">-&gt;</span>partner <span class="token operator">=</span> woman<span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            man<span class="token operator">-&gt;</span>index<span class="token operator">++</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token function">free_group</span><span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">person</span> <span class="token operator">*</span>group<span class="token punctuation">,</span> <span class="token class-name">size_t</span> size<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">size_t</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> size<span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">free</span><span class="token punctuation">(</span>group<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>prefers<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">srand</span><span class="token punctuation">(</span><span class="token function">time</span><span class="token punctuation">(</span><span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">struct</span> <span class="token class-name">person</span> men<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">,</span> women<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

    <span class="token function">create_group</span><span class="token punctuation">(</span>men<span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> true<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">create_group</span><span class="token punctuation">(</span>women<span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> false<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">size_t</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">5</span><span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;preferences of man %zu: &quot;</span><span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">size_t</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> <span class="token number">5</span><span class="token punctuation">;</span> <span class="token operator">++</span>j<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;%zu &quot;</span><span class="token punctuation">,</span> men<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>prefers<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">size_t</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">5</span><span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;preferences of woman %zu: &quot;</span><span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">size_t</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> <span class="token number">5</span><span class="token punctuation">;</span> <span class="token operator">++</span>j<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;%zu &quot;</span><span class="token punctuation">,</span> women<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>prefers<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token function">stable_marriage</span><span class="token punctuation">(</span>men<span class="token punctuation">,</span> women<span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">size_t</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">5</span><span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;the partner of man %zu is woman %d\n&quot;</span><span class="token punctuation">,</span> i<span class="token punctuation">,</span> men<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>partner<span class="token operator">-&gt;</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token function">free_group</span><span class="token punctuation">(</span>men<span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">free_group</span><span class="token punctuation">(</span>women<span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
</div><div class="code-method-sample" data-lang="cpp" data-name="C++"><pre class="language-"><code class="lang-cpp"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;algorithm&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;iostream&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;iterator&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;numeric&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;random&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;vector&gt;</span></span>

<span class="token comment">// this header is so that we can use `not` and `and` on MSVC</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;ciso646&gt;</span></span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;cstddef&gt;</span></span>

<span class="token keyword">using</span> std<span class="token double-colon punctuation">::</span>size_t<span class="token punctuation">;</span>

<span class="token comment">/*
  we use these to generate random numbers in this program.
  this makes the program simpler,
  by not having to pass around random number generators.
*/</span>
<span class="token keyword">static</span> <span class="token keyword">thread_local</span> std<span class="token double-colon punctuation">::</span>random_device global_random_device<span class="token punctuation">;</span>
<span class="token keyword">static</span> <span class="token keyword">thread_local</span> std<span class="token double-colon punctuation">::</span>mt19937 <span class="token function">global_rng</span><span class="token punctuation">(</span><span class="token function">global_random_device</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">struct</span> <span class="token class-name">person</span> <span class="token punctuation">{</span>
  <span class="token comment">/*
    this is a poor person&apos;s std::optional,
    but since we&apos;re attempting to be compileable on C++14,
    we won&apos;t worry too much about it.
  */</span>
  <span class="token keyword">bool</span> finished<span class="token punctuation">;</span>
  size_t preference<span class="token punctuation">;</span>

  std<span class="token double-colon punctuation">::</span>vector<span class="token operator">&lt;</span>size_t<span class="token operator">&gt;</span> preference_list<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">/*
  this function generates a list of people with size `number_of_partners`.

  each person&apos;s `preference_list` will be a randomly sorted list of
  the numbers in the range [0, number_of_partners),
  with no duplicates.
*/</span>
std<span class="token double-colon punctuation">::</span>vector<span class="token operator">&lt;</span>person<span class="token operator">&gt;</span> <span class="token function">make_person_list</span><span class="token punctuation">(</span>size_t number_of_partners<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">auto</span> random_pref_list <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token operator">&amp;</span><span class="token punctuation">]</span> <span class="token punctuation">{</span>
    std<span class="token double-colon punctuation">::</span>vector<span class="token operator">&lt;</span>size_t<span class="token operator">&gt;</span> <span class="token function">ret</span><span class="token punctuation">(</span>number_of_partners<span class="token punctuation">)</span><span class="token punctuation">;</span>
    std<span class="token double-colon punctuation">::</span><span class="token function">iota</span><span class="token punctuation">(</span><span class="token function">begin</span><span class="token punctuation">(</span>ret<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">end</span><span class="token punctuation">(</span>ret<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">size_t</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    std<span class="token double-colon punctuation">::</span><span class="token function">shuffle</span><span class="token punctuation">(</span><span class="token function">begin</span><span class="token punctuation">(</span>ret<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">end</span><span class="token punctuation">(</span>ret<span class="token punctuation">)</span><span class="token punctuation">,</span> global_rng<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> ret<span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>

  std<span class="token double-colon punctuation">::</span>vector<span class="token operator">&lt;</span>person<span class="token operator">&gt;</span> ret<span class="token punctuation">;</span>
  std<span class="token double-colon punctuation">::</span><span class="token function">generate_n</span><span class="token punctuation">(</span>std<span class="token double-colon punctuation">::</span><span class="token function">back_inserter</span><span class="token punctuation">(</span>ret<span class="token punctuation">)</span><span class="token punctuation">,</span> number_of_partners<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token operator">&amp;</span><span class="token punctuation">]</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> person<span class="token punctuation">{</span><span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token function">random_pref_list</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> ret<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">template</span> <span class="token operator">&lt;</span><span class="token keyword">typename</span> <span class="token class-name">LeadIter</span><span class="token punctuation">,</span> <span class="token keyword">typename</span> <span class="token class-name">FollowIter</span><span class="token operator">&gt;</span>
<span class="token keyword">void</span> <span class="token function">stable_match</span><span class="token punctuation">(</span>LeadIter leads<span class="token punctuation">,</span> LeadIter leads_end<span class="token punctuation">,</span> FollowIter follows<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// for each index in the leads&apos; preference list, we&apos;ll go through this</span>
  size_t <span class="token keyword">const</span> number_of_partners <span class="token operator">=</span> leads_end <span class="token operator">-</span> leads<span class="token punctuation">;</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span>size_t proposal_index <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> proposal_index <span class="token operator">&lt;</span> number_of_partners<span class="token punctuation">;</span>
       <span class="token operator">++</span>proposal_index<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">/*
      each follow will get their own vector of proposals to them
      for each entry in the leads&apos; proposal list

      if this weren&apos;t example code, this would likely go outside the loop
      to cut down on allocations
    */</span>
    std<span class="token double-colon punctuation">::</span>vector<span class="token operator">&lt;</span>std<span class="token double-colon punctuation">::</span>vector<span class="token operator">&lt;</span>size_t<span class="token operator">&gt;&gt;</span> <span class="token function">proposals</span><span class="token punctuation">(</span>number_of_partners<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// for each lead, we&apos;ll make a proposal to their favorite follow</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span>size_t i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> number_of_partners<span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">not</span> leads<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>finished<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">auto</span> pref <span class="token operator">=</span> leads<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>preference_list<span class="token punctuation">[</span>proposal_index<span class="token punctuation">]</span><span class="token punctuation">;</span>
        proposals<span class="token punctuation">[</span>pref<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// for each follow, we&apos;ll look at their preference list</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span>size_t i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> number_of_partners<span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">for</span> <span class="token punctuation">(</span>size_t pref <span class="token operator">:</span> follows<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>preference_list<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span>size_t proposal <span class="token operator">:</span> proposals<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token comment">// and, if they were given a proposal, then they&apos;ll choose their</span>
          <span class="token comment">// favorite here</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span>pref <span class="token operator">==</span> proposal <span class="token operator">and</span> <span class="token operator">not</span> follows<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>finished<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            follows<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>preference <span class="token operator">=</span> pref<span class="token punctuation">;</span>
            follows<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>finished <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>

            leads<span class="token punctuation">[</span>pref<span class="token punctuation">]</span><span class="token punctuation">.</span>preference <span class="token operator">=</span> i<span class="token punctuation">;</span>
            leads<span class="token punctuation">[</span>pref<span class="token punctuation">]</span><span class="token punctuation">.</span>finished <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// these are the number of partners in each group</span>
  size_t <span class="token keyword">const</span> number_of_partners <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span>

  <span class="token comment">// in this case, the leads shall propose to the follows</span>
  <span class="token keyword">auto</span> leads <span class="token operator">=</span> <span class="token function">make_person_list</span><span class="token punctuation">(</span>number_of_partners<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">auto</span> follows <span class="token operator">=</span> <span class="token function">make_person_list</span><span class="token punctuation">(</span>number_of_partners<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token function">stable_match</span><span class="token punctuation">(</span><span class="token function">begin</span><span class="token punctuation">(</span>leads<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">end</span><span class="token punctuation">(</span>leads<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">begin</span><span class="token punctuation">(</span>follows<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// the happy marriages are announced to the console here :)</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span>size_t i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> number_of_partners<span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">&quot;the partnership of lead &quot;</span> <span class="token operator">&lt;&lt;</span> i <span class="token operator">&lt;&lt;</span> <span class="token string">&quot; and follow &quot;</span>
              <span class="token operator">&lt;&lt;</span> leads<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>preference <span class="token operator">&lt;&lt;</span> <span class="token string">&quot; shall commence forthwith!\n&quot;</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
</div><div class="code-method-sample" data-lang="js" data-name="JavaScript"><pre class="language-"><code class="lang-javascript"><span class="token keyword">class</span> <span class="token class-name">Person</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">name</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">get</span> <span class="token function">hasFiance</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token operator">!</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>fiance<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token function">prefers</span><span class="token punctuation">(</span><span class="token parameter">other</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>preferences<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span>other<span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>preferences<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>fiance<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token function">engageTo</span><span class="token punctuation">(</span><span class="token parameter">other</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>other<span class="token punctuation">.</span>hasFiance<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      other<span class="token punctuation">.</span>fiance<span class="token punctuation">.</span>fiance <span class="token operator">=</span> <span class="token keyword">undefined</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">this</span><span class="token punctuation">.</span>fiance <span class="token operator">=</span> other<span class="token punctuation">;</span>
    other<span class="token punctuation">.</span>fiance <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">stableMarriage</span><span class="token punctuation">(</span><span class="token parameter">guys<span class="token punctuation">,</span> girls</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> bachelors <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token operator">...</span>guys<span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token keyword">while</span> <span class="token punctuation">(</span>bachelors<span class="token punctuation">.</span>length <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> guy <span class="token operator">=</span> bachelors<span class="token punctuation">.</span><span class="token function">shift</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> girl <span class="token keyword">of</span> guy<span class="token punctuation">.</span>preferences<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>girl<span class="token punctuation">.</span>hasFiance<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        guy<span class="token punctuation">.</span><span class="token function">engageTo</span><span class="token punctuation">(</span>girl<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">break</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>girl<span class="token punctuation">.</span><span class="token function">prefers</span><span class="token punctuation">(</span>guy<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        bachelors<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>girl<span class="token punctuation">.</span>fiance<span class="token punctuation">)</span><span class="token punctuation">;</span>
        guy<span class="token punctuation">.</span><span class="token function">engageTo</span><span class="token punctuation">(</span>girl<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">break</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">shuffle</span><span class="token punctuation">(</span><span class="token parameter">iterable</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> array <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token operator">...</span>iterable<span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> array<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">--</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> j <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">floor</span><span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token punctuation">(</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">[</span>array<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> array<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span>array<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">,</span> array<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> array<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> guys <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token operator">...</span><span class="token string">&quot;ABCDE&quot;</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">name</span> <span class="token operator">=&gt;</span> <span class="token keyword">new</span> <span class="token class-name">Person</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> girls <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token operator">...</span><span class="token string">&quot;FGHIJ&quot;</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">name</span> <span class="token operator">=&gt;</span> <span class="token keyword">new</span> <span class="token class-name">Person</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Guys&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> guy <span class="token keyword">of</span> guys<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  guy<span class="token punctuation">.</span>preferences <span class="token operator">=</span> <span class="token function">shuffle</span><span class="token punctuation">(</span>girls<span class="token punctuation">)</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>guy<span class="token punctuation">.</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>guy<span class="token punctuation">.</span>preferences<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">p</span> <span class="token operator">=&gt;</span> p<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;\nGirls&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> girl <span class="token keyword">of</span> girls<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  girl<span class="token punctuation">.</span>preferences <span class="token operator">=</span> <span class="token function">shuffle</span><span class="token punctuation">(</span>guys<span class="token punctuation">)</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>girl<span class="token punctuation">.</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>girl<span class="token punctuation">.</span>preferences<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">p</span> <span class="token operator">=&gt;</span> p<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token function">stableMarriage</span><span class="token punctuation">(</span>guys<span class="token punctuation">,</span> girls<span class="token punctuation">)</span><span class="token punctuation">;</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;\nPairings&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> guy <span class="token keyword">of</span> guys<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>guy<span class="token punctuation">.</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>guy<span class="token punctuation">.</span>fiance<span class="token punctuation">.</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
</div><div class="code-method-sample" data-lang="cs" data-name="C#"><h5 id="galeshapleyalgorithmcs">GaleShapleyAlgorithm.cs</h5>
<pre class="language-"><code class="lang-csharp"><span class="token comment">// submitted by Julian Schacher (jspp) with great help by gustorn and Marius Becker</span>
<span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Collections<span class="token punctuation">.</span>Generic</span><span class="token punctuation">;</span>

<span class="token keyword">namespace</span> <span class="token namespace">StableMarriageProblem</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">GaleShapleyAlgorithm<span class="token punctuation">&lt;</span>TFollow<span class="token punctuation">,</span> TLead<span class="token punctuation">&gt;</span></span>
        <span class="token keyword">where</span> <span class="token class-name">TFollow</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">Person<span class="token punctuation">&lt;</span>TFollow<span class="token punctuation">,</span> TLead<span class="token punctuation">&gt;</span></span></span>
        <span class="token keyword">where</span> <span class="token class-name">TLead</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">Person<span class="token punctuation">&lt;</span>TLead<span class="token punctuation">,</span> TFollow<span class="token punctuation">&gt;</span></span></span>
    <span class="token punctuation">{</span>
        <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">RunGaleShapleyAlgorithm</span><span class="token punctuation">(</span><span class="token class-name">List<span class="token punctuation">&lt;</span>TFollow<span class="token punctuation">&gt;</span></span> follows<span class="token punctuation">,</span> <span class="token class-name">List<span class="token punctuation">&lt;</span>TLead<span class="token punctuation">&gt;</span></span> leads<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token comment">// All follows are lonely.</span>
            <span class="token class-name"><span class="token keyword">var</span></span> lonelyFollows <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">List<span class="token punctuation">&lt;</span>TFollow<span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>follows<span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">// Carry on until there are no lonely follows anymore.</span>
            <span class="token keyword">while</span> <span class="token punctuation">(</span>lonelyFollows<span class="token punctuation">.</span>Count <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span>
            <span class="token punctuation">{</span>
                <span class="token comment">// Let every lonely follow propose to their current top choice.</span>
                <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">var</span></span> lonelyFollow <span class="token keyword">in</span> lonelyFollows<span class="token punctuation">)</span>
                <span class="token punctuation">{</span>
                    lonelyFollow<span class="token punctuation">.</span><span class="token function">ProposeToNext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>

                <span class="token comment">// Look which follows have a partner now and which don&apos;t.</span>
                <span class="token class-name"><span class="token keyword">var</span></span> newLonelyFollows <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">List<span class="token punctuation">&lt;</span>TFollow<span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">var</span></span> follow <span class="token keyword">in</span> follows<span class="token punctuation">)</span>
                <span class="token punctuation">{</span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span>follow<span class="token punctuation">.</span>Partner <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
                        newLonelyFollows<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span>follow<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                lonelyFollows <span class="token operator">=</span> newLonelyFollows<span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<h5 id="personcs">Person.cs</h5>
<pre class="language-"><code class="lang-csharp"><span class="token comment">// submitted by Julian Schacher (jspp) with great help by gustorn and Marius Becker</span>
<span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Collections<span class="token punctuation">.</span>Generic</span><span class="token punctuation">;</span>

<span class="token keyword">namespace</span> <span class="token namespace">StableMarriageProblem</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Person<span class="token punctuation">&lt;</span>TSelf<span class="token punctuation">,</span> TPref<span class="token punctuation">&gt;</span></span>
        <span class="token keyword">where</span> <span class="token class-name">TSelf</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">Person<span class="token punctuation">&lt;</span>TSelf<span class="token punctuation">,</span> TPref<span class="token punctuation">&gt;</span></span></span>
        <span class="token keyword">where</span> <span class="token class-name">TPref</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">Person<span class="token punctuation">&lt;</span>TPref<span class="token punctuation">,</span> TSelf<span class="token punctuation">&gt;</span></span></span>
    <span class="token punctuation">{</span>
        <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> Name <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
        <span class="token keyword">public</span> <span class="token return-type class-name">TPref</span> Partner <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
        <span class="token keyword">public</span> <span class="token return-type class-name">IList<span class="token punctuation">&lt;</span>TPref<span class="token punctuation">&gt;</span></span> Choices <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
        <span class="token comment">// CurrentTopChoice equals the Choice in Choices that is the TopChoice,</span>
        <span class="token comment">// if already tried women are not counted.</span>
        <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">int</span></span> CurrentTopChoiceIndex <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

        <span class="token keyword">public</span> <span class="token function">Person</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> name<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> Name <span class="token operator">=</span> name<span class="token punctuation">;</span>

        <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">ProposeToNext</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token class-name"><span class="token keyword">var</span></span> interest <span class="token operator">=</span> <span class="token function">GetNextTopChoice</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">// If the interest has no partner or prefers this person,</span>
            <span class="token comment">// change interest&apos;s partner to this person.</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>interest<span class="token punctuation">.</span>Partner <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">||</span>
                interest<span class="token punctuation">.</span>Choices<span class="token punctuation">.</span><span class="token function">IndexOf</span><span class="token punctuation">(</span><span class="token keyword">this</span> <span class="token keyword">as</span> <span class="token class-name">TSelf</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> interest<span class="token punctuation">.</span>Choices<span class="token punctuation">.</span><span class="token function">IndexOf</span><span class="token punctuation">(</span>interest<span class="token punctuation">.</span>Partner<span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">{</span>
                <span class="token comment">// Should the interest already have a partner, set the partner</span>
                <span class="token comment">// of the interest&apos;s partner to null.</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>interest<span class="token punctuation">.</span>Partner <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
                    interest<span class="token punctuation">.</span>Partner<span class="token punctuation">.</span>Partner <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
                interest<span class="token punctuation">.</span>Partner <span class="token operator">=</span> <span class="token keyword">this</span> <span class="token keyword">as</span> <span class="token class-name">TSelf</span><span class="token punctuation">;</span>
                Partner <span class="token operator">=</span> interest<span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">private</span> <span class="token return-type class-name">TPref</span> <span class="token function">GetNextTopChoice</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> Choices<span class="token punctuation">[</span>CurrentTopChoiceIndex<span class="token operator">++</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<h5 id="programcs">Program.cs</h5>
<pre class="language-"><code class="lang-csharp"><span class="token comment">// submitted by Julian Schacher (jspp) with great help by gustorn and Marius Becker</span>
<span class="token keyword">using</span> <span class="token namespace">System</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Collections<span class="token punctuation">.</span>Generic</span><span class="token punctuation">;</span>

<span class="token keyword">namespace</span> <span class="token namespace">StableMarriageProblem</span>
<span class="token punctuation">{</span>
    <span class="token keyword">class</span> <span class="token class-name">Program</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Main</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> args<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;GaleShapleyAlgorithm&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// Using men and women as an example.</span>
            <span class="token class-name"><span class="token keyword">var</span></span> men <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">List<span class="token punctuation">&lt;</span>Man<span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">{</span>
                <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Man</span><span class="token punctuation">(</span><span class="token string">&quot;A&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Man</span><span class="token punctuation">(</span><span class="token string">&quot;B&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Man</span><span class="token punctuation">(</span><span class="token string">&quot;C&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Man</span><span class="token punctuation">(</span><span class="token string">&quot;D&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Man</span><span class="token punctuation">(</span><span class="token string">&quot;E&quot;</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span><span class="token punctuation">;</span>
            <span class="token class-name"><span class="token keyword">var</span></span> women <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">List<span class="token punctuation">&lt;</span>Woman<span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">{</span>
                <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Woman</span><span class="token punctuation">(</span><span class="token string">&quot;F&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Woman</span><span class="token punctuation">(</span><span class="token string">&quot;G&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Woman</span><span class="token punctuation">(</span><span class="token string">&quot;H&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Woman</span><span class="token punctuation">(</span><span class="token string">&quot;I&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Woman</span><span class="token punctuation">(</span><span class="token string">&quot;J&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token punctuation">}</span><span class="token punctuation">;</span>

            <span class="token class-name"><span class="token keyword">var</span></span> random <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">var</span></span> man <span class="token keyword">in</span> men<span class="token punctuation">)</span>
            <span class="token punctuation">{</span>
                man<span class="token punctuation">.</span>Choices <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">List<span class="token punctuation">&lt;</span>Woman<span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>women<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Shuffle</span><span class="token punctuation">(</span>random<span class="token punctuation">)</span><span class="token punctuation">;</span>
                Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span>man<span class="token punctuation">.</span>Name <span class="token operator">+</span> <span class="token string">&quot;:&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">var</span></span> choice <span class="token keyword">in</span> man<span class="token punctuation">.</span>Choices<span class="token punctuation">)</span>
                    Console<span class="token punctuation">.</span><span class="token function">Write</span><span class="token punctuation">(</span>choice<span class="token punctuation">.</span>Name<span class="token punctuation">)</span><span class="token punctuation">;</span>
                Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">var</span></span> woman <span class="token keyword">in</span> women<span class="token punctuation">)</span>
            <span class="token punctuation">{</span>
                woman<span class="token punctuation">.</span>Choices <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">List<span class="token punctuation">&lt;</span>Man<span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>men<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Shuffle</span><span class="token punctuation">(</span>random<span class="token punctuation">)</span><span class="token punctuation">;</span>
                Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span>woman<span class="token punctuation">.</span>Name <span class="token operator">+</span> <span class="token string">&quot;:&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">var</span></span> choice <span class="token keyword">in</span> woman<span class="token punctuation">.</span>Choices<span class="token punctuation">)</span>
                    Console<span class="token punctuation">.</span><span class="token function">Write</span><span class="token punctuation">(</span>choice<span class="token punctuation">.</span>Name<span class="token punctuation">)</span><span class="token punctuation">;</span>
                Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            GaleShapleyAlgorithm<span class="token operator">&lt;</span>Woman<span class="token punctuation">,</span> Man<span class="token operator">&gt;</span><span class="token punctuation">.</span><span class="token function">RunGaleShapleyAlgorithm</span><span class="token punctuation">(</span>women<span class="token punctuation">,</span> men<span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">var</span></span> woman <span class="token keyword">in</span> women<span class="token punctuation">)</span>
            <span class="token punctuation">{</span>
                Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span>woman<span class="token punctuation">.</span>Name <span class="token operator">+</span> <span class="token string">&quot; : &quot;</span> <span class="token operator">+</span> woman<span class="token punctuation">?.</span>Partner<span class="token punctuation">.</span>Name<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Man</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">Person<span class="token punctuation">&lt;</span>Man<span class="token punctuation">,</span> Woman<span class="token punctuation">&gt;</span></span></span>
    <span class="token punctuation">{</span>
        <span class="token keyword">public</span> <span class="token function">Man</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> name<span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token keyword">base</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Woman</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">Person<span class="token punctuation">&lt;</span>Woman<span class="token punctuation">,</span> Man<span class="token punctuation">&gt;</span></span></span>
    <span class="token punctuation">{</span>
        <span class="token keyword">public</span> <span class="token function">Woman</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> name<span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token keyword">base</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<h5 id="listextensionscs">ListExtensions.cs</h5>
<pre class="language-"><code class="lang-csharp"><span class="token keyword">using</span> <span class="token namespace">System</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Collections<span class="token punctuation">.</span>Generic</span><span class="token punctuation">;</span>

<span class="token keyword">namespace</span> <span class="token namespace">StableMarriageProblem</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">ListExtensions</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name">IList<span class="token punctuation">&lt;</span>T<span class="token punctuation">&gt;</span></span> <span class="token generic-method"><span class="token function">Shuffle</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>T<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token keyword">this</span> <span class="token class-name">IList<span class="token punctuation">&lt;</span>T<span class="token punctuation">&gt;</span></span> list<span class="token punctuation">,</span> <span class="token class-name">Random</span> rng<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">var</span></span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> list<span class="token punctuation">.</span>Count<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
            <span class="token punctuation">{</span>
                <span class="token class-name"><span class="token keyword">var</span></span> j <span class="token operator">=</span> rng<span class="token punctuation">.</span><span class="token function">Next</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> list<span class="token punctuation">.</span>Count<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name"><span class="token keyword">var</span></span> tmp <span class="token operator">=</span> list<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
                list<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> list<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">;</span>
                list<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">=</span> tmp<span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">return</span> list<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
</div><div class="code-method-sample" data-lang="java" data-name="Java"><pre class="language-"><code class="lang-java"><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">List</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">ArrayList</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Collections</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">StableMarriage</span> <span class="token punctuation">{</span>

    <span class="token comment">/*
     * Use the stable marriage algorithm to find stable pairs from the
     * lists of men and women.
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">findStableMarriages</span><span class="token punctuation">(</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Woman</span><span class="token punctuation">&gt;</span></span> women<span class="token punctuation">,</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Man</span><span class="token punctuation">&gt;</span></span> men<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// We might have more men/women than women/men. In this case, not everybody can</span>
        <span class="token comment">// get a mate. We should aim to give every member of the less numerous gender a mate,</span>
        <span class="token comment">// as this is always possible.</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">extends</span> <span class="token class-name">Person</span><span class="token punctuation">&gt;</span></span> leastCommonGender <span class="token operator">=</span> women<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;=</span> men<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">?</span> women <span class="token operator">:</span> men<span class="token punctuation">;</span>
        <span class="token keyword">do</span> <span class="token punctuation">{</span>
            <span class="token comment">// Every single man proposes to a woman.</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Man</span> man <span class="token operator">:</span> men<span class="token punctuation">)</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>man<span class="token punctuation">.</span><span class="token function">isLonely</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                    man<span class="token punctuation">.</span><span class="token function">propose</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">// The women pick their favorite suitor.</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Woman</span> woman <span class="token operator">:</span> women<span class="token punctuation">)</span>
                woman<span class="token punctuation">.</span><span class="token function">chooseMate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">// End the process if everybody has a mate.</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>leastCommonGender<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">anyMatch</span><span class="token punctuation">(</span><span class="token class-name">Person</span><span class="token operator">::</span><span class="token function">isLonely</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token keyword">break</span><span class="token punctuation">;</span>

        <span class="token punctuation">}</span> <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        women<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>w <span class="token operator">-&gt;</span> <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>w <span class="token operator">+</span> <span class="token string">&quot; married to &quot;</span> <span class="token operator">+</span> w<span class="token punctuation">.</span><span class="token function">getMate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">int</span> nPairs <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Woman</span><span class="token punctuation">&gt;</span></span> women <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Man</span><span class="token punctuation">&gt;</span></span> men <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">char</span> i <span class="token operator">=</span> <span class="token string">&apos;A&apos;</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token string">&apos;A&apos;</span> <span class="token operator">+</span> nPairs<span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            women<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Woman</span><span class="token punctuation">(</span><span class="token string">&quot;&quot;</span> <span class="token operator">+</span> i<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            men<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Man</span><span class="token punctuation">(</span><span class="token string">&quot;&quot;</span> <span class="token operator">+</span> i<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">// Make the genders unbalanced:</span>
        women<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Woman</span><span class="token punctuation">(</span><span class="token string">&quot;X&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        women<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>w <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            w<span class="token punctuation">.</span><span class="token function">receiveOptions</span><span class="token punctuation">(</span>men<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>w <span class="token operator">+</span> <span class="token string">&quot; prefers &quot;</span> <span class="token operator">+</span> w<span class="token punctuation">.</span><span class="token function">getPreferredMates</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        men<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>m <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            m<span class="token punctuation">.</span><span class="token function">receiveOptions</span><span class="token punctuation">(</span>women<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>m <span class="token operator">+</span> <span class="token string">&quot; prefers &quot;</span> <span class="token operator">+</span> m<span class="token punctuation">.</span><span class="token function">getPreferredMates</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token function">findStableMarriages</span><span class="token punctuation">(</span>women<span class="token punctuation">,</span> men<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">Person</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">String</span> name<span class="token punctuation">;</span>
    <span class="token keyword">protected</span> <span class="token class-name">Person</span> mate<span class="token punctuation">;</span>
    <span class="token keyword">protected</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Person</span><span class="token punctuation">&gt;</span></span> preferredMates<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">Person</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">isLonely</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> mate <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setMate</span><span class="token punctuation">(</span><span class="token class-name">Person</span> mate<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// Only set mates if there is a change.</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>mate <span class="token operator">!=</span> mate<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// Remove old mates mate.</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>mate <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
                <span class="token keyword">this</span><span class="token punctuation">.</span>mate<span class="token punctuation">.</span>mate <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>

            <span class="token comment">// Set the new mate.</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>mate <span class="token operator">=</span> mate<span class="token punctuation">;</span>

            <span class="token comment">// If new mate is someone, update their mate.</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>mate <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
                mate<span class="token punctuation">.</span>mate <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token class-name">Person</span> <span class="token function">getMate</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> mate<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">receiveOptions</span><span class="token punctuation">(</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">extends</span> <span class="token class-name">Person</span><span class="token punctuation">&gt;</span></span> mates<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// Preferences are subjective.</span>
        preferredMates <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>mates<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Collections</span><span class="token punctuation">.</span><span class="token function">shuffle</span><span class="token punctuation">(</span>preferredMates<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Person</span><span class="token punctuation">&gt;</span></span> <span class="token function">getPreferredMates</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> preferredMates<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;(&quot;</span> <span class="token operator">+</span> name <span class="token operator">+</span> <span class="token string">&quot;)&quot;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">Woman</span> <span class="token keyword">extends</span> <span class="token class-name">Person</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Man</span><span class="token punctuation">&gt;</span></span> suitors <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">Woman</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">super</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">recieveProposal</span><span class="token punctuation">(</span><span class="token class-name">Man</span> suitor<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        suitors<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>suitor<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">chooseMate</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Person</span> mostDesired <span class="token operator">:</span> preferredMates<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>mostDesired <span class="token operator">==</span> mate <span class="token operator">||</span> suitors<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span>mostDesired<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token function">setMate</span><span class="token punctuation">(</span>mostDesired<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">Man</span> <span class="token keyword">extends</span> <span class="token class-name">Person</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token class-name">Man</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">super</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">propose</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>preferredMates<span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">Woman</span> fiance <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Woman</span><span class="token punctuation">)</span> preferredMates<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            fiance<span class="token punctuation">.</span><span class="token function">recieveProposal</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
</div><div class="code-method-sample" data-lang="php" data-name="PHP"><pre class="language-"><code class="lang-php"><span class="token delimiter important">&lt;?php</span>
<span class="token keyword">declare</span><span class="token punctuation">(</span>strict_types<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name-definition class-name">Person</span>
<span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token variable">$name</span><span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token variable">$suitors</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token variable">$preferences</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token variable">$match</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__construct</span><span class="token punctuation">(</span><span class="token variable">$name</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">name</span> <span class="token operator">=</span> <span class="token variable">$name</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token keyword return-type">string</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">name</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">setPreferences</span><span class="token punctuation">(</span><span class="token keyword type-hint">array</span> <span class="token variable">$preferences</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token keyword return-type">void</span>
    <span class="token punctuation">{</span>
        <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">preferences</span> <span class="token operator">=</span> <span class="token variable">$preferences</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">getMatch</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token operator">?</span><span class="token class-name return-type">Person</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">match</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">getPreferences</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token keyword return-type">array</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">preferences</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">isSingle</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token keyword return-type">bool</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">match</span> <span class="token operator">===</span> <span class="token constant">null</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">unmatch</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token keyword return-type">void</span>
    <span class="token punctuation">{</span>
        <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">match</span> <span class="token operator">=</span> <span class="token constant">null</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">setMatch</span><span class="token punctuation">(</span><span class="token class-name type-declaration">Person</span> <span class="token variable">$match</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token keyword return-type">void</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">match</span> <span class="token operator">!==</span> <span class="token variable">$match</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">match</span> <span class="token operator">!==</span> <span class="token constant">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">match</span><span class="token operator">-&gt;</span><span class="token function">unmatch</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">match</span> <span class="token operator">=</span> <span class="token variable">$match</span><span class="token punctuation">;</span>
            <span class="token variable">$match</span><span class="token operator">-&gt;</span><span class="token function">setMatch</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">propose</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token keyword return-type">void</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">empty</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">preferences</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token variable">$fiance</span> <span class="token operator">=</span> <span class="token function">array_shift</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">preferences</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token variable">$fiance</span><span class="token operator">-&gt;</span><span class="token function">receiveProposal</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">receiveProposal</span><span class="token punctuation">(</span><span class="token class-name type-declaration">Person</span> <span class="token variable">$man</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token keyword return-type">void</span>
    <span class="token punctuation">{</span>
        <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">suitors</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$man</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">chooseMatch</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token keyword return-type">void</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">preferences</span> <span class="token keyword">as</span> <span class="token variable">$preference</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$preference</span> <span class="token operator">===</span> <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token class-name">match</span> <span class="token operator">||</span> <span class="token class-name">in_array</span><span class="token punctuation">(</span><span class="token variable">$preference</span><span class="token punctuation">,</span> <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">suitors</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token function">setMatch</span><span class="token punctuation">(</span><span class="token variable">$preference</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>

        <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">suitors</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token keyword return-type">string</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">name</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function-definition function">stable_marriage</span><span class="token punctuation">(</span><span class="token keyword type-hint">array</span> <span class="token variable">$men</span><span class="token punctuation">,</span> <span class="token keyword type-hint">array</span> <span class="token variable">$women</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token keyword return-type">void</span>
<span class="token punctuation">{</span>
    <span class="token keyword">do</span> <span class="token punctuation">{</span>
        <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token variable">$men</span> <span class="token keyword">as</span> <span class="token variable">$man</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$man</span><span class="token operator">-&gt;</span><span class="token function">isSingle</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token variable">$man</span><span class="token operator">-&gt;</span><span class="token function">propose</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token variable">$women</span> <span class="token keyword">as</span> <span class="token variable">$woman</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token variable">$woman</span><span class="token operator">-&gt;</span><span class="token function">chooseMatch</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token variable">$unmarried</span> <span class="token operator">=</span> <span class="token constant boolean">false</span><span class="token punctuation">;</span>
        <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token variable">$women</span> <span class="token keyword">as</span> <span class="token variable">$woman</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$woman</span><span class="token operator">-&gt;</span><span class="token function">isSingle</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token variable">$unmarried</span> <span class="token operator">=</span> <span class="token constant boolean">true</span><span class="token punctuation">;</span>
                <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>

    <span class="token punctuation">}</span> <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token variable">$unmarried</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token variable">$groupSize</span> <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>
<span class="token variable">$men</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token variable">$women</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token variable">$i</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> <span class="token variable">$i</span> <span class="token operator">&lt;=</span> <span class="token variable">$groupSize</span><span class="token punctuation">;</span> <span class="token variable">$i</span><span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token variable">$men</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Person</span><span class="token punctuation">(</span><span class="token string double-quoted-string">&quot;M${i}&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token variable">$women</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Person</span><span class="token punctuation">(</span><span class="token string double-quoted-string">&quot;W${i}&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token variable">$men</span> <span class="token keyword">as</span> <span class="token variable">$man</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token variable">$preferences</span> <span class="token operator">=</span> <span class="token variable">$women</span><span class="token punctuation">;</span>
    <span class="token function">shuffle</span><span class="token punctuation">(</span><span class="token variable">$preferences</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token variable">$man</span><span class="token operator">-&gt;</span><span class="token function">setPreferences</span><span class="token punctuation">(</span><span class="token variable">$preferences</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&apos;%s\&apos;s choices: %s&apos;</span><span class="token punctuation">,</span> <span class="token variable">$man</span><span class="token operator">-&gt;</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">implode</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&apos;,&apos;</span><span class="token punctuation">,</span> <span class="token variable">$man</span><span class="token operator">-&gt;</span><span class="token function">getPreferences</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">echo</span> <span class="token constant">PHP_EOL</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">echo</span> <span class="token constant">PHP_EOL</span><span class="token punctuation">;</span>
<span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token variable">$women</span> <span class="token keyword">as</span> <span class="token variable">$woman</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token variable">$preferences</span> <span class="token operator">=</span> <span class="token variable">$men</span><span class="token punctuation">;</span>
    <span class="token function">shuffle</span><span class="token punctuation">(</span><span class="token variable">$preferences</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token variable">$woman</span><span class="token operator">-&gt;</span><span class="token function">setPreferences</span><span class="token punctuation">(</span><span class="token variable">$preferences</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&apos;%s\&apos;s choices: %s&apos;</span><span class="token punctuation">,</span> <span class="token variable">$woman</span><span class="token operator">-&gt;</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">implode</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&apos;,&apos;</span><span class="token punctuation">,</span> <span class="token variable">$woman</span><span class="token operator">-&gt;</span><span class="token function">getPreferences</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">echo</span> <span class="token constant">PHP_EOL</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">echo</span> <span class="token constant">PHP_EOL</span><span class="token punctuation">;</span>

<span class="token function">stable_marriage</span><span class="token punctuation">(</span><span class="token variable">$men</span><span class="token punctuation">,</span> <span class="token variable">$women</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token variable">$women</span> <span class="token keyword">as</span> <span class="token variable">$woman</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&apos;%s is married to %s&apos;</span><span class="token punctuation">,</span> <span class="token variable">$woman</span><span class="token punctuation">,</span> <span class="token variable">$woman</span><span class="token operator">-&gt;</span><span class="token function">getMatch</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">echo</span> <span class="token constant">PHP_EOL</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
</div><div class="code-method-sample" data-lang="scala" data-name="Scala"><pre class="language-"><code class="lang-scala"><span class="token keyword">import</span> <span class="token namespace">scala<span class="token punctuation">.</span>collection<span class="token punctuation">.</span>mutable<span class="token punctuation">.</span></span>_

<span class="token keyword">object</span> StableMarriage <span class="token punctuation">{</span>

  <span class="token keyword">var</span> bachelors <span class="token operator">=</span> Queue<span class="token punctuation">[</span>Man<span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

  <span class="token keyword">case</span> <span class="token keyword">class</span> Man<span class="token punctuation">(</span>name<span class="token operator">:</span> <span class="token builtin">String</span><span class="token punctuation">,</span> <span class="token keyword">var</span> preferences<span class="token operator">:</span> List<span class="token punctuation">[</span>Woman<span class="token punctuation">]</span> <span class="token operator">=</span> List<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">def</span> propose<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Unit</span> <span class="token operator">=</span> preferences <span class="token keyword">match</span> <span class="token punctuation">{</span>
      <span class="token keyword">case</span> woman <span class="token operator">::</span> remainingPreferences <span class="token keyword">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>woman<span class="token punctuation">.</span>prefers<span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          bachelors <span class="token operator">++</span><span class="token operator">=</span> woman<span class="token punctuation">.</span>fiance
          woman<span class="token punctuation">.</span>fiance <span class="token operator">=</span> Some<span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">else</span>
          bachelors<span class="token punctuation">.</span>enqueue<span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span>
        preferences <span class="token operator">=</span> remainingPreferences
      <span class="token punctuation">}</span>
      <span class="token keyword">case</span> _ <span class="token keyword">=&gt;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">case</span> <span class="token keyword">class</span> Woman<span class="token punctuation">(</span>name<span class="token operator">:</span> <span class="token builtin">String</span><span class="token punctuation">,</span> <span class="token keyword">var</span> preferences<span class="token operator">:</span> List<span class="token punctuation">[</span>Man<span class="token punctuation">]</span> <span class="token operator">=</span> List<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">var</span> fiance<span class="token operator">:</span> Option<span class="token punctuation">[</span>Man<span class="token punctuation">]</span> <span class="token operator">=</span> None<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">def</span> prefers<span class="token punctuation">(</span>man<span class="token operator">:</span> Man<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Boolean</span> <span class="token operator">=</span>
      fiance <span class="token keyword">match</span> <span class="token punctuation">{</span>
        <span class="token keyword">case</span> Some<span class="token punctuation">(</span>otherMan<span class="token punctuation">)</span> <span class="token keyword">=&gt;</span> preferences<span class="token punctuation">.</span>indexOf<span class="token punctuation">(</span>man<span class="token punctuation">)</span> <span class="token operator">&lt;</span> preferences<span class="token punctuation">.</span>indexOf<span class="token punctuation">(</span>otherMan<span class="token punctuation">)</span>
        <span class="token keyword">case</span> _ <span class="token keyword">=&gt;</span> <span class="token boolean">true</span> <span class="token comment">//always prefer any man over nobody</span>
      <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">def</span> findStableMatches<span class="token punctuation">(</span>men<span class="token operator">:</span> Man<span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Unit</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
    bachelors <span class="token operator">=</span> men<span class="token punctuation">.</span>to<span class="token punctuation">[</span>Queue<span class="token punctuation">]</span>
    <span class="token keyword">while</span> <span class="token punctuation">(</span>bachelors<span class="token punctuation">.</span>nonEmpty<span class="token punctuation">)</span>
      bachelors<span class="token punctuation">.</span>dequeue<span class="token punctuation">.</span>propose<span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">object</span> StableMarriageExample <span class="token punctuation">{</span>

  <span class="token keyword">val</span> a <span class="token operator">=</span> StableMarriage<span class="token punctuation">.</span>Man<span class="token punctuation">(</span><span class="token string">&quot;Adam&quot;</span><span class="token punctuation">)</span>
  <span class="token keyword">val</span> b <span class="token operator">=</span> StableMarriage<span class="token punctuation">.</span>Man<span class="token punctuation">(</span><span class="token string">&quot;Bart&quot;</span><span class="token punctuation">)</span>
  <span class="token keyword">val</span> c <span class="token operator">=</span> StableMarriage<span class="token punctuation">.</span>Man<span class="token punctuation">(</span><span class="token string">&quot;Colm&quot;</span><span class="token punctuation">)</span>
  <span class="token keyword">val</span> x <span class="token operator">=</span> StableMarriage<span class="token punctuation">.</span>Woman<span class="token punctuation">(</span><span class="token string">&quot;Xena&quot;</span><span class="token punctuation">)</span>
  <span class="token keyword">val</span> y <span class="token operator">=</span> StableMarriage<span class="token punctuation">.</span>Woman<span class="token punctuation">(</span><span class="token string">&quot;Yeva&quot;</span><span class="token punctuation">)</span>
  <span class="token keyword">val</span> z <span class="token operator">=</span> StableMarriage<span class="token punctuation">.</span>Woman<span class="token punctuation">(</span><span class="token string">&quot;Zara&quot;</span><span class="token punctuation">)</span>

  a<span class="token punctuation">.</span>preferences <span class="token operator">=</span> List<span class="token punctuation">(</span>y<span class="token punctuation">,</span> x<span class="token punctuation">,</span> z<span class="token punctuation">)</span>
  b<span class="token punctuation">.</span>preferences <span class="token operator">=</span> List<span class="token punctuation">(</span>y<span class="token punctuation">,</span> z<span class="token punctuation">,</span> x<span class="token punctuation">)</span>
  c<span class="token punctuation">.</span>preferences <span class="token operator">=</span> List<span class="token punctuation">(</span>x<span class="token punctuation">,</span> z<span class="token punctuation">,</span> y<span class="token punctuation">)</span>
  x<span class="token punctuation">.</span>preferences <span class="token operator">=</span> List<span class="token punctuation">(</span>b<span class="token punctuation">,</span> a<span class="token punctuation">,</span> c<span class="token punctuation">)</span>
  y<span class="token punctuation">.</span>preferences <span class="token operator">=</span> List<span class="token punctuation">(</span>c<span class="token punctuation">,</span> a<span class="token punctuation">,</span> b<span class="token punctuation">)</span>
  z<span class="token punctuation">.</span>preferences <span class="token operator">=</span> List<span class="token punctuation">(</span>a<span class="token punctuation">,</span> c<span class="token punctuation">,</span> b<span class="token punctuation">)</span>


  <span class="token keyword">def</span> main<span class="token punctuation">(</span>args<span class="token operator">:</span> Array<span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Unit</span> <span class="token operator">=</span> <span class="token punctuation">{</span>

    StableMarriage<span class="token punctuation">.</span>findStableMatches<span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> c<span class="token punctuation">)</span>

    List<span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> z<span class="token punctuation">)</span><span class="token punctuation">.</span>foreach<span class="token punctuation">(</span>
      w <span class="token keyword">=&gt;</span> Console<span class="token punctuation">.</span>println<span class="token punctuation">(</span>
        w<span class="token punctuation">.</span>name
          <span class="token operator">+</span> <span class="token string">&quot; is married to &quot;</span>
          <span class="token operator">+</span> w<span class="token punctuation">.</span>fiance<span class="token punctuation">.</span>getOrElse<span class="token punctuation">(</span>StableMarriage<span class="token punctuation">.</span>Man<span class="token punctuation">(</span><span class="token string">&quot;Nobody&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre>
</div></div></div>

<script>
MathJax.Hub.Queue(["Typeset",MathJax.Hub]);
</script>

<h2 id="license">License</h2>
<h5 id="code-examples">Code Examples</h5>
<p>The code examples are licensed under the MIT license (found in <a href="https://github.com/algorithm-archivists/algorithm-archive/blob/master/LICENSE.md" target="_blank">LICENSE.md</a>).</p>
<h5 id="text">Text</h5>
<p>The text of this chapter was written by <a href="https://github.com/leios" target="_blank">James Schloss</a> and is licensed under the <a href="https://creativecommons.org/licenses/by-sa/4.0/legalcode" target="_blank">Creative Commons Attribution-ShareAlike 4.0 International License</a>.</p>
<p><a href="https://creativecommons.org/licenses/by-sa/4.0/" target="_blank"><p><img class="center" src="../cc/CC-BY-SA_icon.svg"></p></a></p>
<h5 id="pull-requests">Pull Requests</h5>
<p>After initial licensing (<a href="https://github.com/algorithm-archivists/algorithm-archive/pull/560" target="_blank">#560</a>), the following pull requests have modified the text or graphics of this chapter:</p>
<ul>
<li>none</li>
</ul>

                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="../decision_problems/decision_problems.html" class="navigation navigation-prev " aria-label="Previous page: Decision Problems">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
                <a href="../differential_equations/differential_equations.html" class="navigation navigation-next " aria-label="Next page: Differential Equation Solvers">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"Stable Marriage Problem","level":"1.13.1","depth":2,"next":{"title":"Differential Equation Solvers","level":"1.14","depth":1,"path":"contents/differential_equations/differential_equations.md","ref":"contents/differential_equations/differential_equations.md","articles":[{"title":"Forward Euler Method","level":"1.14.1","depth":2,"path":"contents/forward_euler_method/forward_euler_method.md","ref":"contents/forward_euler_method/forward_euler_method.md","articles":[]}]},"previous":{"title":"Decision Problems","level":"1.13","depth":1,"path":"contents/decision_problems/decision_problems.md","ref":"contents/decision_problems/decision_problems.md","articles":[{"title":"Stable Marriage Problem","level":"1.13.1","depth":2,"path":"contents/stable_marriage_problem/stable_marriage_problem.md","ref":"contents/stable_marriage_problem/stable_marriage_problem.md","articles":[]}]},"dir":"ltr"},"config":{"plugins":["mathjax@https://github.com/algorithm-archivists/plugin-mathjax","bibtex-cite","wordcount","api-language-selector@https://github.com/algorithm-archivists/gitbook-plugin-api-language-selector.git","include-codeblock","bulk-redirect","prism","-highlight"],"root":"./","styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"pluginsConfig":{"api-language-selector":{"languages":[{"lang":"jl","name":"Julia","default":true},{"lang":"bash","name":"Bash"},{"lang":"cs","name":"C#"},{"lang":"cpp","name":"C++"},{"lang":"c","name":"C"},{"lang":"c8","name":"chip-8"},{"lang":"py","name":"Python"},{"lang":"js","name":"JavaScript"},{"lang":"scratch","name":"Scratch"},{"lang":"hs","name":"Haskell"},{"lang":"rs","name":"Rust"},{"lang":"ml","name":"OCaml"},{"lang":"java","name":"Java"},{"lang":"clj","name":"Clojure"},{"lang":"elm","name":"Elm"},{"lang":"LabVIEW","name":"LabVIEW"},{"lang":"d","name":"D"},{"lang":"go","name":"Go"},{"lang":"swift","name":"Swift"},{"lang":"racket","name":"Racket"},{"lang":"m","name":"Matlab"},{"lang":"r","name":"R"},{"lang":"ti83b","name":"TI-83 Basic"},{"lang":"lua","name":"Lua"},{"lang":"crystal","name":"Crystal"},{"lang":"php","name":"PHP"},{"lang":"lisp","name":"Common Lisp"},{"lang":"nim","name":"Nim"},{"lang":"asm-x64","name":"X86-64 Assembly"},{"lang":"f90","name":"Fortran90"},{"lang":"factor","name":"Factor"},{"lang":"ws","name":"Whitespace"},{"lang":"scala","name":"Scala"},{"lang":"emojic","name":"Emojicode"},{"lang":"lolcode","name":"LOLCODE"},{"lang":"piet","name":"Piet"},{"lang":"ss","name":"Scheme"},{"lang":"ps1","name":"PowerShell"},{"lang":"v","name":"Vlang"},{"lang":"coffee","name":"CoffeeScript"},{"lang":"kotlin","name":"Kotlin"},{"lang":"ts","name":"TypeScript"},{"lang":"vim","name":"VimL"},{"lang":"coco","name":"Coconut"},{"lang":"dart","name":"Dart"}]},"prism":{"lang":{"asm-x64":"nasm"},"ignore":["emojicode","text"],"css":["prismjs/themes/prism-tomorrow.css"]},"wordcount":{},"search":{},"lunr":{"maxIndexSize":1000000,"ignoreSpecialCharacters":false},"fontsettings":{"theme":"white","family":"sans","size":2},"bulk-redirect":{"basepath":"/","redirectsFile":"redirects.json"},"bibtex-cite":{},"mathjax":{"forceSVG":false,"version":"2.6.1"},"include-codeblock":{"check":false,"edit":false,"lang":"","fixlang":true,"template":"default","theme":"chrome","unindent":true},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false}},"theme":"default","lunr":{"maxIndexSize":1000000000},"honkit":">= 3.0.0","pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56},"embedFonts":false},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"bibCount":0,"variables":{},"title":"Arcane Algorithm Archive","bib":[{"citationKey":"CT1965","entryType":"ARTICLE","entryTags":{"TITLE":"An algorithm for the machine calculation of complex Fourier series","AUTHOR":"Cooley, James W and Tukey, John W","JOURNAL":"Mathematics of computation","VOLUME":"19","NUMBER":"90","PAGES":"297--301","YEAR":"1965","PUBLISHER":"JSTOR"}},{"citationKey":"JM1973","entryType":"ARTICLE","entryTags":{"TITLE":"On the identification of the convex hull of a finite set of points in the plane","AUTHOR":"Jarvis, Ray A","JOURNAL":"Information processing letters","VOLUME":"2","NUMBER":"1","PAGES":"18--21","YEAR":"1973","PUBLISHER":"Elsevier"}},{"citationKey":"GS1972","entryType":"ARTICLE","entryTags":{"TITLE":"An efficient algorithm for determining the convex hull of a finite planar set","AUTHOR":"Graham, Ronald L","JOURNAL":"Information processing letters","VOLUME":"1","NUMBER":"4","PAGES":"132--133","YEAR":"1972","PUBLISHER":"Elsevier"}},{"citationKey":"GNUPLOT","entryType":"MISC","entryTags":{"TITLE":"Gnuplot 5.0: An Interactive Plotting Program, Official Gnuplot Documentation","AUTHOR":"Williams, T and Kelley, C","YEAR":"2015"}},{"citationKey":"BEDE725","entryType":"BOOK","entryTags":{"TITLE":"Bede, the Reckoning of Time","AUTHOR":"Venerabilis, Beda and others","VOLUME":"29","YEAR":"1999","PUBLISHER":"Liverpool University Press"}},{"citationKey":"DICTCOMPUTUS","entryType":"MISC","entryTags":{"TITLE":"Dictionary.com definition of computus","URL":"https://www.merriam-webster.com/dictionary/computus","YEAR":"2020"}},{"citationKey":"COMPUTUS1876","entryType":"ARTICLE","entryTags":{"TITLE":"To find Easter: a new York correspondent sends us the following","AUTHOR":"unknown","JOURNAL":"Nature","YEAR":"1876"}},{"citationKey":"BIEN2004","entryType":"ARTICLE","entryTags":{"TITLE":"Gauss and beyond: The making of Easter algorithms","AUTHOR":"Bien, Reinhold","JOURNAL":"Archive for history of exact sciences","VOLUME":"58","NUMBER":"5","PAGES":"439--452","YEAR":"2004","PUBLISHER":"Springer"}},{"citationKey":"SERVOIS","entryType":"INPROCEEDINGS","entryTags":{"TITLE":"84 Calendrier","AUTHOR":"Servois, M","BOOKTITLE":"Annales de MathÃ©matiques pures et appliquÃ©es","VOLUME":"4","NUMBER":"1813-1814","PAGES":"84--90"}},{"citationKey":"STANDISH2004","entryType":"ARTICLE","entryTags":{"TITLE":"The astronomical unit now","AUTHOR":"Standish, EM","JOURNAL":"Proceedings of the International Astronomical Union","VOLUME":"2004","NUMBER":"IAUC196","PAGES":"163--179","YEAR":"2004","PUBLISHER":"Cambridge University Press"}},{"citationKey":"LUNAR_MONTH_WIKI","entryType":"MISC","entryTags":{"TITLE":"Wikipedia: Lunar Month","URL":"https://en.wikipedia.org/wiki/Lunar_month","YEAR":"2020"}},{"citationKey":"SELF-SIMILAR","entryType":"MISC","entryTags":{"TITLE":"Wikipedia: Self-similarity","URL":"https://en.wikipedia.org/wiki/Self-similarity","YEAR":"2019"}},{"citationKey":"HAUSDORFF","entryType":"MISC","entryTags":{"TITLE":"Wikipedia: Hausdorff dimension","URL":"https://en.wikipedia.org/wiki/Hausdorff_dimension","YEAR":"2019"}},{"citationKey":"3B1BFRACTAL","entryType":"MISC","entryTags":{"AUTHOR":"Sanderson, G","TITLE":"3blue1brown: Fractals are typically not self-similar","URL":"https://www.youtube.com/watch?v=gB9n2gHsHN4","YEAR":"2017"}},{"citationKey":"MANDELBROT1983FRACTAL","entryType":"BOOK","entryTags":{"TITLE":"The fractal geometry of nature","AUTHOR":"Mandelbrot, Benoit B","VOLUME":"173","YEAR":"1983","PUBLISHER":"WH freeman New York"}},{"citationKey":"MANDELBROT1967LONG","entryType":"ARTICLE","entryTags":{"TITLE":"How long is the coast of Britain? Statistical self-similarity and fractional dimension","AUTHOR":"Mandelbrot, Benoit","JOURNAL":"science","VOLUME":"156","NUMBER":"3775","PAGES":"636--638","YEAR":"1967","PUBLISHER":"American Association for the Advancement of Science"}},{"citationKey":"JAMPOUR2010NEW","entryType":"ARTICLE","entryTags":{"TITLE":"A new fast technique for fingerprint identification with fractal and chaos game theory","AUTHOR":"Jampour, Mahdi and Yaghoobi, Mahdi and Ashourzadeh, Maryam and Soleimani, Adel","JOURNAL":"Fractals","VOLUME":"18","NUMBER":"03","PAGES":"293--300","YEAR":"2010","PUBLISHER":"World Scientific"}},{"citationKey":"FRACTAL-COMPRESSION","entryType":"MISC","entryTags":{"TITLE":"Wikipedia: Fractal Compression","URL":"https://en.wikipedia.org/wiki/Fractal_compression","YEAR":"2019"}},{"citationKey":"SAUPE1994REVIEW","entryType":"ARTICLE","entryTags":{"TITLE":"A review of the fractal image compression literature","AUTHOR":"Saupe, Dietmar and Hamzaoui, Raouf","JOURNAL":"ACM SIGGRAPH Computer Graphics","VOLUME":"28","NUMBER":"4","PAGES":"268--276","YEAR":"1994","PUBLISHER":"ACM"}},{"citationKey":"GNEITING2012ESTIMATORS","entryType":"ARTICLE","entryTags":{"TITLE":"Estimators of fractal dimension: Assessing the roughness of time series and spatial data","AUTHOR":"Gneiting, Tilmann and Å evÄÃ­kovÃ¡, Hana and Percival, Donald B","JOURNAL":"Statistical Science","PAGES":"247--277","YEAR":"2012","PUBLISHER":"JSTOR"}},{"citationKey":"HUTCHINSON1981FRACTALS","entryType":"ARTICLE","entryTags":{"TITLE":"Fractals and self similarity","AUTHOR":"Hutchinson, John E","JOURNAL":"Indiana University Mathematics Journal","VOLUME":"30","NUMBER":"5","PAGES":"713--747","YEAR":"1981","PUBLISHER":"JSTOR"}},{"citationKey":"HUTCHINSON-OPERATOR","entryType":"MISC","entryTags":{"TITLE":"Wikipedia: Hutchinson Operator","URL":"https://en.wikipedia.org/wiki/Hutchinson_operator","YEAR":"2019"}},{"citationKey":"CHAOS-GAME","entryType":"MISC","entryTags":{"TITLE":"Wikipedia: Chaos Game","URL":"https://en.wikipedia.org/wiki/Chaos_game","YEAR":"2019"}},{"citationKey":"CHAOS-GAME-WOLF","entryType":"MISC","entryTags":{"TITLE":"Wolfram: Chaos Game","URL":"http://mathworld.wolfram.com/ChaosGame.html","YEAR":"2019"}},{"citationKey":"BARNSLEY2014FRACTALS","entryType":"BOOK","entryTags":{"TITLE":"Fractals everywhere","AUTHOR":"Barnsley, Michael F","YEAR":"2014","PUBLISHER":"Academic press"}},{"citationKey":"HSV","entryType":"MISC","entryTags":{"TITLE":"Wikipedia: HSL and HSV","URL":"https://en.wikipedia.org/wiki/HSL_and_HSV","YEAR":"2020"}},{"citationKey":"SCHLOSS2019","entryType":"ARTICLE","entryTags":{"TITLE":"Massively parallel split-step Fourier techniques for simulating quantum systems on graphics processing units","AUTHOR":"Schloss, James","YEAR":"2019"}},{"citationKey":"PETHICK2008","entryType":"BOOK","entryTags":{"TITLE":"Bose--Einstein condensation in dilute gases","AUTHOR":"Pethick, Christopher J and Smith, Henrik","YEAR":"2008","PUBLISHER":"Cambridge university press"}},{"citationKey":"WEGERT2012","entryType":"BOOK","entryTags":{"TITLE":"Visual complex functions: an introduction with phase portraits","AUTHOR":"Wegert, Elias","YEAR":"2012","PUBLISHER":"Springer Science \\& Business Media"}},{"citationKey":"POELKEDOMAIN","entryType":"ARTICLE","entryTags":{"TITLE":"Domain Coloring of Complex Functions","AUTHOR":"Poelke, Konstantin and Polthier, Konrad"}},{"citationKey":"LUNDMARK2004","entryType":"ARTICLE","entryTags":{"TITLE":"Visualizing complex analytic functions using domain coloring","AUTHOR":"Lundmark, Hans","JOURNAL":"Recuperado el","VOLUME":"24","YEAR":"2004"}},{"citationKey":"GIMP_BUCKET","entryType":"MISC","entryTags":{"TITLE":"Bucket Fill in Gimp","URL":"https://docs.gimp.org/2.10/en/gimp-tool-bucket-fill.html","YEAR":"2020"}},{"citationKey":"TORBERT2016","entryType":"BOOK","entryTags":{"TITLE":"Applied computer science","AUTHOR":"Torbert, Shane","YEAR":"2016","PAGES":"158","PUBLISHER":"Springer"}},{"citationKey":"CANNY1986COMPUTATIONAL","entryType":"ARTICLE","entryTags":{"TITLE":"A computational approach to edge detection","AUTHOR":"Canny, John","JOURNAL":"IEEE Transactions on pattern analysis and machine intelligence","NUMBER":"6","PAGES":"679--698","YEAR":"1986","PUBLISHER":"Ieee"}},{"citationKey":"MORRIS1978COUNTING","entryType":"ARTICLE","entryTags":{"TITLE":"Counting large numbers of events in small registers","AUTHOR":"Morris, R","JOURNAL":"Communications of the ACM","VOLUME":"21","NUMBER":"10","PAGES":"840--842","YEAR":"1978","PUBLISHER":"ACM New York, NY, USA"}},{"citationKey":"FLAJOLET1985APPROXIMATE","entryType":"ARTICLE","entryTags":{"TITLE":"Approximate counting: a detailed analysis","AUTHOR":"Flajolet, P","JOURNAL":"BIT Numerical Mathematics","VOLUME":"25","NUMBER":"1","PAGES":"113--134","YEAR":"1985","PUBLISHER":"Springer"}},{"citationKey":"ARPIT_COUNTING","entryType":"MISC","entryTags":{"TITLE":"Morris's Algorithm for Approximate Counting","AUTHOR":"Bhayani, A","URL":"https://arpitbhayani.me/blogs/morris-counter","YEAR":"2020"}},{"citationKey":"GREGGUNDERSON_COUNTING","entryType":"MISC","entryTags":{"TITLE":"Approximate Counting with Morris's Algorithm","AUTHOR":"Gundersen, G","URL":"http://gregorygundersen.com/blog/2019/11/11/morris-algorithm/","YEAR":"2019"}},{"citationKey":"3B1B_FINGER_COUNT","entryType":"MISC","entryTags":{"TITLE":"How to count to 1000 on two hands","AUTHOR":"Sanderson, G","URL":"https://youtu.be/1SMmc9gQmHQ","YEAR":"2015"}}],"gitbook":"*"},"file":{"path":"contents/stable_marriage_problem/stable_marriage_problem.md","mtime":"2021-10-18T15:45:19.435Z","type":"markdown"},"gitbook":{"version":"3.6.22","time":"2021-10-18T15:45:48.782Z"},"basePath":"../..","book":{"language":""}});
        });
    </script>
</div>

        
    <noscript>
        <style>
            .honkit-cloak {
                display: block !important;
            }
        </style>
    </noscript>
    <script>
        // Restore sidebar state as critical path for prevent layout shift
        function __init__getSidebarState(defaultValue){
            var baseKey = "";
            var key = baseKey + ":sidebar";
            try {
                var value = localStorage[key];
                if (value === undefined) {
                    return defaultValue;
                }
                var parsed = JSON.parse(value);
                return parsed == null ? defaultValue : parsed;
            } catch (e) {
                return defaultValue;
            }
        }
        function __init__restoreLastSidebarState() {
            var isMobile = window.matchMedia("(max-width: 600px)").matches;
            if (isMobile) {
                // Init last state if not mobile
                return;
            }
            var sidebarState = __init__getSidebarState(true);
            var book = document.querySelector(".book");
            // Show sidebar if it enabled
            if (sidebarState && book) {
                book.classList.add("without-animation", "with-summary");
            }
        }

        try {
            __init__restoreLastSidebarState();
        } finally {
            var book = document.querySelector(".book");
            book.classList.remove("honkit-cloak");
        }
    </script>
    <script src="../../gitbook/gitbook.js"></script>
    <script src="../../gitbook/theme.js"></script>
    
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.6.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-mathjax/plugin.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-api-language-selector/api-language-selector.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-search/search-engine.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-search/search.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

    </body>
</html>

