
<!DOCTYPE HTML>
<html lang="" >
    <head>
        <meta charset="UTF-8">
        <title>Huffman Encoding Â· Arcane Algorithm Archive</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="HonKit 3.7.5">
        
        
        
    
    <link rel="stylesheet" href="../../gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-bibtex-cite/style.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-api-language-selector/api-language-selector.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-prism/prism-tomorrow.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-search/search.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
        <link rel="stylesheet" href="../../styles/website.css">
        
    
        
    
        
    
        
    
        
    
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../../gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="../../gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="../computer_graphics/computer_graphics.html" />
    
    
    <link rel="prev" href="../data_compression/data_compression.html" />
    

    </head>
    <body>
        
<div class="book honkit-cloak">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="Type to search" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        
    
        <li class="chapter " data-level="1.1" data-path="../../">
            
                <a href="../../">
            
                    
                    Algorithm Archive
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2" data-path="../introduction/introduction.html">
            
                <a href="../introduction/introduction.html">
            
                    
                    Introduction
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3" data-path="../how_to_contribute/how_to_contribute.html">
            
                <a href="../how_to_contribute/how_to_contribute.html">
            
                    
                    How To Contribute
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.1" data-path="../code_reviews/code_reviewers.html">
            
                <a href="../code_reviews/code_reviewers.html">
            
                    
                    Code Reviewers
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.4" data-path="../plotting/plotting.html">
            
                <a href="../plotting/plotting.html">
            
                    
                    Plotting
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.4.1" data-path="../domain_coloring/domain_coloring.html">
            
                <a href="../domain_coloring/domain_coloring.html">
            
                    
                    Domain Coloring
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.2" data-path="../IFS/IFS.html">
            
                <a href="../IFS/IFS.html">
            
                    
                    Iterated Function Systems
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.4.2.1" data-path="../barnsley/barnsley.html">
            
                <a href="../barnsley/barnsley.html">
            
                    
                    The Barnsley Fern
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.5" data-path="../data_structures/data_structures.html">
            
                <a href="../data_structures/data_structures.html">
            
                    
                    Data Structures
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.5.1" data-path="../stacks_and_queues/stacks_and_queues.html">
            
                <a href="../stacks_and_queues/stacks_and_queues.html">
            
                    
                    Stacks and Queues
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.6" data-path="../mathematical_background/mathematical_background.html">
            
                <a href="../mathematical_background/mathematical_background.html">
            
                    
                    Mathematical Background
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.6.1" data-path="../notation/notation.html">
            
                <a href="../notation/notation.html">
            
                    
                    Complexity Notation
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.2" data-path="../affine_transformations/affine_transformations.html">
            
                <a href="../affine_transformations/affine_transformations.html">
            
                    
                    Affine Transformations
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.3" data-path="../bitlogic/bitlogic.html">
            
                <a href="../bitlogic/bitlogic.html">
            
                    
                    Bit Logic
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.4" data-path="../taylor_series_expansion/taylor_series_expansion.html">
            
                <a href="../taylor_series_expansion/taylor_series_expansion.html">
            
                    
                    Taylor Series
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.5" data-path="../convolutions/convolutions.html">
            
                <a href="../convolutions/convolutions.html">
            
                    
                    Convolutions
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.6.5.1" data-path="../convolutions/1d/1d.html">
            
                <a href="../convolutions/1d/1d.html">
            
                    
                    Convolutions in 1D
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.5.2" data-path="../convolutions/multiplication/multiplication.html">
            
                <a href="../convolutions/multiplication/multiplication.html">
            
                    
                    Multiplication as a Convolution
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.5.3" data-path="../convolutions/2d/2d.html">
            
                <a href="../convolutions/2d/2d.html">
            
                    
                    Convolutions of Images (2D)
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.5.4" data-path="../convolutions/convolutional_theorem/convolutional_theorem.html">
            
                <a href="../convolutions/convolutional_theorem/convolutional_theorem.html">
            
                    
                    Convolutional Theorem
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.6.6" data-path="../box_muller/box_muller.html">
            
                <a href="../box_muller/box_muller.html">
            
                    
                    Box Muller Transform
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.6.6.1" data-path="../box_muller/box_muller_rejection.html">
            
                <a href="../box_muller/box_muller_rejection.html">
            
                    
                    How costly is rejection sampling?
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.6.7" data-path="../probability_distributions/distributions.html">
            
                <a href="../probability_distributions/distributions.html">
            
                    
                    Probability Distributions
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.7" data-path="../tree_traversal/tree_traversal.html">
            
                <a href="../tree_traversal/tree_traversal.html">
            
                    
                    Tree Traversal
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8" data-path="../euclidean_algorithm/euclidean_algorithm.html">
            
                <a href="../euclidean_algorithm/euclidean_algorithm.html">
            
                    
                    Euclidean Algorithm
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9" data-path="../monte_carlo_integration/monte_carlo_integration.html">
            
                <a href="../monte_carlo_integration/monte_carlo_integration.html">
            
                    
                    Monte Carlo
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.9.1" data-path="../metropolis/metropolis.html">
            
                <a href="../metropolis/metropolis.html">
            
                    
                    Metropolis
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.10" data-path="../matrix_methods/matrix_methods.html">
            
                <a href="../matrix_methods/matrix_methods.html">
            
                    
                    Matrix Methods
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.10.1" data-path="../gaussian_elimination/gaussian_elimination.html">
            
                <a href="../gaussian_elimination/gaussian_elimination.html">
            
                    
                    Gaussian Elimination
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.2" data-path="../thomas_algorithm/thomas_algorithm.html">
            
                <a href="../thomas_algorithm/thomas_algorithm.html">
            
                    
                    Thomas Algorithm
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.11" data-path="../computational_geometry/computational_geometry.html">
            
                <a href="../computational_geometry/computational_geometry.html">
            
                    
                    Computational Geometry
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.11.1" data-path="../gift_wrapping/gift_wrapping.html">
            
                <a href="../gift_wrapping/gift_wrapping.html">
            
                    
                    Gift Wrapping
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.11.1.1" data-path="../jarvis_march/jarvis_march.html">
            
                <a href="../jarvis_march/jarvis_march.html">
            
                    
                    Jarvis March
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.11.1.2" data-path="../graham_scan/graham_scan.html">
            
                <a href="../graham_scan/graham_scan.html">
            
                    
                    Graham Scan
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.12" data-path="../cooley_tukey/cooley_tukey.html">
            
                <a href="../cooley_tukey/cooley_tukey.html">
            
                    
                    FFT
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.13" data-path="../decision_problems/decision_problems.html">
            
                <a href="../decision_problems/decision_problems.html">
            
                    
                    Decision Problems
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.13.1" data-path="../stable_marriage_problem/stable_marriage_problem.html">
            
                <a href="../stable_marriage_problem/stable_marriage_problem.html">
            
                    
                    Stable Marriage Problem
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.14" data-path="../physics_solvers/physics_solvers.html">
            
                <a href="../physics_solvers/physics_solvers.html">
            
                    
                    Physics Solvers
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.14.1" data-path="../verlet_integration/verlet_integration.html">
            
                <a href="../verlet_integration/verlet_integration.html">
            
                    
                    Verlet Integration
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.14.2" data-path="../quantum_systems/quantum_systems.html">
            
                <a href="../quantum_systems/quantum_systems.html">
            
                    
                    Quantum Systems
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.14.2.1" data-path="../split-operator_method/split-operator_method.html">
            
                <a href="../split-operator_method/split-operator_method.html">
            
                    
                    Split-Operator Method
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.15" data-path="../data_compression/data_compression.html">
            
                <a href="../data_compression/data_compression.html">
            
                    
                    Data Compression
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter active" data-level="1.15.1" data-path="huffman_encoding.html">
            
                <a href="huffman_encoding.html">
            
                    
                    Huffman Encoding
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.16" data-path="../computer_graphics/computer_graphics.html">
            
                <a href="../computer_graphics/computer_graphics.html">
            
                    
                    Computer Graphics
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.16.1" data-path="../flood_fill/flood_fill.html">
            
                <a href="../flood_fill/flood_fill.html">
            
                    
                    Flood Fill
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.17" data-path="../quantum_information/quantum_information.html">
            
                <a href="../quantum_information/quantum_information.html">
            
                    
                    Quantum Information
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.18" data-path="../cryptography/cryptography.html">
            
                <a href="../cryptography/cryptography.html">
            
                    
                    Cryptography
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.19" data-path="../computus/computus.html">
            
                <a href="../computus/computus.html">
            
                    
                    Computus
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.20" data-path="../approximate_counting/approximate_counting.html">
            
                <a href="../approximate_counting/approximate_counting.html">
            
                    
                    Approximate Counting Algorithm
            
                </a>
            

            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://github.com/honkit/honkit" target="blank" class="gitbook-link">
            Published with HonKit
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href="../.." >Huffman Encoding</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <h1 id="huffman-encoding">Huffman Encoding</h1>
<p>If there were ever a data compression method to take the world by storm, it would be Huffman encoding.
In fact, this was the method that got me into computational methods to begin with.
I distinctly remember sitting in my data compression class and talking about the great information theorist Claude Shannon and Robert Fano, when suddenly my professor introduced a new kid to the mix: David Huffman.
He managed to rip the heart out of the methods described by leaders of the field and create a data compression method that was easier to understand and implement, while also providing more robust results, and apparently this was all done for a school project!</p>
<p>It was in that moment, I knew I would never amount to anything.
I have since accepted that fact and moved on.</p>
<p>Huffman encoding follows from the problem described in the <a href="../data_compression/data_compression.html">Data Compression</a> section.
We have a string that we want to encode into bits.
Huffman encoding ensures that our encoded bitstring is as small as possible without losing any information.
Because it is both lossless and guarantees the smallest possible bit length, it outright replaces both Shannon and Shannon-Fano encoding in most cases, which is a little weird because the method was devised while Huffman was taking a course from Fano, himself!</p>
<p>The idea is somewhat straightforward in principle, but a little difficult to code in practice.
By creating a binary tree of the input alphabet, every branch can be provided a unique bit representation simply by assigning a binary value to each child and reading to a character in a leaf node if starting from the root node.</p>
<p>So now the question is: how do we create a binary tree?
Well, here we build it from the bottom up like so:</p>
<ol>
<li>Order all characters according to the frequency they appear in the input bitstring, with the most frequent character at the top of the list. Be sure to keep track of the frequencies, too!</li>
<li>Add the smallest two values together to create a new node with a new frequency.</li>
<li>Keep doing step 2 until the tree is complete.</li>
<li>Read the tree backwards from the root node and concatenate the final bitstring codeword. Keep all codewords and put them into your final set of codewords (sometimes called a codebook)</li>
<li>Encode your phrase with the codebook.</li>
</ol>
<p>And that&apos;s it.
Here&apos;s an image of what this might look like for the phrase <code>bibbity_bobbity</code>:</p>
<p>
    <img class="center" src="res/huffman_tree.png" style="width:70%">
</p>

<p>This will create a codebook that looks like this:</p>
<table>
<thead>
<tr>
<th>Character</th>
<th>Bit Representation</th>
</tr>
</thead>
<tbody>
<tr>
<td><em>b</em></td>
<td>0</td>
</tr>
<tr>
<td><em>i</em></td>
<td>100</td>
</tr>
<tr>
<td><em>t</em></td>
<td>101</td>
</tr>
<tr>
<td><em>y</em></td>
<td>110</td>
</tr>
<tr>
<td><em>o</em></td>
<td>1110</td>
</tr>
<tr>
<td><em>_</em></td>
<td>1111</td>
</tr>
</tbody>
</table>
<p>and <code>bibbity_bobbity</code> becomes <code>01000010010111011110111000100101110</code>.
As mentioned this uses the minimum number of bits possible for encoding.
The fact that this algorithm is both conceptually simple and provably useful is rather extraordinary to me and is why Huffman encoding will always hold a special place in my heart.</p>
<h2 id="video-explanation">Video Explanation</h2>
<p>Here is a quick video explanation for Huffman encoding:</p>
<div style="text-align:center">
<iframe width="560" height="315" src="https://www.youtube-nocookie.com/embed/wHyUxTc2Ohk" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
</div>

<h2 id="example-code">Example Code</h2>
<p>In code, this can be a little tricky. It requires a method to continually sort the nodes as you add more and more nodes to the system.
The most straightforward way to do this in some languages is with a priority queue, but depending on the language, this might be more or less appropriate.
In addition, to read the tree backwards, some sort of <a href="../tree_traversal/tree_traversal.html">Depth First Search</a> needs to be implemented.
Whether you use a stack or straight-up recursion also depends on the language, but the recursive method is a little easier to understand in most cases.</p>
<div class="code-method"><div class="code-method-definition"></div><div class="code-method-code"><div class="code-method-sample" data-lang="jl" data-name="Julia"><pre class="language-"><code class="lang-julia"><span class="token keyword">using</span> Test

<span class="token comment"># This is for the PriorityQueue</span>
<span class="token keyword">using</span> DataStructures

<span class="token keyword">struct</span> Leaf
    weight<span class="token punctuation">::</span>Int64
    key<span class="token punctuation">::</span>Char
<span class="token keyword">end</span>

<span class="token keyword">struct</span> Branch
    right<span class="token punctuation">::</span>Union<span class="token punctuation">{</span>Leaf<span class="token punctuation">,</span> Branch<span class="token punctuation">}</span>
    left<span class="token punctuation">::</span>Union<span class="token punctuation">{</span>Leaf<span class="token punctuation">,</span> Branch<span class="token punctuation">}</span>
    weight<span class="token punctuation">::</span>Int64
<span class="token keyword">end</span>

<span class="token keyword">const</span> Node <span class="token operator">=</span> Union<span class="token punctuation">{</span>Leaf<span class="token punctuation">,</span> Branch<span class="token punctuation">}</span>

<span class="token keyword">function</span> codebook_recurse<span class="token operator">!</span><span class="token punctuation">(</span>leaf<span class="token punctuation">::</span>Leaf<span class="token punctuation">,</span> code<span class="token punctuation">::</span>String<span class="token punctuation">,</span>
                          dict<span class="token punctuation">::</span>Dict<span class="token punctuation">{</span>Char<span class="token punctuation">,</span>String<span class="token punctuation">}</span><span class="token punctuation">)</span>
    dict<span class="token punctuation">[</span>leaf<span class="token punctuation">.</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> code
<span class="token keyword">end</span>

<span class="token keyword">function</span> codebook_recurse<span class="token operator">!</span><span class="token punctuation">(</span>branch<span class="token punctuation">::</span>Branch<span class="token punctuation">,</span> code<span class="token punctuation">::</span>String<span class="token punctuation">,</span>
                          dict<span class="token punctuation">::</span>Dict<span class="token punctuation">{</span>Char<span class="token punctuation">,</span>String<span class="token punctuation">}</span><span class="token punctuation">)</span>
    codebook_recurse<span class="token operator">!</span><span class="token punctuation">(</span>branch<span class="token punctuation">.</span>left<span class="token punctuation">,</span> string<span class="token punctuation">(</span>code<span class="token punctuation">,</span> <span class="token string">&quot;1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> dict<span class="token punctuation">)</span>
    codebook_recurse<span class="token operator">!</span><span class="token punctuation">(</span>branch<span class="token punctuation">.</span>right<span class="token punctuation">,</span> string<span class="token punctuation">(</span>code<span class="token punctuation">,</span> <span class="token string">&quot;0&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> dict<span class="token punctuation">)</span>
<span class="token keyword">end</span>

<span class="token comment"># This will depth-first search through the tree</span>
<span class="token comment"># to create bitstrings for each character.</span>
<span class="token comment"># Note: Any depth-first search method will work</span>
<span class="token comment"># This outputs encoding Dict to be used for encoding</span>
<span class="token keyword">function</span> create_codebook<span class="token punctuation">(</span>n<span class="token punctuation">::</span>Node<span class="token punctuation">)</span>
    codebook <span class="token operator">=</span> Dict<span class="token punctuation">{</span>Char<span class="token punctuation">,</span>String<span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> isa<span class="token punctuation">(</span>n<span class="token punctuation">,</span> Leaf<span class="token punctuation">)</span>
        codebook<span class="token punctuation">[</span>n<span class="token punctuation">.</span>key<span class="token punctuation">]</span><span class="token operator">=</span><span class="token string">&quot;0&quot;</span>
    <span class="token keyword">else</span>
        codebook_recurse<span class="token operator">!</span><span class="token punctuation">(</span>n<span class="token punctuation">,</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span> codebook<span class="token punctuation">)</span>
    <span class="token keyword">end</span>
    <span class="token keyword">return</span> codebook
<span class="token keyword">end</span>

<span class="token comment"># This outputs huffman tree to generate dictionary for encoding</span>
<span class="token keyword">function</span> create_tree<span class="token punctuation">(</span>phrase<span class="token punctuation">::</span>String<span class="token punctuation">)</span>

    <span class="token comment"># creating weights</span>
    weights <span class="token operator">=</span> PriorityQueue<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> phrase
        temp_string <span class="token operator">=</span> string<span class="token punctuation">(</span>i<span class="token punctuation">)</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>haskey<span class="token punctuation">(</span>weights<span class="token punctuation">,</span> temp_string<span class="token punctuation">)</span><span class="token punctuation">)</span>
            weights<span class="token punctuation">[</span>temp_string<span class="token punctuation">]</span> <span class="token operator">+=</span> <span class="token number">1</span>
        <span class="token keyword">else</span>
            weights<span class="token punctuation">[</span>temp_string<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1</span>
        <span class="token keyword">end</span>
    <span class="token keyword">end</span>

    <span class="token comment"># Creating all nodes to iterate through</span>
    nodes <span class="token operator">=</span> PriorityQueue<span class="token punctuation">{</span>Node<span class="token punctuation">,</span> Int64<span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">while</span><span class="token punctuation">(</span>length<span class="token punctuation">(</span>weights<span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span>
        weight <span class="token operator">=</span> peek<span class="token punctuation">(</span>weights<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span>
        key <span class="token operator">=</span> dequeue<span class="token operator">!</span><span class="token punctuation">(</span>weights<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>
        temp_node <span class="token operator">=</span> Leaf<span class="token punctuation">(</span>weight<span class="token punctuation">,</span> key<span class="token punctuation">)</span>
        enqueue<span class="token operator">!</span><span class="token punctuation">(</span>nodes<span class="token punctuation">,</span> temp_node<span class="token punctuation">,</span> weight<span class="token punctuation">)</span>
    <span class="token keyword">end</span>

    <span class="token keyword">while</span><span class="token punctuation">(</span>length<span class="token punctuation">(</span>nodes<span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">1</span><span class="token punctuation">)</span>
        node1 <span class="token operator">=</span> dequeue<span class="token operator">!</span><span class="token punctuation">(</span>nodes<span class="token punctuation">)</span>
        node2 <span class="token operator">=</span> dequeue<span class="token operator">!</span><span class="token punctuation">(</span>nodes<span class="token punctuation">)</span>
        temp_node <span class="token operator">=</span> Branch<span class="token punctuation">(</span>node1<span class="token punctuation">,</span> node2<span class="token punctuation">,</span> node1<span class="token punctuation">.</span>weight <span class="token operator">+</span> node2<span class="token punctuation">.</span>weight<span class="token punctuation">)</span>
        enqueue<span class="token operator">!</span><span class="token punctuation">(</span>nodes<span class="token punctuation">,</span> temp_node<span class="token punctuation">,</span> temp_node<span class="token punctuation">.</span>weight<span class="token punctuation">)</span>
    <span class="token keyword">end</span>

    huffman_tree <span class="token operator">=</span> dequeue<span class="token operator">!</span><span class="token punctuation">(</span>nodes<span class="token punctuation">)</span>
    <span class="token keyword">return</span> huffman_tree

<span class="token keyword">end</span>

<span class="token keyword">function</span> encode<span class="token punctuation">(</span>codebook<span class="token punctuation">::</span>Dict<span class="token punctuation">{</span>Char<span class="token punctuation">,</span> String<span class="token punctuation">}</span><span class="token punctuation">,</span> phrase<span class="token punctuation">::</span>String<span class="token punctuation">)</span>
    final_bitstring <span class="token operator">=</span> <span class="token string">&quot;&quot;</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> phrase
        final_bitstring <span class="token operator">=</span> final_bitstring <span class="token operator">*</span> codebook<span class="token punctuation">[</span>i<span class="token punctuation">]</span>
    <span class="token keyword">end</span>

    <span class="token keyword">return</span> final_bitstring
<span class="token keyword">end</span>

<span class="token keyword">function</span> decode<span class="token punctuation">(</span>huffman_tree<span class="token punctuation">::</span>Node<span class="token punctuation">,</span> bitstring<span class="token punctuation">::</span>String<span class="token punctuation">)</span>
    current <span class="token operator">=</span> huffman_tree
    final_string <span class="token operator">=</span> <span class="token string">&quot;&quot;</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> bitstring
        <span class="token keyword">if</span> isa<span class="token punctuation">(</span>huffman_tree<span class="token punctuation">,</span> Branch<span class="token punctuation">)</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>i <span class="token operator">==</span> <span class="token char">&apos;1&apos;</span><span class="token punctuation">)</span>
                current <span class="token operator">=</span> current<span class="token punctuation">.</span>left
            <span class="token keyword">else</span>
                current <span class="token operator">=</span> current<span class="token punctuation">.</span>right
            <span class="token keyword">end</span>

            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>isa<span class="token punctuation">(</span>current<span class="token punctuation">,</span> Branch<span class="token punctuation">)</span><span class="token punctuation">)</span>
                final_string <span class="token operator">*=</span> string<span class="token punctuation">(</span>current<span class="token punctuation">.</span>key<span class="token punctuation">)</span>
                current <span class="token operator">=</span> huffman_tree
            <span class="token keyword">end</span>
        <span class="token keyword">else</span>
            final_string <span class="token operator">*=</span> string<span class="token punctuation">(</span>huffman_tree<span class="token punctuation">.</span>key<span class="token punctuation">)</span>
        <span class="token keyword">end</span>
    <span class="token keyword">end</span>

    <span class="token keyword">return</span> final_string
<span class="token keyword">end</span>

<span class="token keyword">function</span> two_pass_huffman<span class="token punctuation">(</span>phrase<span class="token punctuation">::</span>String<span class="token punctuation">)</span>
    huffman_tree <span class="token operator">=</span> create_tree<span class="token punctuation">(</span>phrase<span class="token punctuation">)</span>
    codebook <span class="token operator">=</span> create_codebook<span class="token punctuation">(</span>huffman_tree<span class="token punctuation">)</span>
    bitstring <span class="token operator">=</span> encode<span class="token punctuation">(</span>codebook<span class="token punctuation">,</span> phrase<span class="token punctuation">)</span>
    final_string <span class="token operator">=</span> decode<span class="token punctuation">(</span>huffman_tree<span class="token punctuation">,</span> bitstring<span class="token punctuation">)</span>
    <span class="token keyword">return</span> final_string
<span class="token keyword">end</span>

@testset <span class="token string">&quot;b-string tests&quot;</span> <span class="token keyword">begin</span>
    @test two_pass_huffman<span class="token punctuation">(</span><span class="token string">&quot;b&quot;</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">&quot;b&quot;</span>
    @test two_pass_huffman<span class="token punctuation">(</span><span class="token string">&quot;bbbbbbbb&quot;</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">&quot;bbbbbbbb&quot;</span>
    @test two_pass_huffman<span class="token punctuation">(</span><span class="token string">&quot;bibbity bobbity&quot;</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">&quot;bibbity bobbity&quot;</span>
<span class="token keyword">end</span>
</code></pre>
</div><div class="code-method-sample" data-lang="rs" data-name="Rust"><pre class="language-"><code class="lang-rust"><span class="token keyword">extern</span> <span class="token keyword">crate</span> <span class="token module-declaration namespace">itertools</span><span class="token punctuation">;</span>

<span class="token keyword">use</span> <span class="token namespace">std<span class="token punctuation">::</span>cmp<span class="token punctuation">::</span></span><span class="token punctuation">{</span><span class="token class-name">Ord</span><span class="token punctuation">,</span> <span class="token class-name">Ordering</span><span class="token punctuation">,</span> <span class="token class-name">PartialOrd</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token namespace">std<span class="token punctuation">::</span>collections<span class="token punctuation">::</span></span><span class="token punctuation">{</span><span class="token class-name">BinaryHeap</span><span class="token punctuation">,</span> <span class="token class-name">HashMap</span><span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">use</span> <span class="token namespace">itertools<span class="token punctuation">::</span></span><span class="token class-name">Itertools</span><span class="token punctuation">;</span>

<span class="token attribute attr-name">#[derive(Debug)]</span>
<span class="token keyword">enum</span> <span class="token type-definition class-name">HuffmanTree</span> <span class="token punctuation">{</span>
    <span class="token class-name">Branch</span> <span class="token punctuation">{</span>
        count<span class="token punctuation">:</span> <span class="token keyword">i32</span><span class="token punctuation">,</span>
        left<span class="token punctuation">:</span> <span class="token class-name">Box</span><span class="token operator">&lt;</span><span class="token class-name">HuffmanTree</span><span class="token operator">&gt;</span><span class="token punctuation">,</span>
        right<span class="token punctuation">:</span> <span class="token class-name">Box</span><span class="token operator">&lt;</span><span class="token class-name">HuffmanTree</span><span class="token operator">&gt;</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token class-name">Leaf</span> <span class="token punctuation">{</span>
        count<span class="token punctuation">:</span> <span class="token keyword">i32</span><span class="token punctuation">,</span>
        value<span class="token punctuation">:</span> <span class="token keyword">char</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>

<span class="token keyword">impl</span> <span class="token class-name">PartialEq</span> <span class="token keyword">for</span> <span class="token class-name">HuffmanTree</span> <span class="token punctuation">{</span>
    <span class="token keyword">fn</span> <span class="token function-definition function">eq</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">,</span> other<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token keyword">Self</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token keyword">bool</span> <span class="token punctuation">{</span>
        <span class="token keyword">self</span><span class="token punctuation">.</span><span class="token function">count</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> other<span class="token punctuation">.</span><span class="token function">count</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">impl</span> <span class="token class-name">Eq</span> <span class="token keyword">for</span> <span class="token class-name">HuffmanTree</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

<span class="token keyword">impl</span> <span class="token class-name">PartialOrd</span> <span class="token keyword">for</span> <span class="token class-name">HuffmanTree</span> <span class="token punctuation">{</span>
    <span class="token keyword">fn</span> <span class="token function-definition function">partial_cmp</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">,</span> other<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token keyword">Self</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token class-name">Option</span><span class="token operator">&lt;</span><span class="token class-name">Ordering</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
        other<span class="token punctuation">.</span><span class="token function">count</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">partial_cmp</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">.</span><span class="token function">count</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">impl</span> <span class="token class-name">Ord</span> <span class="token keyword">for</span> <span class="token class-name">HuffmanTree</span> <span class="token punctuation">{</span>
    <span class="token keyword">fn</span> <span class="token function-definition function">cmp</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">,</span> other<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token keyword">Self</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token class-name">Ordering</span> <span class="token punctuation">{</span>
        other<span class="token punctuation">.</span><span class="token function">count</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">cmp</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">.</span><span class="token function">count</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token attribute attr-name">#[derive(Debug)]</span>
<span class="token keyword">struct</span> <span class="token type-definition class-name">Codebook</span> <span class="token punctuation">{</span>
    codebook<span class="token punctuation">:</span> <span class="token class-name">HashMap</span><span class="token operator">&lt;</span><span class="token keyword">char</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token operator">&gt;</span><span class="token punctuation">,</span>
    tree<span class="token punctuation">:</span> <span class="token class-name">HuffmanTree</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>

<span class="token keyword">impl</span> <span class="token class-name">HuffmanTree</span> <span class="token punctuation">{</span>
    <span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function-definition function">from</span><span class="token punctuation">(</span>input<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token keyword">str</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token keyword">Self</span> <span class="token punctuation">{</span>
        <span class="token keyword">let</span> counts <span class="token operator">=</span> input<span class="token punctuation">.</span><span class="token function">chars</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">fold</span><span class="token punctuation">(</span><span class="token class-name">HashMap</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token closure-params"><span class="token closure-punctuation punctuation">|</span><span class="token keyword">mut</span> map<span class="token punctuation">,</span> c<span class="token closure-punctuation punctuation">|</span></span> <span class="token punctuation">{</span>
            <span class="token operator">*</span>map<span class="token punctuation">.</span><span class="token function">entry</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">or_insert</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">+=</span> <span class="token number">1</span><span class="token punctuation">;</span>
            map
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">let</span> <span class="token keyword">mut</span> queue <span class="token operator">=</span> counts
            <span class="token punctuation">.</span><span class="token function">iter</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token closure-params"><span class="token closure-punctuation punctuation">|</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>value<span class="token punctuation">,</span> <span class="token operator">&amp;</span>count<span class="token punctuation">)</span><span class="token closure-punctuation punctuation">|</span></span> <span class="token class-name">HuffmanTree</span><span class="token punctuation">::</span><span class="token class-name">Leaf</span> <span class="token punctuation">{</span> value<span class="token punctuation">,</span> count <span class="token punctuation">}</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">::</span><span class="token operator">&lt;</span><span class="token class-name">BinaryHeap</span><span class="token operator">&lt;</span><span class="token class-name">HuffmanTree</span><span class="token operator">&gt;&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">while</span> queue<span class="token punctuation">.</span><span class="token function">len</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">1</span> <span class="token punctuation">{</span>
            <span class="token keyword">let</span> left <span class="token operator">=</span> queue<span class="token punctuation">.</span><span class="token function">pop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">let</span> right <span class="token operator">=</span> queue<span class="token punctuation">.</span><span class="token function">pop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            queue<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token class-name">HuffmanTree</span><span class="token punctuation">::</span><span class="token class-name">Branch</span> <span class="token punctuation">{</span>
                count<span class="token punctuation">:</span> left<span class="token punctuation">.</span><span class="token function">count</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> right<span class="token punctuation">.</span><span class="token function">count</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                left<span class="token punctuation">:</span> <span class="token class-name">Box</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span>left<span class="token punctuation">)</span><span class="token punctuation">,</span>
                right<span class="token punctuation">:</span> <span class="token class-name">Box</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span>right<span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>

        queue<span class="token punctuation">.</span><span class="token function">pop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">expect</span><span class="token punctuation">(</span><span class="token string">&quot;The Huffman tree has to have a root&quot;</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function-definition function">count</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token keyword">i32</span> <span class="token punctuation">{</span>
        <span class="token keyword">match</span> <span class="token operator">*</span><span class="token keyword">self</span> <span class="token punctuation">{</span>
            <span class="token class-name">HuffmanTree</span><span class="token punctuation">::</span><span class="token class-name">Branch</span> <span class="token punctuation">{</span> count<span class="token punctuation">,</span> <span class="token punctuation">..</span> <span class="token punctuation">}</span> <span class="token operator">=&gt;</span> count<span class="token punctuation">,</span>
            <span class="token class-name">HuffmanTree</span><span class="token punctuation">::</span><span class="token class-name">Leaf</span> <span class="token punctuation">{</span> count<span class="token punctuation">,</span> <span class="token punctuation">..</span> <span class="token punctuation">}</span> <span class="token operator">=&gt;</span> count<span class="token punctuation">,</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function-definition function">make_codebook</span><span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token class-name">Codebook</span> <span class="token punctuation">{</span>
        <span class="token keyword">let</span> <span class="token keyword">mut</span> codebook <span class="token operator">=</span> <span class="token class-name">HashMap</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">self</span><span class="token punctuation">.</span><span class="token function">dfs</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span><span class="token keyword">mut</span> codebook<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Codebook</span> <span class="token punctuation">{</span>
            codebook<span class="token punctuation">,</span>
            tree<span class="token punctuation">:</span> <span class="token keyword">self</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function-definition function">decode</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">,</span> input<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token keyword">str</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token class-name">String</span> <span class="token punctuation">{</span>
        <span class="token keyword">let</span> <span class="token keyword">mut</span> result <span class="token operator">=</span> <span class="token class-name">String</span><span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">let</span> <span class="token keyword">mut</span> start <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token keyword">while</span> <span class="token operator">!</span>input<span class="token punctuation">[</span>start<span class="token punctuation">..</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">is_empty</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            start <span class="token operator">+=</span> <span class="token keyword">self</span><span class="token punctuation">.</span><span class="token function">decode_dfs</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>input<span class="token punctuation">[</span>start<span class="token punctuation">..</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span><span class="token keyword">mut</span> result<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        result
    <span class="token punctuation">}</span>

    <span class="token keyword">fn</span> <span class="token function-definition function">decode_dfs</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">,</span> input<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token keyword">str</span><span class="token punctuation">,</span> result<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token keyword">mut</span> <span class="token class-name">String</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token keyword">usize</span> <span class="token punctuation">{</span>
        <span class="token keyword">let</span> current <span class="token operator">=</span> input<span class="token punctuation">.</span><span class="token function">chars</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">match</span> <span class="token operator">*</span><span class="token keyword">self</span> <span class="token punctuation">{</span>
            <span class="token class-name">HuffmanTree</span><span class="token punctuation">::</span><span class="token class-name">Branch</span> <span class="token punctuation">{</span> <span class="token keyword">ref</span> left<span class="token punctuation">,</span> <span class="token punctuation">..</span> <span class="token punctuation">}</span> <span class="token keyword">if</span> current <span class="token operator">==</span> <span class="token class-name">Some</span><span class="token punctuation">(</span><span class="token char">&apos;0&apos;</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                <span class="token number">1</span> <span class="token operator">+</span> left<span class="token punctuation">.</span><span class="token function">decode_dfs</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>input<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">..</span><span class="token punctuation">]</span><span class="token punctuation">,</span> result<span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
            <span class="token class-name">HuffmanTree</span><span class="token punctuation">::</span><span class="token class-name">Branch</span> <span class="token punctuation">{</span> <span class="token keyword">ref</span> right<span class="token punctuation">,</span> <span class="token punctuation">..</span> <span class="token punctuation">}</span> <span class="token keyword">if</span> current <span class="token operator">==</span> <span class="token class-name">Some</span><span class="token punctuation">(</span><span class="token char">&apos;1&apos;</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                <span class="token number">1</span> <span class="token operator">+</span> right<span class="token punctuation">.</span><span class="token function">decode_dfs</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>input<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">..</span><span class="token punctuation">]</span><span class="token punctuation">,</span> result<span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
            <span class="token class-name">HuffmanTree</span><span class="token punctuation">::</span><span class="token class-name">Leaf</span> <span class="token punctuation">{</span> value<span class="token punctuation">,</span> <span class="token punctuation">..</span> <span class="token punctuation">}</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                result<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token number">0</span>
            <span class="token punctuation">}</span>
            _ <span class="token operator">=&gt;</span> <span class="token macro property">panic!</span><span class="token punctuation">(</span><span class="token string">&quot;Unexpected end of input&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">fn</span> <span class="token function-definition function">dfs</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">,</span> code<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token punctuation">,</span> codebook<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token keyword">mut</span> <span class="token class-name">HashMap</span><span class="token operator">&lt;</span><span class="token keyword">char</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token operator">&gt;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">match</span> <span class="token operator">*</span><span class="token keyword">self</span> <span class="token punctuation">{</span>
            <span class="token class-name">HuffmanTree</span><span class="token punctuation">::</span><span class="token class-name">Branch</span> <span class="token punctuation">{</span>
                <span class="token keyword">ref</span> left<span class="token punctuation">,</span>
                <span class="token keyword">ref</span> right<span class="token punctuation">,</span>
                <span class="token punctuation">..</span>
            <span class="token punctuation">}</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                left<span class="token punctuation">.</span><span class="token function">dfs</span><span class="token punctuation">(</span>code<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;0&quot;</span><span class="token punctuation">,</span> codebook<span class="token punctuation">)</span><span class="token punctuation">;</span>
                right<span class="token punctuation">.</span><span class="token function">dfs</span><span class="token punctuation">(</span>code<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;1&quot;</span><span class="token punctuation">,</span> codebook<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token class-name">HuffmanTree</span><span class="token punctuation">::</span><span class="token class-name">Leaf</span> <span class="token punctuation">{</span> value<span class="token punctuation">,</span> <span class="token punctuation">..</span> <span class="token punctuation">}</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                codebook<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span>value<span class="token punctuation">,</span> code<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">impl</span> <span class="token class-name">Codebook</span> <span class="token punctuation">{</span>
    <span class="token keyword">fn</span> <span class="token function-definition function">encode</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">,</span> input<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token keyword">str</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token class-name">String</span> <span class="token punctuation">{</span>
        input<span class="token punctuation">.</span><span class="token function">chars</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token closure-params"><span class="token closure-punctuation punctuation">|</span>c<span class="token closure-punctuation punctuation">|</span></span> <span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">.</span>codebook<span class="token punctuation">[</span><span class="token operator">&amp;</span>c<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">&quot;&quot;</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">fn</span> <span class="token function-definition function">decode</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">,</span> input<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token keyword">str</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token class-name">String</span> <span class="token punctuation">{</span>
        <span class="token keyword">self</span><span class="token punctuation">.</span>tree<span class="token punctuation">.</span><span class="token function">decode</span><span class="token punctuation">(</span>input<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> input <span class="token operator">=</span> <span class="token string">&quot;bibbity bobbity&quot;</span><span class="token punctuation">;</span>

    <span class="token keyword">let</span> tree <span class="token operator">=</span> <span class="token class-name">HuffmanTree</span><span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span>input<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> codebook <span class="token operator">=</span> tree<span class="token punctuation">.</span><span class="token function">make_codebook</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> encoded <span class="token operator">=</span> codebook<span class="token punctuation">.</span><span class="token function">encode</span><span class="token punctuation">(</span>input<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> decoded <span class="token operator">=</span> codebook<span class="token punctuation">.</span><span class="token function">decode</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>encoded<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// Uncomment this line if you want to see the codebook/tree</span>
    <span class="token comment">// println!(&quot;{:#?}&quot;, codebook);</span>
    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;{}&quot;</span><span class="token punctuation">,</span> encoded<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;{}&quot;</span><span class="token punctuation">,</span> decoded<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
</div><div class="code-method-sample" data-lang="c" data-name="C"><pre class="language-"><code class="lang-c"><span class="token comment">// Made by Guston and edited by Gathros</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdlib.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;string.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdbool.h&gt;</span></span>

<span class="token keyword">struct</span> <span class="token class-name">tree</span> <span class="token punctuation">{</span>
    <span class="token keyword">struct</span> <span class="token class-name">tree</span><span class="token operator">*</span> left<span class="token punctuation">;</span>
    <span class="token keyword">struct</span> <span class="token class-name">tree</span><span class="token operator">*</span> right<span class="token punctuation">;</span>

    <span class="token keyword">int</span> count<span class="token punctuation">;</span>
    <span class="token keyword">char</span> value<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">struct</span> <span class="token class-name">bitstring_builder</span> <span class="token punctuation">{</span>
    <span class="token keyword">char</span> str<span class="token punctuation">[</span><span class="token number">257</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span> next_index<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">struct</span> <span class="token class-name">codebook</span> <span class="token punctuation">{</span>
    <span class="token keyword">char</span><span class="token operator">*</span> codes<span class="token punctuation">[</span><span class="token number">256</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">struct</span> <span class="token class-name">heap</span> <span class="token punctuation">{</span>
    <span class="token keyword">struct</span> <span class="token class-name">tree</span><span class="token operator">*</span><span class="token operator">*</span> data<span class="token punctuation">;</span>
    <span class="token class-name">size_t</span> length<span class="token punctuation">;</span>
    <span class="token class-name">size_t</span> capacity<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

bool <span class="token function">is_leaf</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">struct</span> <span class="token class-name">tree</span><span class="token operator">*</span> t<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token operator">!</span>t<span class="token operator">-&gt;</span>left <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>t<span class="token operator">-&gt;</span>right<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token function">swap</span><span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">tree</span><span class="token operator">*</span><span class="token operator">*</span> lhs<span class="token punctuation">,</span> <span class="token keyword">struct</span> <span class="token class-name">tree</span><span class="token operator">*</span><span class="token operator">*</span> rhs<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">struct</span> <span class="token class-name">tree</span><span class="token operator">*</span> tmp <span class="token operator">=</span> <span class="token operator">*</span>lhs<span class="token punctuation">;</span>
    <span class="token operator">*</span>lhs <span class="token operator">=</span> <span class="token operator">*</span>rhs<span class="token punctuation">;</span>
    <span class="token operator">*</span>rhs <span class="token operator">=</span> tmp<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">/* The two concat functions are horribly inefficient */</span>
<span class="token keyword">void</span> <span class="token function">concat</span><span class="token punctuation">(</span><span class="token keyword">char</span><span class="token operator">*</span><span class="token operator">*</span> dst<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> src<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">size_t</span> dst_len <span class="token operator">=</span> <span class="token function">strlen</span><span class="token punctuation">(</span><span class="token operator">*</span>dst<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">size_t</span> src_len <span class="token operator">=</span> <span class="token function">strlen</span><span class="token punctuation">(</span>src<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token operator">*</span>dst <span class="token operator">=</span> <span class="token function">realloc</span><span class="token punctuation">(</span><span class="token operator">*</span>dst<span class="token punctuation">,</span> src_len <span class="token operator">+</span> dst_len <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">strcat</span><span class="token punctuation">(</span><span class="token operator">*</span>dst<span class="token punctuation">,</span> src<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token function">concat_char</span><span class="token punctuation">(</span><span class="token keyword">char</span><span class="token operator">*</span><span class="token operator">*</span> dst<span class="token punctuation">,</span> <span class="token keyword">char</span> c<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">size_t</span> len <span class="token operator">=</span> <span class="token function">strlen</span><span class="token punctuation">(</span><span class="token operator">*</span>dst<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token operator">*</span>dst <span class="token operator">=</span> <span class="token function">realloc</span><span class="token punctuation">(</span><span class="token operator">*</span>dst<span class="token punctuation">,</span> len <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">(</span><span class="token operator">*</span>dst<span class="token punctuation">)</span><span class="token punctuation">[</span>len<span class="token punctuation">]</span> <span class="token operator">=</span> c<span class="token punctuation">;</span>
    <span class="token punctuation">(</span><span class="token operator">*</span>dst<span class="token punctuation">)</span><span class="token punctuation">[</span>len <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token char">&apos;\0&apos;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">char</span><span class="token operator">*</span> <span class="token function">duplicate</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> src<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">size_t</span> length <span class="token operator">=</span> <span class="token function">strlen</span><span class="token punctuation">(</span>src<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">char</span><span class="token operator">*</span> dst <span class="token operator">=</span> <span class="token function">malloc</span><span class="token punctuation">(</span>length <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">memcpy</span><span class="token punctuation">(</span>dst<span class="token punctuation">,</span> src<span class="token punctuation">,</span> length <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> dst<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token function">heap_push</span><span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">heap</span><span class="token operator">*</span> heap<span class="token punctuation">,</span> <span class="token keyword">struct</span> <span class="token class-name">tree</span><span class="token operator">*</span> value<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>heap<span class="token operator">-&gt;</span>capacity <span class="token operator">==</span> heap<span class="token operator">-&gt;</span>length<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        heap<span class="token operator">-&gt;</span>capacity <span class="token operator">=</span> heap<span class="token operator">-&gt;</span>capacity <span class="token operator">==</span> <span class="token number">0</span> <span class="token operator">?</span> <span class="token number">4</span> <span class="token operator">:</span> heap<span class="token operator">-&gt;</span>capacity <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">;</span>
        heap<span class="token operator">-&gt;</span>data <span class="token operator">=</span> <span class="token function">realloc</span><span class="token punctuation">(</span>heap<span class="token operator">-&gt;</span>data<span class="token punctuation">,</span> heap<span class="token operator">-&gt;</span>capacity <span class="token operator">*</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">tree</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    heap<span class="token operator">-&gt;</span>data<span class="token punctuation">[</span>heap<span class="token operator">-&gt;</span>length<span class="token operator">++</span><span class="token punctuation">]</span> <span class="token operator">=</span> value<span class="token punctuation">;</span>

    <span class="token class-name">size_t</span> index <span class="token operator">=</span> heap<span class="token operator">-&gt;</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token keyword">while</span> <span class="token punctuation">(</span>index<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">size_t</span> parent_index <span class="token operator">=</span> <span class="token punctuation">(</span>index <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>heap<span class="token operator">-&gt;</span>data<span class="token punctuation">[</span>parent_index<span class="token punctuation">]</span><span class="token operator">-&gt;</span>count <span class="token operator">&lt;=</span> heap<span class="token operator">-&gt;</span>data<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token operator">-&gt;</span>count<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token function">swap</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>heap<span class="token operator">-&gt;</span>data<span class="token punctuation">[</span>parent_index<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>heap<span class="token operator">-&gt;</span>data<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        index <span class="token operator">=</span> parent_index<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">struct</span> <span class="token class-name">tree</span><span class="token operator">*</span> <span class="token function">heap_pop</span><span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">heap</span><span class="token operator">*</span> heap<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>heap<span class="token operator">-&gt;</span>length<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">struct</span> <span class="token class-name">tree</span><span class="token operator">*</span> result <span class="token operator">=</span> heap<span class="token operator">-&gt;</span>data<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token function">swap</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>heap<span class="token operator">-&gt;</span>data<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>heap<span class="token operator">-&gt;</span>data<span class="token punctuation">[</span><span class="token operator">--</span>heap<span class="token operator">-&gt;</span>length<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token class-name">size_t</span> index <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token punctuation">;</span><span class="token punctuation">;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">size_t</span> target <span class="token operator">=</span> index<span class="token punctuation">;</span>
        <span class="token class-name">size_t</span> left <span class="token operator">=</span> <span class="token number">2</span> <span class="token operator">*</span> index <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
        <span class="token class-name">size_t</span> right <span class="token operator">=</span> left <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span>left <span class="token operator">&lt;</span> heap<span class="token operator">-&gt;</span>length <span class="token operator">&amp;&amp;</span>
                heap<span class="token operator">-&gt;</span>data<span class="token punctuation">[</span>left<span class="token punctuation">]</span><span class="token operator">-&gt;</span>count <span class="token operator">&lt;</span> heap<span class="token operator">-&gt;</span>data<span class="token punctuation">[</span>target<span class="token punctuation">]</span><span class="token operator">-&gt;</span>count<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            target <span class="token operator">=</span> left<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span>right <span class="token operator">&lt;</span> heap<span class="token operator">-&gt;</span>length <span class="token operator">&amp;&amp;</span>
                heap<span class="token operator">-&gt;</span>data<span class="token punctuation">[</span>right<span class="token punctuation">]</span><span class="token operator">-&gt;</span>count <span class="token operator">&lt;</span> heap<span class="token operator">-&gt;</span>data<span class="token punctuation">[</span>target<span class="token punctuation">]</span><span class="token operator">-&gt;</span>count<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            target <span class="token operator">=</span> right<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span>target <span class="token operator">==</span> index<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token function">swap</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>heap<span class="token operator">-&gt;</span>data<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>heap<span class="token operator">-&gt;</span>data<span class="token punctuation">[</span>target<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        index <span class="token operator">=</span> target<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">return</span> result<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token function">heap_free</span><span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">heap</span><span class="token operator">*</span> heap<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">free</span><span class="token punctuation">(</span>heap<span class="token operator">-&gt;</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">struct</span> <span class="token class-name">tree</span><span class="token operator">*</span> <span class="token function">generate_tree</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> str<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">int</span> counts<span class="token punctuation">[</span><span class="token number">256</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token number">0</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>

    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token punctuation">;</span> <span class="token operator">*</span>str <span class="token operator">!=</span> <span class="token char">&apos;\0&apos;</span><span class="token punctuation">;</span> <span class="token operator">++</span>str<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        counts<span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">char</span><span class="token punctuation">)</span><span class="token operator">*</span>str<span class="token punctuation">]</span> <span class="token operator">+=</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">struct</span> <span class="token class-name">heap</span> heap <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token number">0</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">size_t</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>counts<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>counts<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">struct</span> <span class="token class-name">tree</span><span class="token operator">*</span> tree <span class="token operator">=</span> <span class="token function">calloc</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">tree</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            tree<span class="token operator">-&gt;</span>value <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">char</span><span class="token punctuation">)</span>i<span class="token punctuation">;</span>
            tree<span class="token operator">-&gt;</span>count <span class="token operator">=</span> counts<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
            <span class="token function">heap_push</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>heap<span class="token punctuation">,</span> tree<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>heap<span class="token punctuation">.</span>length <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">struct</span> <span class="token class-name">tree</span><span class="token operator">*</span> leaf <span class="token operator">=</span> <span class="token function">heap_pop</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>heap<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">struct</span> <span class="token class-name">tree</span><span class="token operator">*</span> root <span class="token operator">=</span> <span class="token function">calloc</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">tree</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        root<span class="token operator">-&gt;</span>left <span class="token operator">=</span> leaf<span class="token punctuation">;</span>
        root<span class="token operator">-&gt;</span>count <span class="token operator">=</span> leaf<span class="token operator">-&gt;</span>count<span class="token punctuation">;</span>
        <span class="token function">heap_free</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>heap<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> root<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">while</span> <span class="token punctuation">(</span>heap<span class="token punctuation">.</span>length <span class="token operator">&gt;</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">struct</span> <span class="token class-name">tree</span><span class="token operator">*</span> left <span class="token operator">=</span> <span class="token function">heap_pop</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>heap<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">struct</span> <span class="token class-name">tree</span><span class="token operator">*</span> right <span class="token operator">=</span> <span class="token function">heap_pop</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>heap<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">struct</span> <span class="token class-name">tree</span><span class="token operator">*</span> branch <span class="token operator">=</span> <span class="token function">calloc</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">tree</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        branch<span class="token operator">-&gt;</span>count <span class="token operator">=</span> left<span class="token operator">-&gt;</span>count <span class="token operator">+</span> right<span class="token operator">-&gt;</span>count<span class="token punctuation">;</span>
        branch<span class="token operator">-&gt;</span>left <span class="token operator">=</span> left<span class="token punctuation">;</span>
        branch<span class="token operator">-&gt;</span>right <span class="token operator">=</span> right<span class="token punctuation">;</span>
        <span class="token function">heap_push</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>heap<span class="token punctuation">,</span> branch<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">struct</span> <span class="token class-name">tree</span><span class="token operator">*</span> root <span class="token operator">=</span> <span class="token function">heap_pop</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>heap<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">heap_free</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>heap<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> root<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token function">tree_free</span><span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">tree</span><span class="token operator">*</span> tree<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>tree<span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>
    <span class="token function">tree_free</span><span class="token punctuation">(</span>tree<span class="token operator">-&gt;</span>left<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">tree_free</span><span class="token punctuation">(</span>tree<span class="token operator">-&gt;</span>right<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">free</span><span class="token punctuation">(</span>tree<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token function">codebook_recurse</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">struct</span> <span class="token class-name">tree</span><span class="token operator">*</span> tree<span class="token punctuation">,</span>
                        <span class="token keyword">struct</span> <span class="token class-name">bitstring_builder</span><span class="token operator">*</span> builder<span class="token punctuation">,</span>
                        <span class="token keyword">struct</span> <span class="token class-name">codebook</span><span class="token operator">*</span> codebook<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>tree<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">is_leaf</span><span class="token punctuation">(</span>tree<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        builder<span class="token operator">-&gt;</span>str<span class="token punctuation">[</span>builder<span class="token operator">-&gt;</span>next_index<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token char">&apos;\0&apos;</span><span class="token punctuation">;</span>
        codebook<span class="token operator">-&gt;</span>codes<span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">char</span><span class="token punctuation">)</span>tree<span class="token operator">-&gt;</span>value<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">duplicate</span><span class="token punctuation">(</span>builder<span class="token operator">-&gt;</span>str<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    builder<span class="token operator">-&gt;</span>str<span class="token punctuation">[</span>builder<span class="token operator">-&gt;</span>next_index<span class="token operator">++</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token char">&apos;0&apos;</span><span class="token punctuation">;</span>
    <span class="token function">codebook_recurse</span><span class="token punctuation">(</span>tree<span class="token operator">-&gt;</span>left<span class="token punctuation">,</span> builder<span class="token punctuation">,</span> codebook<span class="token punctuation">)</span><span class="token punctuation">;</span>
    builder<span class="token operator">-&gt;</span>next_index <span class="token operator">-=</span> <span class="token number">1</span><span class="token punctuation">;</span>

    builder<span class="token operator">-&gt;</span>str<span class="token punctuation">[</span>builder<span class="token operator">-&gt;</span>next_index<span class="token operator">++</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token char">&apos;1&apos;</span><span class="token punctuation">;</span>
    <span class="token function">codebook_recurse</span><span class="token punctuation">(</span>tree<span class="token operator">-&gt;</span>right<span class="token punctuation">,</span> builder<span class="token punctuation">,</span> codebook<span class="token punctuation">)</span><span class="token punctuation">;</span>
    builder<span class="token operator">-&gt;</span>next_index <span class="token operator">-=</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">struct</span> <span class="token class-name">codebook</span> <span class="token function">generate_codebook</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">struct</span> <span class="token class-name">tree</span><span class="token operator">*</span> tree<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">struct</span> <span class="token class-name">codebook</span> codebook <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token punctuation">.</span>codes <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token number">0</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">struct</span> <span class="token class-name">bitstring_builder</span> builder <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token punctuation">.</span>str <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token number">0</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">.</span>next_index <span class="token operator">=</span> <span class="token number">0</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token function">codebook_recurse</span><span class="token punctuation">(</span>tree<span class="token punctuation">,</span> <span class="token operator">&amp;</span>builder<span class="token punctuation">,</span> <span class="token operator">&amp;</span>codebook<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> codebook<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token function">codebook_free</span><span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">codebook</span><span class="token operator">*</span> codebook<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">int</span> size <span class="token operator">=</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>codebook<span class="token operator">-&gt;</span>codes<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>codebook<span class="token operator">-&gt;</span>codes<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> size<span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">free</span><span class="token punctuation">(</span>codebook<span class="token operator">-&gt;</span>codes<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> <span class="token function">get_code</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">struct</span> <span class="token class-name">codebook</span><span class="token operator">*</span> codebook<span class="token punctuation">,</span> <span class="token keyword">char</span> c<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> codebook<span class="token operator">-&gt;</span>codes<span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">char</span><span class="token punctuation">)</span>c<span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">char</span><span class="token operator">*</span> <span class="token function">encode</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> input<span class="token punctuation">,</span> <span class="token keyword">struct</span> <span class="token class-name">tree</span><span class="token operator">*</span><span class="token operator">*</span> huffman_tree<span class="token punctuation">,</span>
                <span class="token keyword">struct</span> <span class="token class-name">codebook</span><span class="token operator">*</span> codebook<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token operator">*</span>huffman_tree <span class="token operator">=</span> <span class="token function">generate_tree</span><span class="token punctuation">(</span>input<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token operator">*</span>codebook <span class="token operator">=</span> <span class="token function">generate_codebook</span><span class="token punctuation">(</span><span class="token operator">*</span>huffman_tree<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">char</span><span class="token operator">*</span> result <span class="token operator">=</span> <span class="token function">duplicate</span><span class="token punctuation">(</span><span class="token function">get_code</span><span class="token punctuation">(</span>codebook<span class="token punctuation">,</span> <span class="token operator">*</span>input<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    input <span class="token operator">+=</span> <span class="token number">1</span><span class="token punctuation">;</span>

    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token punctuation">;</span> <span class="token operator">*</span>input<span class="token punctuation">;</span> <span class="token operator">++</span>input<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">concat</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>result<span class="token punctuation">,</span> <span class="token function">get_code</span><span class="token punctuation">(</span>codebook<span class="token punctuation">,</span> <span class="token operator">*</span>input<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">return</span> result<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> <span class="token function">decode_recurse</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> input<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">struct</span> <span class="token class-name">tree</span><span class="token operator">*</span> tree<span class="token punctuation">,</span>
                            <span class="token keyword">char</span><span class="token operator">*</span><span class="token operator">*</span> result<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>tree<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> input<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">is_leaf</span><span class="token punctuation">(</span>tree<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">concat_char</span><span class="token punctuation">(</span>result<span class="token punctuation">,</span> tree<span class="token operator">-&gt;</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> input<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">*</span>input <span class="token operator">==</span> <span class="token char">&apos;0&apos;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token function">decode_recurse</span><span class="token punctuation">(</span>input <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> tree<span class="token operator">-&gt;</span>left<span class="token punctuation">,</span> result<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token function">decode_recurse</span><span class="token punctuation">(</span>input <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> tree<span class="token operator">-&gt;</span>right<span class="token punctuation">,</span> result<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">char</span><span class="token operator">*</span> <span class="token function">decode</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> input<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">struct</span> <span class="token class-name">tree</span><span class="token operator">*</span> tree<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">char</span><span class="token operator">*</span> result <span class="token operator">=</span> <span class="token function">calloc</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">do</span> <span class="token punctuation">{</span>
        input <span class="token operator">=</span> <span class="token function">decode_recurse</span><span class="token punctuation">(</span>input<span class="token punctuation">,</span> tree<span class="token punctuation">,</span> <span class="token operator">&amp;</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token operator">*</span>input<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> result<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">struct</span> <span class="token class-name">tree</span><span class="token operator">*</span> tree<span class="token punctuation">;</span>
    <span class="token keyword">struct</span> <span class="token class-name">codebook</span> codebook<span class="token punctuation">;</span>

    <span class="token keyword">char</span><span class="token operator">*</span> encoded <span class="token operator">=</span> <span class="token function">encode</span><span class="token punctuation">(</span><span class="token string">&quot;bibbity bobbity&quot;</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>tree<span class="token punctuation">,</span> <span class="token operator">&amp;</span>codebook<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">char</span><span class="token operator">*</span> decoded <span class="token operator">=</span> <span class="token function">decode</span><span class="token punctuation">(</span>encoded<span class="token punctuation">,</span> tree<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;Codebook:\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">256</span><span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>codebook<span class="token punctuation">.</span>codes<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;%c %s\n&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">char</span><span class="token punctuation">)</span>i<span class="token punctuation">,</span> codebook<span class="token punctuation">.</span>codes<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;%s\n&quot;</span><span class="token punctuation">,</span> encoded<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;%s\n&quot;</span><span class="token punctuation">,</span> decoded<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token function">tree_free</span><span class="token punctuation">(</span>tree<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">codebook_free</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>codebook<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">free</span><span class="token punctuation">(</span>encoded<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">free</span><span class="token punctuation">(</span>decoded<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
</div><div class="code-method-sample" data-lang="hs" data-name="Haskell"><pre class="language-"><code class="lang-haskell"><span class="token import-statement"><span class="token keyword">import</span> <span class="token keyword">qualified</span> Data<span class="token punctuation">.</span>Map <span class="token keyword">as</span> M</span>
<span class="token import-statement"><span class="token keyword">import</span>           Data<span class="token punctuation">.</span>List</span> <span class="token punctuation">(</span><span class="token hvariable">insert</span><span class="token punctuation">,</span> <span class="token builtin">sort</span><span class="token punctuation">)</span>

<span class="token keyword">data</span> <span class="token constant">Tree</span> <span class="token hvariable">a</span> <span class="token operator">=</span> <span class="token constant">Leaf</span> <span class="token constant">Int</span> <span class="token hvariable">a</span>
            <span class="token operator">|</span> <span class="token constant">Node</span> <span class="token constant">Int</span> <span class="token punctuation">(</span><span class="token constant">Tree</span> <span class="token hvariable">a</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token constant">Tree</span> <span class="token hvariable">a</span><span class="token punctuation">)</span>
                   <span class="token keyword">deriving</span> <span class="token punctuation">(</span><span class="token constant">Show</span><span class="token punctuation">,</span> <span class="token constant">Eq</span><span class="token punctuation">)</span>

<span class="token hvariable">freq</span> <span class="token operator">::</span> <span class="token constant">Tree</span> <span class="token hvariable">a</span> <span class="token operator">-&gt;</span> <span class="token constant">Int</span>
<span class="token hvariable">freq</span> <span class="token punctuation">(</span><span class="token constant">Leaf</span> <span class="token hvariable">i</span> <span class="token hvariable">_</span><span class="token punctuation">)</span>   <span class="token operator">=</span> <span class="token hvariable">i</span>
<span class="token hvariable">freq</span> <span class="token punctuation">(</span><span class="token constant">Node</span> <span class="token hvariable">i</span> <span class="token hvariable">_</span> <span class="token hvariable">_</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token hvariable">i</span>

<span class="token keyword">instance</span> <span class="token punctuation">(</span><span class="token constant">Eq</span> <span class="token hvariable">a</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token constant">Ord</span> <span class="token punctuation">(</span><span class="token constant">Tree</span> <span class="token hvariable">a</span><span class="token punctuation">)</span> <span class="token keyword">where</span>
  <span class="token builtin">compare</span> <span class="token hvariable">t1</span> <span class="token hvariable">t2</span> <span class="token operator">=</span> <span class="token builtin">compare</span> <span class="token punctuation">(</span><span class="token hvariable">freq</span> <span class="token hvariable">t1</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token hvariable">freq</span> <span class="token hvariable">t2</span><span class="token punctuation">)</span>

<span class="token hvariable">getFrequencies</span> <span class="token operator">::</span> <span class="token constant">Ord</span> <span class="token hvariable">a</span> <span class="token operator">=&gt;</span> <span class="token punctuation">[</span><span class="token hvariable">a</span><span class="token punctuation">]</span> <span class="token operator">-&gt;</span> <span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token constant">Int</span><span class="token punctuation">,</span> <span class="token hvariable">a</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
<span class="token hvariable">getFrequencies</span> <span class="token operator">=</span> <span class="token hvariable">toSortedList</span> <span class="token operator">.</span> <span class="token hvariable">M<span class="token punctuation">.</span>fromListWith</span> <span class="token punctuation">(</span><span class="token operator">+</span><span class="token punctuation">)</span> <span class="token operator">.</span> <span class="token builtin">flip</span> <span class="token builtin">zip</span> <span class="token punctuation">(</span><span class="token builtin">repeat</span> <span class="token number">1</span><span class="token punctuation">)</span>
  <span class="token keyword">where</span> <span class="token hvariable">toSortedList</span> <span class="token operator">=</span> <span class="token builtin">sort</span> <span class="token operator">.</span> <span class="token builtin">map</span> <span class="token hvariable">swap</span> <span class="token operator">.</span> <span class="token hvariable">M<span class="token punctuation">.</span>toList</span>
        <span class="token hvariable">swap</span> <span class="token punctuation">(</span><span class="token hvariable">a</span><span class="token punctuation">,</span> <span class="token hvariable">i</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token hvariable">i</span><span class="token punctuation">,</span> <span class="token hvariable">a</span><span class="token punctuation">)</span>

<span class="token hvariable">buildTree</span> <span class="token operator">::</span> <span class="token punctuation">(</span><span class="token constant">Ord</span> <span class="token hvariable">a</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">[</span><span class="token hvariable">a</span><span class="token punctuation">]</span> <span class="token operator">-&gt;</span> <span class="token constant">Maybe</span> <span class="token punctuation">(</span><span class="token constant">Tree</span> <span class="token hvariable">a</span><span class="token punctuation">)</span>
<span class="token hvariable">buildTree</span> <span class="token operator">=</span> <span class="token hvariable">build</span> <span class="token operator">.</span> <span class="token builtin">map</span> <span class="token punctuation">(</span><span class="token builtin">uncurry</span> <span class="token constant">Leaf</span><span class="token punctuation">)</span> <span class="token operator">.</span> <span class="token hvariable">getFrequencies</span>
  <span class="token keyword">where</span> <span class="token hvariable">build</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>         <span class="token operator">=</span> <span class="token constant">Nothing</span>
        <span class="token hvariable">build</span> <span class="token punctuation">[</span><span class="token hvariable">t</span><span class="token punctuation">]</span>        <span class="token operator">=</span> <span class="token constant">Just</span> <span class="token hvariable">t</span>
        <span class="token hvariable">build</span> <span class="token punctuation">(</span><span class="token hvariable">t1</span><span class="token operator">:</span><span class="token hvariable">t2</span><span class="token operator">:</span><span class="token hvariable">ts</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token hvariable">build</span> <span class="token operator">$</span> <span class="token hvariable">insert</span> <span class="token punctuation">(</span><span class="token constant">Node</span> <span class="token punctuation">(</span><span class="token hvariable">freq</span> <span class="token hvariable">t1</span> <span class="token operator">+</span> <span class="token hvariable">freq</span> <span class="token hvariable">t2</span><span class="token punctuation">)</span> <span class="token hvariable">t1</span> <span class="token hvariable">t2</span><span class="token punctuation">)</span> <span class="token hvariable">ts</span>

<span class="token keyword">data</span> <span class="token constant">Bit</span> <span class="token operator">=</span> <span class="token constant">Zero</span> <span class="token operator">|</span> <span class="token constant">One</span>

<span class="token keyword">instance</span> <span class="token constant">Show</span> <span class="token constant">Bit</span> <span class="token keyword">where</span>
  <span class="token builtin">show</span> <span class="token constant">Zero</span> <span class="token operator">=</span> <span class="token string">&quot;0&quot;</span>
  <span class="token builtin">show</span> <span class="token constant">One</span> <span class="token operator">=</span> <span class="token string">&quot;1&quot;</span>

<span class="token hvariable">encode</span> <span class="token operator">::</span> <span class="token punctuation">(</span><span class="token constant">Ord</span> <span class="token hvariable">a</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">[</span><span class="token hvariable">a</span><span class="token punctuation">]</span> <span class="token operator">-&gt;</span> <span class="token punctuation">(</span><span class="token constant">Maybe</span> <span class="token punctuation">(</span><span class="token constant">Tree</span> <span class="token hvariable">a</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token constant">Bit</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token hvariable">encode</span> <span class="token hvariable">s</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token hvariable">tree</span><span class="token punctuation">,</span> <span class="token hvariable">msg</span><span class="token punctuation">)</span>
  <span class="token keyword">where</span>
  <span class="token hvariable">tree</span> <span class="token operator">=</span> <span class="token hvariable">buildTree</span> <span class="token hvariable">s</span>
  <span class="token hvariable">msg</span> <span class="token operator">=</span> <span class="token builtin">concatMap</span> <span class="token punctuation">(</span><span class="token hvariable">table</span> <span class="token constant">M</span><span class="token operator">.!</span><span class="token punctuation">)</span> <span class="token hvariable">s</span>
  <span class="token hvariable">table</span> <span class="token operator">=</span> <span class="token keyword">case</span> <span class="token hvariable">tree</span> <span class="token keyword">of</span>
    <span class="token constant">Nothing</span> <span class="token operator">-&gt;</span> <span class="token hvariable">M<span class="token punctuation">.</span>empty</span>
    <span class="token constant">Just</span> <span class="token hvariable">t</span>  <span class="token operator">-&gt;</span> <span class="token hvariable">M<span class="token punctuation">.</span>fromList</span> <span class="token operator">$</span> <span class="token hvariable">mkTable</span> <span class="token punctuation">(</span><span class="token hvariable">t</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
  <span class="token hvariable">mkTable</span> <span class="token punctuation">(</span><span class="token constant">Leaf</span> <span class="token hvariable">_</span> <span class="token hvariable">a</span><span class="token punctuation">,</span> <span class="token hvariable">p</span><span class="token punctuation">)</span>     <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token hvariable">a</span><span class="token punctuation">,</span> <span class="token builtin">reverse</span> <span class="token hvariable">p</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
  <span class="token hvariable">mkTable</span> <span class="token punctuation">(</span><span class="token constant">Node</span> <span class="token hvariable">_</span> <span class="token hvariable">t1</span> <span class="token hvariable">t2</span><span class="token punctuation">,</span> <span class="token hvariable">p</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token builtin">concatMap</span> <span class="token hvariable">mkTable</span> <span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token hvariable">t1</span><span class="token punctuation">,</span>  <span class="token constant">Zero</span><span class="token operator">:</span><span class="token hvariable">p</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token hvariable">t2</span><span class="token punctuation">,</span> <span class="token constant">One</span><span class="token operator">:</span><span class="token hvariable">p</span><span class="token punctuation">)</span><span class="token punctuation">]</span>

<span class="token hvariable">decode</span> <span class="token operator">::</span> <span class="token punctuation">(</span><span class="token constant">Ord</span> <span class="token hvariable">a</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token constant">Maybe</span> <span class="token punctuation">(</span><span class="token constant">Tree</span> <span class="token hvariable">a</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">[</span><span class="token constant">Bit</span><span class="token punctuation">]</span> <span class="token operator">-&gt;</span> <span class="token punctuation">[</span><span class="token hvariable">a</span><span class="token punctuation">]</span>
<span class="token hvariable">decode</span> <span class="token constant">Nothing</span> <span class="token hvariable">_</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token hvariable">decode</span> <span class="token punctuation">(</span><span class="token constant">Just</span> <span class="token hvariable">t</span><span class="token punctuation">)</span> <span class="token hvariable">m</span> <span class="token operator">=</span> <span class="token hvariable">path</span> <span class="token hvariable">t</span> <span class="token hvariable">m</span>
  <span class="token keyword">where</span> <span class="token hvariable">path</span> <span class="token punctuation">(</span><span class="token constant">Leaf</span> <span class="token hvariable">_</span> <span class="token hvariable">a</span><span class="token punctuation">)</span> <span class="token hvariable">m</span>            <span class="token operator">=</span> <span class="token hvariable">a</span> <span class="token operator">:</span> <span class="token hvariable">path</span> <span class="token hvariable">t</span> <span class="token hvariable">m</span>
        <span class="token hvariable">path</span> <span class="token punctuation">(</span><span class="token constant">Node</span> <span class="token hvariable">_</span> <span class="token hvariable">t1</span> <span class="token hvariable">_</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token constant">Zero</span><span class="token operator">:</span> <span class="token hvariable">m</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token hvariable">path</span> <span class="token hvariable">t1</span> <span class="token hvariable">m</span>
        <span class="token hvariable">path</span> <span class="token punctuation">(</span><span class="token constant">Node</span> <span class="token hvariable">_</span> <span class="token hvariable">_</span> <span class="token hvariable">t2</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token constant">One</span><span class="token operator">:</span> <span class="token hvariable">m</span><span class="token punctuation">)</span>  <span class="token operator">=</span> <span class="token hvariable">path</span> <span class="token hvariable">t2</span> <span class="token hvariable">m</span>
        <span class="token hvariable">path</span> <span class="token hvariable">_</span> <span class="token hvariable">_</span>                     <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>

<span class="token hvariable">main</span> <span class="token operator">=</span> <span class="token keyword">do</span>
  <span class="token keyword">let</span> <span class="token hvariable">msg</span> <span class="token operator">=</span> <span class="token string">&quot;bibbity bobbity&quot;</span>
      <span class="token punctuation">(</span><span class="token hvariable">tree</span><span class="token punctuation">,</span> <span class="token hvariable">encoded</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token hvariable">encode</span> <span class="token hvariable">msg</span>
      <span class="token hvariable">decoded</span> <span class="token operator">=</span> <span class="token hvariable">decode</span> <span class="token hvariable">tree</span> <span class="token hvariable">encoded</span>
  <span class="token builtin">putStrLn</span> <span class="token operator">$</span> <span class="token string">&quot;Endoding \&quot;&quot;</span> <span class="token operator">++</span> <span class="token hvariable">msg</span> <span class="token operator">++</span> <span class="token string">&quot;\&quot;: &quot;</span> <span class="token operator">++</span> <span class="token builtin">concatMap</span> <span class="token builtin">show</span> <span class="token hvariable">encoded</span>
  <span class="token builtin">putStrLn</span> <span class="token operator">$</span> <span class="token string">&quot;Length: &quot;</span> <span class="token operator">++</span> <span class="token punctuation">(</span><span class="token builtin">show</span> <span class="token operator">$</span> <span class="token builtin">length</span> <span class="token hvariable">encoded</span><span class="token punctuation">)</span>
  <span class="token builtin">putStrLn</span> <span class="token operator">$</span> <span class="token string">&quot;Decoding: &quot;</span> <span class="token operator">++</span> <span class="token hvariable">decoded</span>
</code></pre>
</div><div class="code-method-sample" data-lang="cs" data-name="C#"><h5 id="huffmancodingcs">HuffmanCoding.cs</h5>
<pre class="language-"><code class="lang-csharp"><span class="token comment">// submitted by Julian Schacher (jspp), thanks to gustorn for the help</span>
<span class="token keyword">using</span> <span class="token namespace">System</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Collections<span class="token punctuation">.</span>Generic</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Linq</span><span class="token punctuation">;</span>

<span class="token keyword">namespace</span> <span class="token namespace">HuffmanCoding</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">EncodingResult</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> BitString <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
        <span class="token keyword">public</span> <span class="token return-type class-name">Dictionary<span class="token punctuation">&lt;</span><span class="token keyword">char</span><span class="token punctuation">,</span> <span class="token keyword">string</span><span class="token punctuation">&gt;</span></span> Dictionary <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
        <span class="token keyword">public</span> <span class="token return-type class-name">HuffmanCoding<span class="token punctuation">.</span>Node</span> Tree <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

        <span class="token keyword">public</span> <span class="token function">EncodingResult</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> bitString<span class="token punctuation">,</span> <span class="token class-name">Dictionary<span class="token punctuation">&lt;</span><span class="token keyword">char</span><span class="token punctuation">,</span> <span class="token keyword">string</span><span class="token punctuation">&gt;</span></span> dictionary<span class="token punctuation">,</span> <span class="token class-name">HuffmanCoding<span class="token punctuation">.</span>Node</span> tree<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>BitString <span class="token operator">=</span> bitString<span class="token punctuation">;</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>Dictionary <span class="token operator">=</span> dictionary<span class="token punctuation">;</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>Tree <span class="token operator">=</span> tree<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">HuffmanCoding</span>
    <span class="token punctuation">{</span>
        <span class="token comment">// The Node class used for the Huffman Tree.</span>
        <span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Node</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">IComparable<span class="token punctuation">&lt;</span>Node<span class="token punctuation">&gt;</span></span></span>
        <span class="token punctuation">{</span>
            <span class="token keyword">public</span> <span class="token return-type class-name">Node</span> LeftChild <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
            <span class="token keyword">public</span> <span class="token return-type class-name">Node</span> RightChild <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
            <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> BitString <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">;</span>
            <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">int</span></span> Weight <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
            <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> Key <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

            <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">bool</span></span> IsLeaf <span class="token operator">=&gt;</span> LeftChild <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> RightChild <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">;</span>

            <span class="token comment">// Creates a leaf. So just a node is created with the given values.</span>
            <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name">Node</span> <span class="token function">CreateLeaf</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">char</span></span> key<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">int</span></span> weight<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Node</span><span class="token punctuation">(</span>key<span class="token punctuation">.</span><span class="token function">ToString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> weight<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// Creates a branch. Here a node is created by adding the keys and weights of both childs together.</span>
            <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name">Node</span> <span class="token function">CreateBranch</span><span class="token punctuation">(</span><span class="token class-name">Node</span> leftChild<span class="token punctuation">,</span> <span class="token class-name">Node</span> rightChild<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Node</span><span class="token punctuation">(</span>leftChild<span class="token punctuation">.</span>Key <span class="token operator">+</span> rightChild<span class="token punctuation">.</span>Key<span class="token punctuation">,</span> leftChild<span class="token punctuation">.</span>Weight <span class="token operator">+</span> rightChild<span class="token punctuation">.</span>Weight<span class="token punctuation">,</span> leftChild<span class="token punctuation">,</span> rightChild<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">private</span> <span class="token function">Node</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> key<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">int</span></span> weight<span class="token punctuation">,</span> <span class="token class-name">Node</span> leftChild<span class="token punctuation">,</span> <span class="token class-name">Node</span> rightChild<span class="token punctuation">)</span>
            <span class="token punctuation">{</span>
                <span class="token keyword">this</span><span class="token punctuation">.</span>Key <span class="token operator">=</span> key<span class="token punctuation">;</span>
                <span class="token keyword">this</span><span class="token punctuation">.</span>Weight <span class="token operator">=</span>  weight<span class="token punctuation">;</span>
                <span class="token keyword">this</span><span class="token punctuation">.</span>LeftChild <span class="token operator">=</span> leftChild<span class="token punctuation">;</span>
                <span class="token keyword">this</span><span class="token punctuation">.</span>RightChild <span class="token operator">=</span> rightChild<span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">int</span></span> <span class="token function">CompareTo</span><span class="token punctuation">(</span><span class="token class-name">Node</span> other<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>Weight <span class="token operator">-</span> other<span class="token punctuation">.</span>Weight<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment">// Node with biggest value at the top.</span>
        <span class="token keyword">class</span> <span class="token class-name">NodePriorityList</span>
        <span class="token punctuation">{</span>
            <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">int</span></span> Count <span class="token operator">=&gt;</span> nodes<span class="token punctuation">.</span>Count<span class="token punctuation">;</span>

            <span class="token keyword">private</span> <span class="token class-name">List<span class="token punctuation">&lt;</span>Node<span class="token punctuation">&gt;</span></span> nodes <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">List<span class="token punctuation">&lt;</span>Node<span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token keyword">public</span> <span class="token function">NodePriorityList</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">}</span>
            <span class="token keyword">public</span> <span class="token function">NodePriorityList</span><span class="token punctuation">(</span><span class="token class-name">List<span class="token punctuation">&lt;</span>Node<span class="token punctuation">&gt;</span></span> givenNodes<span class="token punctuation">)</span>
            <span class="token punctuation">{</span>
                <span class="token keyword">this</span><span class="token punctuation">.</span>nodes <span class="token operator">=</span> givenNodes<span class="token punctuation">.</span><span class="token function">ToList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">this</span><span class="token punctuation">.</span>nodes<span class="token punctuation">.</span><span class="token function">Sort</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Add</span><span class="token punctuation">(</span><span class="token class-name">Node</span> newNode<span class="token punctuation">)</span>
            <span class="token punctuation">{</span>
                <span class="token class-name"><span class="token keyword">var</span></span> index <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>nodes<span class="token punctuation">.</span><span class="token function">BinarySearch</span><span class="token punctuation">(</span>newNode<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>index <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span>
                    <span class="token keyword">this</span><span class="token punctuation">.</span>nodes<span class="token punctuation">.</span><span class="token function">Insert</span><span class="token punctuation">(</span><span class="token operator">~</span>index<span class="token punctuation">,</span> newNode<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">else</span>
                    <span class="token keyword">this</span><span class="token punctuation">.</span>nodes<span class="token punctuation">.</span><span class="token function">Insert</span><span class="token punctuation">(</span>index<span class="token punctuation">,</span> newNode<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            <span class="token keyword">public</span> <span class="token return-type class-name">Node</span> <span class="token function">Pop</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">{</span>
                <span class="token class-name"><span class="token keyword">var</span></span> result <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>nodes<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
                <span class="token keyword">this</span><span class="token punctuation">.</span>nodes<span class="token punctuation">.</span><span class="token function">RemoveAt</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">return</span> result<span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">public</span> <span class="token return-type class-name">EncodingResult</span> <span class="token function">Encode</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> input<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token class-name"><span class="token keyword">var</span></span> root <span class="token operator">=</span> <span class="token function">CreateTree</span><span class="token punctuation">(</span>input<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name"><span class="token keyword">var</span></span> dictionary <span class="token operator">=</span> <span class="token function">CreateDictionary</span><span class="token punctuation">(</span>root<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name"><span class="token keyword">var</span></span> bitString <span class="token operator">=</span> <span class="token function">CreateBitString</span><span class="token punctuation">(</span>input<span class="token punctuation">,</span> dictionary<span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">EncodingResult</span><span class="token punctuation">(</span>bitString<span class="token punctuation">,</span> dictionary<span class="token punctuation">,</span> root<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> <span class="token function">Decode</span><span class="token punctuation">(</span><span class="token class-name">EncodingResult</span> result<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token class-name"><span class="token keyword">var</span></span> output <span class="token operator">=</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">;</span>
            <span class="token class-name">Node</span> currentNode <span class="token operator">=</span> result<span class="token punctuation">.</span>Tree<span class="token punctuation">;</span>
            <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">var</span></span> bit <span class="token keyword">in</span> result<span class="token punctuation">.</span>BitString<span class="token punctuation">)</span>
            <span class="token punctuation">{</span>
                <span class="token comment">// Go down the tree.</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>bit <span class="token operator">==</span> <span class="token char">&apos;0&apos;</span><span class="token punctuation">)</span>
                    currentNode <span class="token operator">=</span> currentNode<span class="token punctuation">.</span>LeftChild<span class="token punctuation">;</span>
                <span class="token keyword">else</span>
                    currentNode <span class="token operator">=</span> currentNode<span class="token punctuation">.</span>RightChild<span class="token punctuation">;</span>

                <span class="token keyword">if</span> <span class="token punctuation">(</span>currentNode<span class="token punctuation">.</span>IsLeaf<span class="token punctuation">)</span>
                <span class="token punctuation">{</span>
                    output <span class="token operator">+=</span> currentNode<span class="token punctuation">.</span>Key<span class="token punctuation">;</span>
                    currentNode <span class="token operator">=</span> result<span class="token punctuation">.</span>Tree<span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">return</span> output<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">private</span> <span class="token return-type class-name">Node</span> <span class="token function">CreateTree</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> input<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token comment">// Create a List of all characters and their count in input by putting them into nodes.</span>
            <span class="token class-name"><span class="token keyword">var</span></span> nodes <span class="token operator">=</span> input
                <span class="token punctuation">.</span><span class="token function">GroupBy</span><span class="token punctuation">(</span>c <span class="token operator">=&gt;</span> c<span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">Select</span><span class="token punctuation">(</span>n <span class="token operator">=&gt;</span> Node<span class="token punctuation">.</span><span class="token function">CreateLeaf</span><span class="token punctuation">(</span>n<span class="token punctuation">.</span>Key<span class="token punctuation">,</span> n<span class="token punctuation">.</span><span class="token function">Count</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">ToList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">// Convert list of nodes to a NodePriorityList.</span>
            <span class="token class-name"><span class="token keyword">var</span></span> nodePriorityList <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">NodePriorityList</span><span class="token punctuation">(</span>nodes<span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">// Create Tree.</span>
            <span class="token keyword">while</span> <span class="token punctuation">(</span>nodePriorityList<span class="token punctuation">.</span>Count <span class="token operator">&gt;</span> <span class="token number">1</span><span class="token punctuation">)</span>
            <span class="token punctuation">{</span>
                <span class="token comment">// Pop the two nodes with the smallest weights from the nodePriorityList and create a parentNode with the CreateBranch method. (This method adds the keys and weights of the childs together.)</span>
                <span class="token class-name"><span class="token keyword">var</span></span> leftChild <span class="token operator">=</span> nodePriorityList<span class="token punctuation">.</span><span class="token function">Pop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name"><span class="token keyword">var</span></span> rightChild <span class="token operator">=</span> nodePriorityList<span class="token punctuation">.</span><span class="token function">Pop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name"><span class="token keyword">var</span></span> parentNode <span class="token operator">=</span> Node<span class="token punctuation">.</span><span class="token function">CreateBranch</span><span class="token punctuation">(</span>leftChild<span class="token punctuation">,</span> rightChild<span class="token punctuation">)</span><span class="token punctuation">;</span>

                nodePriorityList<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span>parentNode<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            <span class="token keyword">return</span> nodePriorityList<span class="token punctuation">.</span><span class="token function">Pop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>


        <span class="token keyword">private</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">CreateDictionary</span><span class="token punctuation">(</span><span class="token class-name">Node</span> node<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">string</span></span> bitString<span class="token punctuation">,</span> <span class="token class-name">Dictionary<span class="token punctuation">&lt;</span><span class="token keyword">char</span><span class="token punctuation">,</span> <span class="token keyword">string</span><span class="token punctuation">&gt;</span></span> localDictionary<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>node<span class="token punctuation">.</span>IsLeaf<span class="token punctuation">)</span>
                localDictionary<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span>node<span class="token punctuation">.</span>Key<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> bitString<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">else</span>
            <span class="token punctuation">{</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>node<span class="token punctuation">.</span>LeftChild <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
                    <span class="token function">CreateDictionary</span><span class="token punctuation">(</span>node<span class="token punctuation">.</span>LeftChild<span class="token punctuation">,</span> bitString <span class="token operator">+</span> <span class="token char">&apos;0&apos;</span><span class="token punctuation">,</span> localDictionary<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>node<span class="token punctuation">.</span>RightChild <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
                    <span class="token function">CreateDictionary</span><span class="token punctuation">(</span>node<span class="token punctuation">.</span>RightChild<span class="token punctuation">,</span> bitString <span class="token operator">+</span> <span class="token char">&apos;1&apos;</span><span class="token punctuation">,</span> localDictionary<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">private</span> <span class="token return-type class-name">Dictionary<span class="token punctuation">&lt;</span><span class="token keyword">char</span><span class="token punctuation">,</span> <span class="token keyword">string</span><span class="token punctuation">&gt;</span></span> <span class="token function">CreateDictionary</span><span class="token punctuation">(</span><span class="token class-name">Node</span> root<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token comment">// We&apos;re using a string instead of a actual bits here, since it makes the code somewhat more readable and this is an educational example.</span>
            <span class="token class-name"><span class="token keyword">var</span></span> dictionary <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Dictionary<span class="token punctuation">&lt;</span><span class="token keyword">char</span><span class="token punctuation">,</span> <span class="token keyword">string</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">CreateDictionary</span><span class="token punctuation">(</span>root<span class="token punctuation">,</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span> dictionary<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> dictionary<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>


        <span class="token keyword">private</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> <span class="token function">CreateBitString</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> input<span class="token punctuation">,</span> <span class="token class-name">Dictionary<span class="token punctuation">&lt;</span><span class="token keyword">char</span><span class="token punctuation">,</span> <span class="token keyword">string</span><span class="token punctuation">&gt;</span></span> dictionary<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token comment">// We&apos;re using a string right here. While no compression is achieved with a string, it&apos;s the easiest way to display what the compressed result looks like. Also this is just an educational example.</span>
            <span class="token class-name"><span class="token keyword">var</span></span> bitString <span class="token operator">=</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">;</span>
            <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">var</span></span> character <span class="token keyword">in</span> input<span class="token punctuation">)</span>
                bitString <span class="token operator">+=</span> dictionary<span class="token punctuation">[</span>character<span class="token punctuation">]</span><span class="token punctuation">;</span>

            <span class="token keyword">return</span> bitString<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<h5 id="programcs">Program.cs</h5>
<pre class="language-"><code class="lang-csharp"><span class="token comment">// submitted by Julian Schacher (jspp), thanks to gustorn for the help</span>
<span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Collections</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Collections<span class="token punctuation">.</span>Generic</span><span class="token punctuation">;</span>

<span class="token keyword">namespace</span> <span class="token namespace">HuffmanCoding</span>
<span class="token punctuation">{</span>
    <span class="token keyword">class</span> <span class="token class-name">Program</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Main</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> args<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token class-name"><span class="token keyword">var</span></span> huffmanCoding <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">HuffmanCoding</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token class-name"><span class="token keyword">var</span></span> result <span class="token operator">=</span> huffmanCoding<span class="token punctuation">.</span><span class="token function">Encode</span><span class="token punctuation">(</span><span class="token string">&quot;bibbity bobbity&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// The bitStrings are just strings and provide no compression. Look in HuffmanCoding.cs for explanation.</span>
            <span class="token comment">// Print dictionary.</span>
            <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">var</span></span> entry <span class="token keyword">in</span> result<span class="token punctuation">.</span>Dictionary<span class="token punctuation">)</span>
                System<span class="token punctuation">.</span>Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">$&quot;</span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">entry<span class="token punctuation">.</span>Key</span><span class="token punctuation">}</span></span><span class="token string"> </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">entry<span class="token punctuation">.</span>Value</span><span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// Print BitString.</span>
            System<span class="token punctuation">.</span>Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">$&quot;</span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">result<span class="token punctuation">.</span>BitString</span><span class="token punctuation">}</span></span><span class="token string"> count: </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">result<span class="token punctuation">.</span>BitString<span class="token punctuation">.</span>Length</span><span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token class-name"><span class="token keyword">var</span></span> originalString <span class="token operator">=</span> huffmanCoding<span class="token punctuation">.</span><span class="token function">Decode</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
            System<span class="token punctuation">.</span>Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span>originalString<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
</div><div class="code-method-sample" data-lang="lua" data-name="Lua"><pre class="language-"><code class="lang-lua"><span class="token keyword">local</span> <span class="token keyword">function</span> <span class="token function">frequency_array</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span>
  <span class="token comment">-- Collect all frequency values into a dict</span>
  <span class="token keyword">local</span> map <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
  <span class="token keyword">for</span> c <span class="token keyword">in</span> str<span class="token punctuation">:</span><span class="token function">gmatch</span><span class="token punctuation">(</span><span class="token string">&quot;.&quot;</span><span class="token punctuation">)</span> <span class="token keyword">do</span> <span class="token comment">-- Iterate over each character in str</span>
    map<span class="token punctuation">[</span>c<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span>map<span class="token punctuation">[</span>c<span class="token punctuation">]</span> <span class="token keyword">or</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span> <span class="token comment">-- Increment map[c] (default 0) by 1</span>
  <span class="token keyword">end</span>

  <span class="token comment">-- We have a dict of frequencies but we want it in a sorted list</span>
  <span class="token comment">-- Dump each key value pair into an array</span>
  <span class="token keyword">local</span> arr <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
  <span class="token keyword">for</span> k<span class="token punctuation">,</span> v <span class="token keyword">in</span> <span class="token function">pairs</span><span class="token punctuation">(</span>map<span class="token punctuation">)</span> <span class="token keyword">do</span>
    arr<span class="token punctuation">[</span><span class="token operator">#</span>arr <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span>k<span class="token punctuation">,</span> v<span class="token punctuation">}</span>
  <span class="token keyword">end</span>
  table<span class="token punctuation">.</span><span class="token function">sort</span><span class="token punctuation">(</span>arr<span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span> <span class="token keyword">return</span> a<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">&gt;</span> b<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token keyword">end</span><span class="token punctuation">)</span> <span class="token comment">-- Sort by frequency descending</span>
  <span class="token keyword">return</span> arr
<span class="token keyword">end</span>

<span class="token keyword">local</span> <span class="token keyword">function</span> <span class="token function">build_huffman_tree</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span>

  <span class="token keyword">if</span> <span class="token operator">#</span>message <span class="token operator">==</span> <span class="token number">0</span> <span class="token keyword">then</span> <span class="token keyword">return</span> <span class="token keyword">end</span>

  <span class="token keyword">local</span> freq <span class="token operator">=</span> <span class="token function">frequency_array</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span>

  <span class="token keyword">while</span> <span class="token operator">#</span>freq <span class="token operator">&gt;</span> <span class="token number">1</span> <span class="token keyword">do</span> <span class="token comment">-- Repeat until we have only 1 node</span>

    <span class="token comment">-- Take two of the least frequent nodes</span>
    <span class="token keyword">local</span> node1<span class="token punctuation">,</span> node2 <span class="token operator">=</span> table<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span>freq<span class="token punctuation">)</span><span class="token punctuation">,</span> table<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span>freq<span class="token punctuation">)</span>

        <span class="token comment">-- Group node values in first index, and sum of node frequencies in second</span>
    <span class="token keyword">local</span> node3 <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token punctuation">{</span>node1<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> node2<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> node1<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">+</span> node2<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token punctuation">}</span>

    <span class="token keyword">local</span> i <span class="token operator">=</span> <span class="token number">1</span>
    <span class="token keyword">while</span> i <span class="token operator">&lt;=</span> <span class="token operator">#</span>freq <span class="token keyword">and</span> freq<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">&lt;=</span> node3<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token keyword">do</span> <span class="token comment">-- Sorted insertion, faster than inserting then sorting again</span>
      i <span class="token operator">=</span> i <span class="token operator">+</span> <span class="token number">1</span>
    <span class="token keyword">end</span>

    table<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span>freq<span class="token punctuation">,</span> i<span class="token punctuation">,</span> node3<span class="token punctuation">)</span>
  <span class="token keyword">end</span>

  <span class="token keyword">return</span> freq<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token comment">-- Return value of only element in freq array</span>
<span class="token keyword">end</span>

<span class="token keyword">local</span> <span class="token keyword">function</span> <span class="token function">_create_codebook</span><span class="token punctuation">(</span>node<span class="token punctuation">,</span> codebook<span class="token punctuation">,</span> code<span class="token punctuation">)</span>
  <span class="token keyword">if</span> <span class="token keyword">not</span> node <span class="token keyword">then</span>
    <span class="token keyword">return</span>
  <span class="token keyword">elseif</span> <span class="token function">type</span><span class="token punctuation">(</span>node<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">&quot;string&quot;</span> <span class="token keyword">then</span>
    codebook<span class="token punctuation">[</span>node<span class="token punctuation">]</span> <span class="token operator">=</span> code <span class="token comment">-- if node is a leaf then add it to codebook</span>
  <span class="token keyword">else</span>
    <span class="token function">_create_codebook</span><span class="token punctuation">(</span>node<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> codebook<span class="token punctuation">,</span> code <span class="token operator">..</span> <span class="token string">&quot;0&quot;</span><span class="token punctuation">)</span> <span class="token comment">-- Left side</span>
    <span class="token function">_create_codebook</span><span class="token punctuation">(</span>node<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> codebook<span class="token punctuation">,</span> code <span class="token operator">..</span> <span class="token string">&quot;1&quot;</span><span class="token punctuation">)</span> <span class="token comment">-- Right side</span>
  <span class="token keyword">end</span>
<span class="token keyword">end</span>

<span class="token keyword">local</span> <span class="token keyword">function</span> <span class="token function">create_codebook</span><span class="token punctuation">(</span>tree<span class="token punctuation">)</span>
  <span class="token keyword">local</span> codebook <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
  <span class="token function">_create_codebook</span><span class="token punctuation">(</span>tree<span class="token punctuation">,</span> codebook<span class="token punctuation">,</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">)</span>
  <span class="token keyword">return</span> codebook
<span class="token keyword">end</span>

<span class="token keyword">local</span> <span class="token keyword">function</span> <span class="token function">huffman_encode</span><span class="token punctuation">(</span>codebook<span class="token punctuation">,</span> message<span class="token punctuation">)</span>
  <span class="token keyword">local</span> encoded_chars <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
  <span class="token keyword">for</span> c <span class="token keyword">in</span> message<span class="token punctuation">:</span><span class="token function">gmatch</span><span class="token punctuation">(</span><span class="token string">&quot;.&quot;</span><span class="token punctuation">)</span> <span class="token keyword">do</span> <span class="token comment">-- Iterate over each character in message</span>
    encoded_chars<span class="token punctuation">[</span><span class="token operator">#</span>encoded_chars <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> codebook<span class="token punctuation">[</span>c<span class="token punctuation">]</span>
  <span class="token keyword">end</span>
  <span class="token keyword">return</span> table<span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span>encoded_chars<span class="token punctuation">)</span> <span class="token comment">-- table.concat to avoid slow string bufferin</span>
<span class="token keyword">end</span>

<span class="token keyword">local</span> <span class="token keyword">function</span> <span class="token function">_huffman_decode</span><span class="token punctuation">(</span>node<span class="token punctuation">,</span> bitstring<span class="token punctuation">,</span> i<span class="token punctuation">)</span>
  <span class="token keyword">if</span> <span class="token function">type</span><span class="token punctuation">(</span>node<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">&quot;string&quot;</span> <span class="token keyword">then</span>
    <span class="token keyword">return</span> node<span class="token punctuation">,</span> i <span class="token comment">-- If it&apos;s a leaf node then return the value along with the next bit to read</span>
  <span class="token keyword">end</span>
  <span class="token keyword">if</span> bitstring<span class="token punctuation">:</span><span class="token function">sub</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> i<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">&quot;0&quot;</span> <span class="token keyword">then</span>
    <span class="token keyword">return</span> <span class="token function">_huffman_decode</span><span class="token punctuation">(</span>node<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> bitstring<span class="token punctuation">,</span> i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token comment">-- If it&apos;s 0 traverse down the left side</span>
  <span class="token keyword">elseif</span> bitstring<span class="token punctuation">:</span><span class="token function">sub</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> i<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">&quot;1&quot;</span> <span class="token keyword">then</span>
    <span class="token keyword">return</span> <span class="token function">_huffman_decode</span><span class="token punctuation">(</span>node<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> bitstring<span class="token punctuation">,</span> i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token comment">-- If it&apos;s 1 traverse down the right side</span>
  <span class="token keyword">end</span>
<span class="token keyword">end</span>

<span class="token keyword">local</span> <span class="token keyword">function</span> <span class="token function">huffman_decode</span><span class="token punctuation">(</span>tree<span class="token punctuation">,</span> bitstring<span class="token punctuation">)</span>
  <span class="token comment">-- i is the current position in the bitstring, we can track which bit we are to look at next without using string.sub</span>
  <span class="token keyword">local</span> decoded_chars<span class="token punctuation">,</span> i <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1</span>
  <span class="token keyword">while</span> i <span class="token operator">&lt;=</span> <span class="token operator">#</span>bitstring <span class="token keyword">do</span>
    decoded_chars<span class="token punctuation">[</span><span class="token operator">#</span>decoded_chars <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> i <span class="token operator">=</span> <span class="token function">_huffman_decode</span><span class="token punctuation">(</span>tree<span class="token punctuation">,</span> bitstring<span class="token punctuation">,</span> i<span class="token punctuation">)</span>
  <span class="token keyword">end</span>

  <span class="token keyword">return</span> table<span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span>decoded_chars<span class="token punctuation">)</span>
<span class="token keyword">end</span>

<span class="token keyword">local</span> message <span class="token operator">=</span> <span class="token string">&quot;bibbity_bobbity&quot;</span>

<span class="token keyword">local</span> tree <span class="token operator">=</span> <span class="token function">build_huffman_tree</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span>
<span class="token keyword">local</span> codebook <span class="token operator">=</span> <span class="token function">create_codebook</span><span class="token punctuation">(</span>tree<span class="token punctuation">)</span>

<span class="token keyword">local</span> bitstring <span class="token operator">=</span> <span class="token function">huffman_encode</span><span class="token punctuation">(</span>codebook<span class="token punctuation">,</span> message<span class="token punctuation">)</span>
<span class="token function">print</span><span class="token punctuation">(</span><span class="token string">&quot;Encoded: &quot;</span> <span class="token operator">..</span> bitstring<span class="token punctuation">)</span>

<span class="token function">print</span><span class="token punctuation">(</span><span class="token string">&quot;Decoded: &quot;</span> <span class="token operator">..</span> <span class="token function">huffman_decode</span><span class="token punctuation">(</span>tree<span class="token punctuation">,</span> bitstring<span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre>
</div><div class="code-method-sample" data-lang="cpp" data-name="C++"><pre class="language-"><code class="lang-cpp"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;algorithm&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;array&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;bitset&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;cassert&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;cctype&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;cstddef&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;limits&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;memory&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;string&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;utility&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;vector&gt;</span></span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;iostream&gt;</span></span>

<span class="token keyword">using</span> std<span class="token double-colon punctuation">::</span>begin<span class="token punctuation">;</span>
<span class="token keyword">using</span> std<span class="token double-colon punctuation">::</span>end<span class="token punctuation">;</span>

<span class="token keyword">namespace</span> huffman <span class="token punctuation">{</span>

<span class="token punctuation">[</span><span class="token punctuation">[</span>noreturn<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token keyword">inline</span> <span class="token keyword">void</span> <span class="token function">unreachable</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  std<span class="token double-colon punctuation">::</span>cerr <span class="token operator">&lt;&lt;</span> <span class="token string">&quot;this should never happen\n&quot;</span><span class="token punctuation">;</span>
  std<span class="token double-colon punctuation">::</span><span class="token function">abort</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// --- interface ---</span>
<span class="token keyword">class</span> <span class="token class-name">codebook</span> <span class="token punctuation">{</span>
  <span class="token keyword">struct</span> <span class="token class-name">node</span> <span class="token punctuation">{</span>
    <span class="token keyword">int</span> frequency<span class="token punctuation">;</span>

    <span class="token function">node</span><span class="token punctuation">(</span><span class="token keyword">int</span> freq<span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token function">frequency</span><span class="token punctuation">(</span>freq<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
    <span class="token keyword">virtual</span> <span class="token operator">~</span><span class="token function">node</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>

  <span class="token comment">// never null</span>
  <span class="token keyword">using</span> node_ptr <span class="token operator">=</span> std<span class="token double-colon punctuation">::</span>unique_ptr<span class="token operator">&lt;</span>node <span class="token keyword">const</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
  <span class="token keyword">using</span> bitstring <span class="token operator">=</span> std<span class="token double-colon punctuation">::</span>vector<span class="token operator">&lt;</span><span class="token keyword">bool</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>

  <span class="token comment">// this is a flatmap between char and a bitstring</span>
  <span class="token comment">// there should only ever be one character with a given</span>
  <span class="token comment">// value at any time.</span>
  <span class="token keyword">using</span> encoder_t <span class="token operator">=</span> std<span class="token double-colon punctuation">::</span>vector<span class="token operator">&lt;</span>std<span class="token double-colon punctuation">::</span>pair<span class="token operator">&lt;</span><span class="token keyword">char</span><span class="token punctuation">,</span> bitstring<span class="token operator">&gt;&gt;</span><span class="token punctuation">;</span>

  <span class="token keyword">struct</span> <span class="token class-name">leaf</span> <span class="token keyword">final</span> <span class="token operator">:</span> node <span class="token punctuation">{</span>
    <span class="token keyword">char</span> key<span class="token punctuation">;</span>

    <span class="token function">leaf</span><span class="token punctuation">(</span><span class="token keyword">int</span> freq<span class="token punctuation">,</span> <span class="token keyword">char</span> key<span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token function">node</span><span class="token punctuation">(</span>freq<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">key</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>

  <span class="token keyword">struct</span> <span class="token class-name">branch</span> <span class="token keyword">final</span> <span class="token operator">:</span> node <span class="token punctuation">{</span>
    node_ptr lhs<span class="token punctuation">;</span>
    node_ptr rhs<span class="token punctuation">;</span>

    <span class="token function">branch</span><span class="token punctuation">(</span>node_ptr lhs<span class="token punctuation">,</span> node_ptr rhs<span class="token punctuation">)</span>
        <span class="token operator">:</span> <span class="token function">node</span><span class="token punctuation">(</span>lhs<span class="token operator">-&gt;</span>frequency <span class="token operator">+</span> rhs<span class="token operator">-&gt;</span>frequency<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">lhs</span><span class="token punctuation">(</span>std<span class="token double-colon punctuation">::</span><span class="token function">move</span><span class="token punctuation">(</span>lhs<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
          <span class="token function">rhs</span><span class="token punctuation">(</span>std<span class="token double-colon punctuation">::</span><span class="token function">move</span><span class="token punctuation">(</span>rhs<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>

  <span class="token comment">// this allows us to share [codebook]s among encoded strings</span>
  <span class="token keyword">struct</span> <span class="token class-name">data</span> <span class="token punctuation">{</span>
    node_ptr decoder<span class="token punctuation">;</span>
    encoder_t encoder<span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
  std<span class="token double-colon punctuation">::</span>shared_ptr<span class="token operator">&lt;</span>data <span class="token keyword">const</span><span class="token operator">&gt;</span> underlying_<span class="token punctuation">;</span>

<span class="token keyword">public</span><span class="token operator">:</span>
  <span class="token keyword">template</span> <span class="token operator">&lt;</span><span class="token keyword">typename</span> <span class="token class-name">Iter</span><span class="token operator">&gt;</span>
  <span class="token function">codebook</span><span class="token punctuation">(</span>Iter <span class="token keyword">const</span> first<span class="token punctuation">,</span> Iter <span class="token keyword">const</span> last<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">template</span> <span class="token operator">&lt;</span><span class="token keyword">typename</span> <span class="token class-name">Iter</span><span class="token operator">&gt;</span>
  std<span class="token double-colon punctuation">::</span>vector<span class="token operator">&lt;</span><span class="token keyword">bool</span><span class="token operator">&gt;</span> <span class="token function">encode</span><span class="token punctuation">(</span>Iter first<span class="token punctuation">,</span> Iter last<span class="token punctuation">)</span> <span class="token keyword">const</span><span class="token punctuation">;</span>

  <span class="token keyword">template</span> <span class="token operator">&lt;</span><span class="token keyword">typename</span> <span class="token class-name">Iter</span><span class="token operator">&gt;</span>
  std<span class="token double-colon punctuation">::</span>string <span class="token function">decode</span><span class="token punctuation">(</span>Iter first<span class="token punctuation">,</span> Iter last<span class="token punctuation">)</span> <span class="token keyword">const</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">struct</span> <span class="token class-name">encoded_string</span> <span class="token punctuation">{</span>
  codebook codes<span class="token punctuation">;</span>
  std<span class="token double-colon punctuation">::</span>vector<span class="token operator">&lt;</span><span class="token keyword">bool</span><span class="token operator">&gt;</span> string<span class="token punctuation">;</span>

  <span class="token keyword">explicit</span> <span class="token function">encoded_string</span><span class="token punctuation">(</span>std<span class="token double-colon punctuation">::</span>string <span class="token keyword">const</span><span class="token operator">&amp;</span> s<span class="token punctuation">)</span>
      <span class="token operator">:</span> <span class="token function">codes</span><span class="token punctuation">(</span><span class="token function">begin</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">end</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">string</span><span class="token punctuation">(</span>codes<span class="token punctuation">.</span><span class="token function">encode</span><span class="token punctuation">(</span><span class="token function">begin</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">end</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

  <span class="token function">encoded_string</span><span class="token punctuation">(</span>codebook codes<span class="token punctuation">,</span> std<span class="token double-colon punctuation">::</span>string <span class="token keyword">const</span><span class="token operator">&amp;</span> s<span class="token punctuation">)</span>
      <span class="token operator">:</span> <span class="token function">codes</span><span class="token punctuation">(</span>codes<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">string</span><span class="token punctuation">(</span>codes<span class="token punctuation">.</span><span class="token function">encode</span><span class="token punctuation">(</span><span class="token function">begin</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">end</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

  std<span class="token double-colon punctuation">::</span>string <span class="token function">decoded</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> codes<span class="token punctuation">.</span><span class="token function">decode</span><span class="token punctuation">(</span><span class="token function">begin</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">end</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// --- implementation ---</span>
<span class="token keyword">inline</span> codebook<span class="token double-colon punctuation">::</span><span class="token class-name">node</span><span class="token double-colon punctuation">::</span><span class="token operator">~</span><span class="token function">node</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

<span class="token keyword">inline</span> std<span class="token double-colon punctuation">::</span>vector<span class="token operator">&lt;</span><span class="token keyword">bool</span><span class="token operator">&gt;</span> <span class="token function">with_new_bit</span><span class="token punctuation">(</span>std<span class="token double-colon punctuation">::</span>vector<span class="token operator">&lt;</span><span class="token keyword">bool</span><span class="token operator">&gt;</span> bits<span class="token punctuation">,</span> <span class="token keyword">bool</span> b<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  bits<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> bits<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">template</span> <span class="token operator">&lt;</span><span class="token keyword">typename</span> <span class="token class-name">Iter</span><span class="token operator">&gt;</span>
codebook<span class="token double-colon punctuation">::</span><span class="token function">codebook</span><span class="token punctuation">(</span>Iter <span class="token keyword">const</span> first<span class="token punctuation">,</span> Iter <span class="token keyword">const</span> last<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">struct</span> <span class="token class-name">helper</span> <span class="token punctuation">{</span>
    <span class="token keyword">static</span> node_ptr <span class="token function">make_decoder</span><span class="token punctuation">(</span>Iter <span class="token keyword">const</span> first<span class="token punctuation">,</span> Iter <span class="token keyword">const</span> last<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// in this part of the function, we build up a frequency list</span>
      <span class="token comment">// sorted by frequency, descending</span>
      <span class="token keyword">auto</span> freq <span class="token operator">=</span> std<span class="token double-colon punctuation">::</span><span class="token generic-function"><span class="token function">vector</span><span class="token generic class-name"><span class="token operator">&lt;</span>leaf<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

      std<span class="token double-colon punctuation">::</span><span class="token function">for_each</span><span class="token punctuation">(</span>first<span class="token punctuation">,</span> last<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token operator">&amp;</span>freq<span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token keyword">char</span> c<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">auto</span> <span class="token keyword">const</span> it <span class="token operator">=</span> std<span class="token double-colon punctuation">::</span><span class="token function">find_if</span><span class="token punctuation">(</span>
            <span class="token function">begin</span><span class="token punctuation">(</span>freq<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">end</span><span class="token punctuation">(</span>freq<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>c<span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token keyword">auto</span> <span class="token keyword">const</span><span class="token operator">&amp;</span> p<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> p<span class="token punctuation">.</span>key <span class="token operator">==</span> c<span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>it <span class="token operator">!=</span> <span class="token function">end</span><span class="token punctuation">(</span>freq<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token comment">// it&apos;s already in the list</span>
          it<span class="token operator">-&gt;</span>frequency <span class="token operator">+=</span> <span class="token number">1</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
          <span class="token comment">// it&apos;s not already in the list</span>
          freq<span class="token punctuation">.</span><span class="token function">emplace_back</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> c<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token keyword">if</span> <span class="token punctuation">(</span>freq<span class="token punctuation">.</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">throw</span> std<span class="token double-colon punctuation">::</span><span class="token function">invalid_argument</span><span class="token punctuation">(</span><span class="token string">&quot;attempted to codebook an empty range&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>

      std<span class="token double-colon punctuation">::</span><span class="token function">sort</span><span class="token punctuation">(</span><span class="token function">begin</span><span class="token punctuation">(</span>freq<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">end</span><span class="token punctuation">(</span>freq<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token keyword">auto</span> <span class="token keyword">const</span><span class="token operator">&amp;</span> lhs<span class="token punctuation">,</span> <span class="token keyword">auto</span> <span class="token keyword">const</span><span class="token operator">&amp;</span> rhs<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> lhs<span class="token punctuation">.</span>frequency <span class="token operator">&gt;</span> rhs<span class="token punctuation">.</span>frequency<span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token keyword">auto</span> ret <span class="token operator">=</span> std<span class="token double-colon punctuation">::</span><span class="token generic-function"><span class="token function">vector</span><span class="token generic class-name"><span class="token operator">&lt;</span>std<span class="token double-colon punctuation">::</span>unique_ptr<span class="token operator">&lt;</span>node<span class="token operator">&gt;&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      std<span class="token double-colon punctuation">::</span><span class="token function">transform</span><span class="token punctuation">(</span>
          <span class="token function">begin</span><span class="token punctuation">(</span>freq<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">end</span><span class="token punctuation">(</span>freq<span class="token punctuation">)</span><span class="token punctuation">,</span> std<span class="token double-colon punctuation">::</span><span class="token function">back_inserter</span><span class="token punctuation">(</span>ret<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token keyword">auto</span> <span class="token keyword">const</span> l<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> std<span class="token double-colon punctuation">::</span><span class="token generic-function"><span class="token function">make_unique</span><span class="token generic class-name"><span class="token operator">&lt;</span>leaf<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>l<span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token keyword">while</span> <span class="token punctuation">(</span>ret<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">auto</span> rhs <span class="token operator">=</span> std<span class="token double-colon punctuation">::</span><span class="token function">move</span><span class="token punctuation">(</span>ret<span class="token punctuation">.</span><span class="token function">back</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        ret<span class="token punctuation">.</span><span class="token function">pop_back</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">auto</span> lhs <span class="token operator">=</span> std<span class="token double-colon punctuation">::</span><span class="token function">move</span><span class="token punctuation">(</span>ret<span class="token punctuation">.</span><span class="token function">back</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        ret<span class="token punctuation">.</span><span class="token function">pop_back</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">auto</span> new_node <span class="token operator">=</span>
            std<span class="token double-colon punctuation">::</span><span class="token generic-function"><span class="token function">make_unique</span><span class="token generic class-name"><span class="token operator">&lt;</span>branch<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>std<span class="token double-colon punctuation">::</span><span class="token function">move</span><span class="token punctuation">(</span>lhs<span class="token punctuation">)</span><span class="token punctuation">,</span> std<span class="token double-colon punctuation">::</span><span class="token function">move</span><span class="token punctuation">(</span>rhs<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">auto</span> <span class="token keyword">const</span> new_freq <span class="token operator">=</span> new_node<span class="token operator">-&gt;</span>frequency<span class="token punctuation">;</span>

        <span class="token comment">// look for the first element with a smaller frequency</span>
        <span class="token keyword">auto</span> <span class="token keyword">const</span> it <span class="token operator">=</span>
            std<span class="token double-colon punctuation">::</span><span class="token function">find_if</span><span class="token punctuation">(</span><span class="token function">begin</span><span class="token punctuation">(</span>ret<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">end</span><span class="token punctuation">(</span>ret<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>new_freq<span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token keyword">auto</span> <span class="token keyword">const</span><span class="token operator">&amp;</span> n<span class="token punctuation">)</span> <span class="token punctuation">{</span>
              <span class="token keyword">return</span> n<span class="token operator">-&gt;</span>frequency <span class="token operator">&lt;</span> new_freq<span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// and insert the new_node before that element</span>
        ret<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span>it<span class="token punctuation">,</span> std<span class="token double-colon punctuation">::</span><span class="token function">move</span><span class="token punctuation">(</span>new_node<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// in this way, we keep the list sorted by frequency</span>
      <span class="token punctuation">}</span>

      <span class="token keyword">return</span> std<span class="token double-colon punctuation">::</span><span class="token function">move</span><span class="token punctuation">(</span>ret<span class="token punctuation">.</span><span class="token function">back</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">static</span> <span class="token keyword">void</span>
    <span class="token function">encoder_rec</span><span class="token punctuation">(</span>node <span class="token keyword">const</span><span class="token operator">*</span> cur<span class="token punctuation">,</span> std<span class="token double-colon punctuation">::</span>vector<span class="token operator">&lt;</span><span class="token keyword">bool</span><span class="token operator">&gt;</span> bits<span class="token punctuation">,</span> encoder_t<span class="token operator">&amp;</span> out<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">auto</span> l <span class="token operator">=</span> <span class="token generic-function"><span class="token function">dynamic_cast</span><span class="token generic class-name"><span class="token operator">&lt;</span>leaf <span class="token keyword">const</span><span class="token operator">*</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>cur<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        out<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>std<span class="token double-colon punctuation">::</span><span class="token function">make_pair</span><span class="token punctuation">(</span>l<span class="token operator">-&gt;</span>key<span class="token punctuation">,</span> std<span class="token double-colon punctuation">::</span><span class="token function">move</span><span class="token punctuation">(</span>bits<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">auto</span> b <span class="token operator">=</span> <span class="token generic-function"><span class="token function">dynamic_cast</span><span class="token generic class-name"><span class="token operator">&lt;</span>branch <span class="token keyword">const</span><span class="token operator">*</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>cur<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">encoder_rec</span><span class="token punctuation">(</span>b<span class="token operator">-&gt;</span>lhs<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">with_new_bit</span><span class="token punctuation">(</span>bits<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">encoder_rec</span><span class="token punctuation">(</span>b<span class="token operator">-&gt;</span>rhs<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">with_new_bit</span><span class="token punctuation">(</span>std<span class="token double-colon punctuation">::</span><span class="token function">move</span><span class="token punctuation">(</span>bits<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token function">unreachable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">static</span> encoder_t <span class="token function">make_encoder</span><span class="token punctuation">(</span>node <span class="token keyword">const</span><span class="token operator">&amp;</span> decoder<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">auto</span> ret <span class="token operator">=</span> <span class="token function">encoder_t</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token function">encoder_rec</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>decoder<span class="token punctuation">,</span> std<span class="token double-colon punctuation">::</span><span class="token generic-function"><span class="token function">vector</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token keyword">bool</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> ret<span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token keyword">return</span> ret<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>

  <span class="token keyword">auto</span> decoder <span class="token operator">=</span> helper<span class="token double-colon punctuation">::</span><span class="token function">make_decoder</span><span class="token punctuation">(</span>first<span class="token punctuation">,</span> last<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">auto</span> encoder <span class="token operator">=</span> helper<span class="token double-colon punctuation">::</span><span class="token function">make_encoder</span><span class="token punctuation">(</span><span class="token operator">*</span>decoder<span class="token punctuation">)</span><span class="token punctuation">;</span>
  underlying_ <span class="token operator">=</span> std<span class="token double-colon punctuation">::</span><span class="token generic-function"><span class="token function">make_shared</span><span class="token generic class-name"><span class="token operator">&lt;</span>data <span class="token keyword">const</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>
      data<span class="token punctuation">{</span>std<span class="token double-colon punctuation">::</span><span class="token function">move</span><span class="token punctuation">(</span>decoder<span class="token punctuation">)</span><span class="token punctuation">,</span> std<span class="token double-colon punctuation">::</span><span class="token function">move</span><span class="token punctuation">(</span>encoder<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">template</span> <span class="token operator">&lt;</span><span class="token keyword">typename</span> <span class="token class-name">Iter</span><span class="token operator">&gt;</span>
std<span class="token double-colon punctuation">::</span>vector<span class="token operator">&lt;</span><span class="token keyword">bool</span><span class="token operator">&gt;</span> codebook<span class="token double-colon punctuation">::</span><span class="token function">encode</span><span class="token punctuation">(</span>Iter <span class="token keyword">const</span> first<span class="token punctuation">,</span> Iter <span class="token keyword">const</span> last<span class="token punctuation">)</span> <span class="token keyword">const</span> <span class="token punctuation">{</span>
  std<span class="token double-colon punctuation">::</span>vector<span class="token operator">&lt;</span><span class="token keyword">bool</span><span class="token operator">&gt;</span> ret<span class="token punctuation">;</span>

  <span class="token keyword">auto</span><span class="token operator">&amp;</span> encoder <span class="token operator">=</span> underlying_<span class="token operator">-&gt;</span>encoder<span class="token punctuation">;</span>
  std<span class="token double-colon punctuation">::</span><span class="token function">for_each</span><span class="token punctuation">(</span>first<span class="token punctuation">,</span> last<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token operator">&amp;</span>ret<span class="token punctuation">,</span> <span class="token operator">&amp;</span>encoder<span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token keyword">char</span> c<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">auto</span> <span class="token keyword">const</span> it <span class="token operator">=</span>
        std<span class="token double-colon punctuation">::</span><span class="token function">find_if</span><span class="token punctuation">(</span><span class="token function">begin</span><span class="token punctuation">(</span>encoder<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">end</span><span class="token punctuation">(</span>encoder<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>c<span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token keyword">auto</span> <span class="token keyword">const</span><span class="token operator">&amp;</span> p<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">return</span> p<span class="token punctuation">.</span>first <span class="token operator">==</span> c<span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>it <span class="token operator">!=</span> <span class="token function">end</span><span class="token punctuation">(</span>encoder<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">auto</span> <span class="token keyword">const</span><span class="token operator">&amp;</span> code <span class="token operator">=</span> it<span class="token operator">-&gt;</span>second<span class="token punctuation">;</span>
      std<span class="token double-colon punctuation">::</span><span class="token function">copy</span><span class="token punctuation">(</span><span class="token function">begin</span><span class="token punctuation">(</span>code<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">end</span><span class="token punctuation">(</span>code<span class="token punctuation">)</span><span class="token punctuation">,</span> std<span class="token double-colon punctuation">::</span><span class="token function">back_inserter</span><span class="token punctuation">(</span>ret<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token keyword">throw</span> std<span class="token double-colon punctuation">::</span><span class="token function">invalid_argument</span><span class="token punctuation">(</span>
          <span class="token string">&quot;The range has a character which was not in the huffman set&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> ret<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">template</span> <span class="token operator">&lt;</span><span class="token keyword">typename</span> <span class="token class-name">Iter</span><span class="token operator">&gt;</span>
std<span class="token double-colon punctuation">::</span>string codebook<span class="token double-colon punctuation">::</span><span class="token function">decode</span><span class="token punctuation">(</span>Iter <span class="token keyword">const</span> first<span class="token punctuation">,</span> Iter <span class="token keyword">const</span> last<span class="token punctuation">)</span> <span class="token keyword">const</span> <span class="token punctuation">{</span>
  std<span class="token double-colon punctuation">::</span>string ret<span class="token punctuation">;</span>

  node <span class="token keyword">const</span><span class="token operator">*</span> <span class="token keyword">const</span> top <span class="token operator">=</span> underlying_<span class="token operator">-&gt;</span>decoder<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// returns a pair:</span>
  <span class="token comment">// the second member is the decoded character</span>
  <span class="token comment">// the first member is the place we&apos;ve gotten to in the range</span>
  <span class="token comment">// i.e., if [0] is an &apos;a&apos;, and we have</span>
  <span class="token comment">// [it, last) = { 0, 1, 1, 0 }</span>
  <span class="token comment">// we return (it&apos;, &apos;a&apos;) such that</span>
  <span class="token comment">// [it&apos;, last) = { 1, 1, 0 }</span>
  <span class="token keyword">auto</span> decode_single <span class="token operator">=</span>
      <span class="token punctuation">[</span>top<span class="token punctuation">]</span><span class="token punctuation">(</span>Iter it<span class="token punctuation">,</span> Iter <span class="token keyword">const</span> last<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> std<span class="token double-colon punctuation">::</span>pair<span class="token operator">&lt;</span>Iter<span class="token punctuation">,</span> <span class="token keyword">char</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
    node <span class="token keyword">const</span><span class="token operator">*</span> current_node <span class="token operator">=</span> top<span class="token punctuation">;</span>

    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token punctuation">;</span> it <span class="token operator">!=</span> last<span class="token punctuation">;</span> <span class="token operator">++</span>it<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">auto</span> l <span class="token operator">=</span> <span class="token generic-function"><span class="token function">dynamic_cast</span><span class="token generic class-name"><span class="token operator">&lt;</span>leaf <span class="token keyword">const</span><span class="token operator">*</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>current_node<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> std<span class="token double-colon punctuation">::</span><span class="token function">make_pair</span><span class="token punctuation">(</span>it<span class="token punctuation">,</span> l<span class="token operator">-&gt;</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">auto</span> b <span class="token operator">=</span> <span class="token generic-function"><span class="token function">dynamic_cast</span><span class="token generic class-name"><span class="token operator">&lt;</span>branch <span class="token keyword">const</span><span class="token operator">*</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>current_node<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">*</span>it<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          current_node <span class="token operator">=</span> b<span class="token operator">-&gt;</span>rhs<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
          current_node <span class="token operator">=</span> b<span class="token operator">-&gt;</span>lhs<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token function">unreachable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">auto</span> l <span class="token operator">=</span> <span class="token generic-function"><span class="token function">dynamic_cast</span><span class="token generic class-name"><span class="token operator">&lt;</span>leaf <span class="token keyword">const</span><span class="token operator">*</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>current_node<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> std<span class="token double-colon punctuation">::</span><span class="token function">make_pair</span><span class="token punctuation">(</span>last<span class="token punctuation">,</span> l<span class="token operator">-&gt;</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token keyword">throw</span> std<span class="token double-colon punctuation">::</span><span class="token function">invalid_argument</span><span class="token punctuation">(</span>
          <span class="token string">&quot;The range was not encoded with this huffman set&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>

  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">auto</span> it <span class="token operator">=</span> first<span class="token punctuation">;</span> it <span class="token operator">!=</span> last<span class="token punctuation">;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">auto</span> p <span class="token operator">=</span> <span class="token function">decode_single</span><span class="token punctuation">(</span>it<span class="token punctuation">,</span> last<span class="token punctuation">)</span><span class="token punctuation">;</span>
    it <span class="token operator">=</span> p<span class="token punctuation">.</span>first<span class="token punctuation">;</span>
    ret<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>p<span class="token punctuation">.</span>second<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">return</span> ret<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token punctuation">}</span> <span class="token comment">// namespace huffman</span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  std<span class="token double-colon punctuation">::</span>string to_be_encoded <span class="token operator">=</span> <span class="token raw-string string">R&quot;(bibbity bobbity)&quot;</span><span class="token punctuation">;</span>

  <span class="token keyword">auto</span> encoded <span class="token operator">=</span> huffman<span class="token double-colon punctuation">::</span><span class="token function">encoded_string</span><span class="token punctuation">(</span>to_be_encoded<span class="token punctuation">)</span><span class="token punctuation">;</span>

  std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">&quot;Encoded, the string looks like: &quot;</span><span class="token punctuation">;</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">bool</span> b <span class="token operator">:</span> encoded<span class="token punctuation">.</span>string<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> b<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">&quot;\nand decoded, the string looks like: &quot;</span> <span class="token operator">&lt;&lt;</span> encoded<span class="token punctuation">.</span><span class="token function">decoded</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">&quot;\n\nAs opposed to the original, which is &quot;</span>
            <span class="token operator">&lt;&lt;</span> to_be_encoded<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">8</span> <span class="token operator">&lt;&lt;</span> <span class="token string">&quot; bits, the encoded has size &quot;</span>
            <span class="token operator">&lt;&lt;</span> encoded<span class="token punctuation">.</span>string<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">&quot;.\n&quot;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
</div><div class="code-method-sample" data-lang="clj" data-name="Clojure"><pre class="language-"><code class="lang-clojure"><span class="token comment">;; earthfail</span>
<span class="token punctuation">(</span><span class="token keyword">ns</span> experiments.core<span class="token punctuation">)</span>

<span class="token comment">;; get a vector with chars and frequencies</span>

<span class="token punctuation">(</span><span class="token keyword">defn</span> tree-string <span class="token punctuation">[</span>st<span class="token punctuation">]</span>
  <span class="token string">&quot;take a string st and return the huffmantree with the frequency of
   each character included&quot;</span>
  <span class="token comment">;; vector of [character frequency] pair</span>
  <span class="token comment">;; for every char in string, added it to hash-map</span>
  <span class="token comment">;; with value one if it doesn&apos;t exist or increment its value</span>
  <span class="token punctuation">(</span><span class="token keyword">def</span> cf-vec <span class="token punctuation">(</span><span class="token function">vec</span>
               <span class="token punctuation">(</span><span class="token keyword">reduce</span> <span class="token punctuation">(</span><span class="token keyword">fn</span> <span class="token punctuation">[</span>m c<span class="token punctuation">]</span>
                         <span class="token punctuation">(</span><span class="token keyword">assoc</span> m c <span class="token punctuation">(</span><span class="token keyword">inc</span> <span class="token punctuation">(</span><span class="token keyword">get</span> m c <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                       <span class="token punctuation">{</span><span class="token punctuation">}</span>
                       st<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token comment">;; make a sorted list with nodes with bigger frequencies first</span>
  <span class="token comment">;; take the last two which will help in dividing the tree</span>
  <span class="token comment">;; the first and last elements before and after</span>
  <span class="token comment">;; the smallest two in the tree shouldn&apos;t change</span>
  <span class="token punctuation">(</span><span class="token keyword">loop</span> <span class="token punctuation">[</span>tree <span class="token punctuation">(</span><span class="token keyword">sort-by</span> last &gt; cf-vec<span class="token punctuation">)</span><span class="token punctuation">]</span>
    <span class="token punctuation">(</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">&lt;</span> <span class="token punctuation">(</span><span class="token keyword">count</span> tree<span class="token punctuation">)</span> <span class="token number">2</span><span class="token punctuation">)</span>
      <span class="token punctuation">(</span><span class="token keyword">first</span> tree<span class="token punctuation">)</span> <span class="token comment">; only of tree is one node or nil</span>
      <span class="token punctuation">(</span><span class="token keyword">let</span> <span class="token punctuation">[</span>sorted-tree <span class="token punctuation">(</span><span class="token keyword">sort-by</span> last &gt; tree<span class="token punctuation">)</span>
            mid <span class="token punctuation">(</span><span class="token function">take-last</span> <span class="token number">2</span> sorted-tree<span class="token punctuation">)</span>
            set-mid <span class="token punctuation">(</span><span class="token keyword">set</span> mid<span class="token punctuation">)</span>
            func <span class="token punctuation">(</span><span class="token keyword">complement</span> <span class="token punctuation">(</span><span class="token keyword">partial</span> contains? set-mid<span class="token punctuation">)</span><span class="token punctuation">)</span>
            firsty <span class="token punctuation">(</span><span class="token keyword">take-while</span> func tree<span class="token punctuation">)</span>
            <span class="token punctuation">[</span>middle lasty<span class="token punctuation">]</span> <span class="token punctuation">(</span><span class="token keyword">split-at</span> <span class="token number">2</span>
                                     <span class="token punctuation">(</span><span class="token keyword">drop-while</span> func tree<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
        <span class="token punctuation">(</span><span class="token keyword">recur</span>
         <span class="token punctuation">(</span><span class="token keyword">concat</span>
          firsty
          <span class="token comment">;; make a list with the two element in one list and</span>
          <span class="token comment">;; the sum of their frequencies e.g</span>
          <span class="token comment">;; &apos;(((node1 f1) (node2 f2)) f1+f2)</span>
          <span class="token punctuation">(</span><span class="token keyword">list</span> <span class="token punctuation">(</span><span class="token keyword">list</span> middle <span class="token punctuation">(</span><span class="token keyword">reduce</span> <span class="token operator">#</span><span class="token punctuation">(</span><span class="token keyword">+</span> %<span class="token number">1</span> <span class="token punctuation">(</span><span class="token keyword">last</span> %<span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token number">0</span> middle<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
          lasty<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token punctuation">(</span><span class="token keyword">defn</span> remove-freq <span class="token punctuation">[</span>tree<span class="token punctuation">]</span>
  <span class="token string">&quot;remove the frequencies in the huffmantree tree&quot;</span>
  <span class="token punctuation">(</span><span class="token keyword">cond</span>
    <span class="token punctuation">(</span><span class="token function">char?</span> tree<span class="token punctuation">)</span> tree                 <span class="token comment">; check if this is a branch</span>
    <span class="token comment">;; if the tree is a node and frequency then ignore frequency</span>
    <span class="token punctuation">(</span><span class="token function">integer?</span> <span class="token punctuation">(</span><span class="token keyword">second</span> tree<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token function">remove-freq</span> <span class="token punctuation">(</span><span class="token keyword">first</span> tree<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">;remove the frequency</span>
    <span class="token comment">;; if the tree consists of two nodes then apply to both and combine</span>
    <span class="token symbol">:else</span> <span class="token punctuation">(</span><span class="token keyword">list</span> <span class="token punctuation">(</span><span class="token function">remove-freq</span> <span class="token punctuation">(</span><span class="token keyword">first</span> tree<span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">(</span><span class="token function">remove-freq</span> <span class="token punctuation">(</span><span class="token keyword">second</span> tree<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token punctuation">(</span><span class="token keyword">defn</span> hash-tree <span class="token punctuation">[</span>tree<span class="token punctuation">]</span>
  <span class="token string">&quot;make a hashmap with code for each letter as key and the letter as
  value&quot;</span>
  <span class="token punctuation">(</span><span class="token keyword">cond</span>
    <span class="token punctuation">(</span><span class="token function">char?</span> tree<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token string">&quot;&quot;</span> tree<span class="token punctuation">}</span>
    <span class="token symbol">:else</span>
    <span class="token punctuation">(</span><span class="token keyword">let</span> <span class="token punctuation">[</span>left-map <span class="token punctuation">(</span><span class="token function">hash-tree</span> <span class="token punctuation">(</span><span class="token keyword">first</span> tree<span class="token punctuation">)</span><span class="token punctuation">)</span>
          right-map <span class="token punctuation">(</span><span class="token function">hash-tree</span> <span class="token punctuation">(</span><span class="token keyword">second</span> tree<span class="token punctuation">)</span><span class="token punctuation">)</span>
          func <span class="token operator">#</span><span class="token punctuation">(</span><span class="token keyword">apply</span> hash-map         <span class="token comment">; apply hash-map because</span>
                                        <span class="token comment">; interleave return a seq</span>
                       <span class="token punctuation">(</span><span class="token keyword">interleave</span>
                        <span class="token punctuation">(</span><span class="token keyword">map</span> <span class="token punctuation">(</span><span class="token keyword">partial</span> str %<span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token keyword">keys</span> %<span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">;add 0 or 1</span>
                                        <span class="token comment">;to the start</span>
                                        <span class="token comment">;of the keys</span>
                        <span class="token punctuation">(</span><span class="token keyword">vals</span> %<span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
      <span class="token comment">;; add &quot;0&quot; to the keys of left nodes and &quot;1&quot; to the right nodes</span>
      <span class="token punctuation">(</span><span class="token keyword">merge</span> <span class="token punctuation">(</span><span class="token function">func</span> left-map <span class="token string">&quot;0&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token function">func</span> right-map <span class="token string">&quot;1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>


<span class="token punctuation">(</span><span class="token keyword">defn</span> coder <span class="token punctuation">[</span>s hash-coder<span class="token punctuation">]</span>
  <span class="token string">&quot;take a string s and return a coded string&quot;</span>
  <span class="token punctuation">(</span><span class="token keyword">apply</span> str <span class="token punctuation">(</span><span class="token keyword">map</span> hash-coder s<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token punctuation">(</span><span class="token keyword">defn</span> decoder <span class="token punctuation">[</span>s hash-decoder<span class="token punctuation">]</span>
  <span class="token string">&quot;takes a string s and a hash-map hash-decoder and decode s&quot;</span>
  <span class="token comment">;; code keyword in hashmap is for storing codes untill they are</span>
  <span class="token comment">;; complete and can be decoded with the decoder</span>
  <span class="token punctuation">(</span><span class="token keyword">get</span> <span class="token punctuation">(</span><span class="token keyword">reduce</span> <span class="token punctuation">(</span><span class="token keyword">fn</span> <span class="token punctuation">[</span>m code<span class="token punctuation">]</span>             <span class="token comment">; reduce return {:message</span>
                                        <span class="token comment">; message,:code _}</span>
                 <span class="token punctuation">(</span><span class="token keyword">let</span> <span class="token punctuation">[</span>new-code <span class="token punctuation">(</span><span class="token keyword">str</span> <span class="token punctuation">(</span><span class="token function">m</span> <span class="token symbol">:code</span><span class="token punctuation">)</span> code<span class="token punctuation">)</span><span class="token punctuation">]</span>
                   <span class="token punctuation">(</span><span class="token keyword">if-let</span>  <span class="token punctuation">[</span>letter <span class="token punctuation">(</span><span class="token keyword">get</span> hash-decoder new-code<span class="token punctuation">)</span><span class="token punctuation">]</span>
                     <span class="token comment">;; if there is a letter then add it to :message</span>
                     <span class="token comment">;; and revert :code to empty</span>
                     <span class="token punctuation">(</span><span class="token keyword">assoc</span> <span class="token punctuation">(</span><span class="token function">update</span> m <span class="token symbol">:message</span> <span class="token operator">#</span><span class="token punctuation">(</span><span class="token keyword">str</span> % letter<span class="token punctuation">)</span><span class="token punctuation">)</span>
                            <span class="token symbol">:code</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">)</span>
                     <span class="token comment">;; if there is not a letter then just add the</span>
                     <span class="token comment">;; code letter to the :code</span>
                     <span class="token punctuation">(</span><span class="token function">update</span> m <span class="token symbol">:code</span> <span class="token operator">#</span><span class="token punctuation">(</span><span class="token keyword">str</span> % code<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
               <span class="token punctuation">{</span><span class="token symbol">:message</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span><span class="token symbol">:code</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">}</span>
               s<span class="token punctuation">)</span>
       <span class="token symbol">:message</span><span class="token punctuation">)</span><span class="token punctuation">)</span>           <span class="token comment">;extract :message  value</span>
<span class="token comment">;; ----------------EXAMPLE----------------</span>
<span class="token punctuation">(</span><span class="token keyword">def</span> st <span class="token string">&quot;(bibbity bobbity)&quot;</span><span class="token punctuation">)</span>

<span class="token punctuation">(</span><span class="token keyword">def</span> hash-decoder <span class="token punctuation">(</span><span class="token keyword">-&gt;&gt;</span>
                   st
                   tree-string
                   remove-freq
                   hash-tree<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token keyword">def</span> hash-coder <span class="token punctuation">(</span><span class="token function">clojure.set/map-invert</span> hash-decoder<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token keyword">println</span> <span class="token string">&quot;coding...&quot;</span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token keyword">def</span> code <span class="token punctuation">(</span><span class="token function">coder</span> st hash-coder<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token function">clojure.pprint/pprint</span> code<span class="token punctuation">)</span>

<span class="token punctuation">(</span><span class="token keyword">println</span> <span class="token string">&quot;\ndecoding...&quot;</span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token function">clojure.pprint/pprint</span> <span class="token punctuation">(</span><span class="token function">decoder</span> code hash-decoder<span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre>
</div><div class="code-method-sample" data-lang="py" data-name="Python"><pre class="language-"><code class="lang-python"><span class="token comment"># Huffman Encoding</span>
<span class="token comment"># Python 2.7+</span>
<span class="token comment"># Submitted by Matthew Giallourakis</span>

<span class="token keyword">from</span> collections <span class="token keyword">import</span> Counter

<span class="token comment"># constructs the tree</span>
<span class="token keyword">def</span> <span class="token function">build_huffman_tree</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token punctuation">:</span>

    <span class="token comment"># get sorted list of character and frequency pairs</span>
    frequencies <span class="token operator">=</span> Counter<span class="token punctuation">(</span>message<span class="token punctuation">)</span>
    trees <span class="token operator">=</span> frequencies<span class="token punctuation">.</span>most_common<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token comment"># while there is more than one tree</span>
    <span class="token keyword">while</span> <span class="token builtin">len</span><span class="token punctuation">(</span>trees<span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">1</span><span class="token punctuation">:</span>

        <span class="token comment"># pop off the two trees of least weight from the trees list</span>
        tree_left<span class="token punctuation">,</span>weight_left <span class="token operator">=</span> trees<span class="token punctuation">.</span>pop<span class="token punctuation">(</span><span class="token punctuation">)</span>
        tree_right<span class="token punctuation">,</span>weight_right <span class="token operator">=</span> trees<span class="token punctuation">.</span>pop<span class="token punctuation">(</span><span class="token punctuation">)</span>

        <span class="token comment"># combine the nodes and add back to the nodes list</span>
        new_tree <span class="token operator">=</span> <span class="token punctuation">[</span>tree_left<span class="token punctuation">,</span> tree_right<span class="token punctuation">]</span>
        new_weight <span class="token operator">=</span> weight_left <span class="token operator">+</span> weight_right

        <span class="token comment"># find the first tree that has a weight smaller than new_weight and returns its index in the list</span>
        <span class="token comment"># If no such tree can be found, use len(trees) instead to append</span>
        index <span class="token operator">=</span> <span class="token builtin">next</span><span class="token punctuation">(</span><span class="token punctuation">(</span>i <span class="token keyword">for</span> i<span class="token punctuation">,</span> tree <span class="token keyword">in</span> <span class="token builtin">enumerate</span><span class="token punctuation">(</span>trees<span class="token punctuation">)</span> <span class="token keyword">if</span> tree<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">&lt;</span> new_weight<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token builtin">len</span><span class="token punctuation">(</span>trees<span class="token punctuation">)</span><span class="token punctuation">)</span>

        <span class="token comment"># insert the new tree there</span>
        trees<span class="token punctuation">.</span>insert<span class="token punctuation">(</span>index<span class="token punctuation">,</span> <span class="token punctuation">(</span>new_tree<span class="token punctuation">,</span> new_weight<span class="token punctuation">)</span><span class="token punctuation">)</span>

    <span class="token comment"># Return an empty list if the message was empty, else the tree</span>
    huffman_tree <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token keyword">if</span> <span class="token keyword">not</span> trees <span class="token keyword">else</span> trees<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
    <span class="token keyword">return</span> huffman_tree

<span class="token comment"># constructs the mapping with recursion</span>
<span class="token keyword">def</span> <span class="token function">build_codebook</span><span class="token punctuation">(</span>tree<span class="token punctuation">,</span> code<span class="token operator">=</span><span class="token string">&apos;&apos;</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># Check whether our tree contains more than 1 element or not</span>
    <span class="token keyword">if</span> <span class="token keyword">not</span> tree<span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token keyword">elif</span> <span class="token builtin">type</span><span class="token punctuation">(</span>tree<span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token builtin">list</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token punctuation">[</span><span class="token punctuation">(</span>tree<span class="token punctuation">,</span> <span class="token string">&apos;0&apos;</span><span class="token punctuation">)</span><span class="token punctuation">]</span>

    codebook <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>

    <span class="token comment"># split the tree</span>
    left_tree<span class="token punctuation">,</span> right_tree <span class="token operator">=</span> tree

    <span class="token comment"># if the left node has children, find the mapping of those children</span>
    <span class="token comment"># else pair the character with the current code + 0</span>
    <span class="token keyword">if</span> <span class="token builtin">type</span><span class="token punctuation">(</span>left_tree<span class="token punctuation">)</span> <span class="token keyword">is</span> <span class="token builtin">list</span><span class="token punctuation">:</span>
        codebook <span class="token operator">+=</span> build_codebook<span class="token punctuation">(</span>left_tree<span class="token punctuation">,</span> code<span class="token operator">+</span><span class="token string">&apos;0&apos;</span><span class="token punctuation">)</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        codebook<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token punctuation">(</span>left_tree<span class="token punctuation">,</span> code<span class="token operator">+</span><span class="token string">&apos;0&apos;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

    <span class="token comment"># if the right node has children, find the mapping of those children</span>
    <span class="token comment"># else pair the character with the current code + 1</span>
    <span class="token keyword">if</span> <span class="token builtin">type</span><span class="token punctuation">(</span>right_tree<span class="token punctuation">)</span> <span class="token keyword">is</span> <span class="token builtin">list</span><span class="token punctuation">:</span>
        codebook <span class="token operator">+=</span> build_codebook<span class="token punctuation">(</span>right_tree<span class="token punctuation">,</span> code<span class="token operator">+</span><span class="token string">&apos;1&apos;</span><span class="token punctuation">)</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        codebook<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token punctuation">(</span>right_tree<span class="token punctuation">,</span> code<span class="token operator">+</span><span class="token string">&apos;1&apos;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> codebook

<span class="token comment"># encodes the message</span>
<span class="token keyword">def</span> <span class="token function">huffman_encode</span><span class="token punctuation">(</span>codebook<span class="token punctuation">,</span> message<span class="token punctuation">)</span><span class="token punctuation">:</span>

    encoded_message <span class="token operator">=</span> <span class="token string">&apos;&apos;</span>

    <span class="token comment"># build a char -&gt; code dictionary</span>
    forward_dict <span class="token operator">=</span> <span class="token builtin">dict</span><span class="token punctuation">(</span>codebook<span class="token punctuation">)</span>

    <span class="token comment"># replace each character with its code</span>
    <span class="token keyword">for</span> char <span class="token keyword">in</span> message<span class="token punctuation">:</span>
        encoded_message <span class="token operator">+=</span> forward_dict<span class="token punctuation">[</span>char<span class="token punctuation">]</span>

    <span class="token keyword">return</span> encoded_message

<span class="token comment"># decodes a message</span>
<span class="token keyword">def</span> <span class="token function">huffman_decode</span><span class="token punctuation">(</span>codebook<span class="token punctuation">,</span> encoded_message<span class="token punctuation">)</span><span class="token punctuation">:</span>

    decoded_message <span class="token operator">=</span> <span class="token string">&apos;&apos;</span>
    key <span class="token operator">=</span> <span class="token string">&apos;&apos;</span>

    <span class="token comment"># build a code -&gt; char dictionary</span>
    inverse_dict <span class="token operator">=</span> <span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">(</span>v<span class="token punctuation">,</span> k<span class="token punctuation">)</span> <span class="token keyword">for</span> k<span class="token punctuation">,</span> v <span class="token keyword">in</span> codebook<span class="token punctuation">]</span><span class="token punctuation">)</span>

    <span class="token comment"># for each bit in the encoding</span>
    <span class="token comment"># if the bit is in the dictionary, replace the bit with the paired character</span>
    <span class="token comment"># else look at the bit and the following bits together until a match occurs</span>
    <span class="token comment"># move to the next bit not yet looked at</span>
    <span class="token keyword">for</span> index<span class="token punctuation">,</span> bit <span class="token keyword">in</span> <span class="token builtin">enumerate</span><span class="token punctuation">(</span>encoded_message<span class="token punctuation">)</span><span class="token punctuation">:</span>
        key <span class="token operator">+=</span> bit
        <span class="token keyword">if</span> key <span class="token keyword">in</span> inverse_dict<span class="token punctuation">:</span>
            decoded_message <span class="token operator">+=</span> inverse_dict<span class="token punctuation">[</span>key<span class="token punctuation">]</span>
            key <span class="token operator">=</span> <span class="token string">&apos;&apos;</span>

    <span class="token keyword">return</span> decoded_message

<span class="token keyword">def</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>

    <span class="token comment"># test example</span>
    message <span class="token operator">=</span> <span class="token string">&apos;bibbity_bobbity&apos;</span>
    tree <span class="token operator">=</span> build_huffman_tree<span class="token punctuation">(</span>message<span class="token punctuation">)</span>
    codebook <span class="token operator">=</span> build_codebook<span class="token punctuation">(</span>tree<span class="token punctuation">)</span>
    encoded_message <span class="token operator">=</span> huffman_encode<span class="token punctuation">(</span>codebook<span class="token punctuation">,</span> message<span class="token punctuation">)</span>
    decoded_message <span class="token operator">=</span> huffman_decode<span class="token punctuation">(</span>codebook<span class="token punctuation">,</span> encoded_message<span class="token punctuation">)</span>

    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&apos;message: &apos;</span> <span class="token operator">+</span> message<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&apos;huffman tree: &apos;</span> <span class="token operator">+</span> <span class="token builtin">str</span><span class="token punctuation">(</span>tree<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&apos;codebook: &apos;</span> <span class="token operator">+</span> <span class="token builtin">str</span><span class="token punctuation">(</span>codebook<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&apos;encoded message: &apos;</span> <span class="token operator">+</span> encoded_message<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&apos;decoded message: &apos;</span> <span class="token operator">+</span> decoded_message<span class="token punctuation">)</span>

    <span class="token comment"># prints the following:</span>
    <span class="token comment">#</span>
    <span class="token comment">#  message: bibbity_bobbity</span>
    <span class="token comment">#  huffman_tree: [&apos;b&apos;, [[[&apos;_&apos;, &apos;o&apos;], &apos;y&apos;], [&apos;t&apos;, &apos;i&apos;]]]</span>
    <span class="token comment">#  codebook: [(&apos;b&apos;, &apos;0&apos;), (&apos;_&apos;, &apos;1000&apos;), (&apos;o&apos;, &apos;1001&apos;),</span>
    <span class="token comment">#             (&apos;y&apos;, &apos;101&apos;), (&apos;t&apos;, &apos;110&apos;), (&apos;i&apos;, &apos;111&apos;)]</span>
    <span class="token comment">#  encoded_message: 01110011111010110000100100111110101</span>
    <span class="token comment">#  decoded_message: bibbity_bobbity</span>

<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">&apos;__main__&apos;</span><span class="token punctuation">:</span>
    main<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre>
</div><div class="code-method-sample" data-lang="js" data-name="JavaScript"><pre class="language-"><code class="lang-javascript"><span class="token keyword">function</span> <span class="token function">encode</span><span class="token punctuation">(</span><span class="token parameter">str</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> tree <span class="token operator">=</span> <span class="token function">createTree</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> codebook <span class="token operator">=</span> <span class="token function">createCodebook</span><span class="token punctuation">(</span>tree<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">string</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token operator">...</span>str<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">c</span> <span class="token operator">=&gt;</span> codebook<span class="token punctuation">[</span>c<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    tree<span class="token punctuation">,</span>
    codebook
  <span class="token punctuation">}</span><span class="token punctuation">;</span>

  <span class="token keyword">function</span> <span class="token function">createTree</span><span class="token punctuation">(</span><span class="token parameter">str</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> chars <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token operator">...</span>str<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> charCounts <span class="token operator">=</span> chars<span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">counts<span class="token punctuation">,</span> char</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      counts<span class="token punctuation">[</span>char<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span>counts<span class="token punctuation">[</span>char<span class="token punctuation">]</span> <span class="token operator">||</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> counts<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">const</span> nodes <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">entries</span><span class="token punctuation">(</span>charCounts<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">[</span>key<span class="token punctuation">,</span> weight<span class="token punctuation">]</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{</span> key<span class="token punctuation">,</span> weight <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> priorityQueue <span class="token operator">=</span> <span class="token function">makeQueue</span><span class="token punctuation">(</span>nodes<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">while</span> <span class="token punctuation">(</span>priorityQueue<span class="token punctuation">.</span>data<span class="token punctuation">.</span>length <span class="token operator">&gt;</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> left <span class="token operator">=</span> priorityQueue<span class="token punctuation">.</span><span class="token function">dequeue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">const</span> right <span class="token operator">=</span> priorityQueue<span class="token punctuation">.</span><span class="token function">dequeue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      priorityQueue<span class="token punctuation">.</span><span class="token function">enqueue</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">weight</span><span class="token operator">:</span> left<span class="token punctuation">.</span>weight <span class="token operator">+</span> right<span class="token punctuation">.</span>weight<span class="token punctuation">,</span> left<span class="token punctuation">,</span> right <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> priorityQueue<span class="token punctuation">.</span><span class="token function">dequeue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">function</span> <span class="token function">createCodebook</span><span class="token punctuation">(</span><span class="token parameter">tree</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">recurse</span><span class="token punctuation">(</span>tree<span class="token punctuation">,</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">function</span> <span class="token function">recurse</span><span class="token punctuation">(</span><span class="token parameter">node<span class="token punctuation">,</span> bitstring<span class="token punctuation">,</span> dict</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>node<span class="token punctuation">.</span>left <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>node<span class="token punctuation">.</span>right<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        dict<span class="token punctuation">[</span>node<span class="token punctuation">.</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> bitstring<span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>node<span class="token punctuation">.</span>left<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token function">recurse</span><span class="token punctuation">(</span>node<span class="token punctuation">.</span>left<span class="token punctuation">,</span> bitstring <span class="token operator">+</span> <span class="token string">&quot;0&quot;</span><span class="token punctuation">,</span> dict<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span>node<span class="token punctuation">.</span>right<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token function">recurse</span><span class="token punctuation">(</span>node<span class="token punctuation">.</span>right<span class="token punctuation">,</span> bitstring <span class="token operator">+</span> <span class="token string">&quot;1&quot;</span><span class="token punctuation">,</span> dict<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">return</span> dict<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">decode</span><span class="token punctuation">(</span><span class="token parameter">bitstring<span class="token punctuation">,</span> tree</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token keyword">let</span> node <span class="token operator">=</span> tree<span class="token punctuation">;</span>

  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> bit <span class="token keyword">of</span> <span class="token punctuation">[</span><span class="token operator">...</span>bitstring<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    node <span class="token operator">=</span> bit <span class="token operator">===</span> <span class="token string">&quot;0&quot;</span> <span class="token operator">?</span> node<span class="token punctuation">.</span>left <span class="token operator">:</span> node<span class="token punctuation">.</span>right<span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>node<span class="token punctuation">.</span>left <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>node<span class="token punctuation">.</span>right<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      result<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>node<span class="token punctuation">.</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>
      node <span class="token operator">=</span> tree<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">return</span> result<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// This queue implementation is horribly inefficient, but a proper, heap-based implementation would</span>
<span class="token comment">// be longer that the algorithm itself</span>
<span class="token keyword">function</span> <span class="token function">makeQueue</span><span class="token punctuation">(</span><span class="token parameter">iterable</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">data</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token operator">...</span>iterable<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">sort</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> a<span class="token punctuation">.</span>weight <span class="token operator">-</span> b<span class="token punctuation">.</span>weight<span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">enqueue</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> target <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>data<span class="token punctuation">.</span><span class="token function">findIndex</span><span class="token punctuation">(</span><span class="token parameter">x</span> <span class="token operator">=&gt;</span> x<span class="token punctuation">.</span>weight <span class="token operator">&gt;</span> value<span class="token punctuation">.</span>weight<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>target <span class="token operator">===</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>data<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>data <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token operator">...</span><span class="token keyword">this</span><span class="token punctuation">.</span>data<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> target<span class="token punctuation">)</span><span class="token punctuation">,</span> value<span class="token punctuation">,</span> <span class="token operator">...</span><span class="token keyword">this</span><span class="token punctuation">.</span>data<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span>target<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">dequeue</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>data<span class="token punctuation">.</span><span class="token function">shift</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> encoded <span class="token operator">=</span> <span class="token function">encode</span><span class="token punctuation">(</span><span class="token string">&quot;bibbity bobbity&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> decoded <span class="token operator">=</span> <span class="token function">decode</span><span class="token punctuation">(</span>encoded<span class="token punctuation">.</span>string<span class="token punctuation">,</span> encoded<span class="token punctuation">.</span>tree<span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>encoded<span class="token punctuation">.</span>string<span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>decoded<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
</div><div class="code-method-sample" data-lang="java" data-name="Java"><pre class="language-"><code class="lang-java"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token operator">*</span></span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">Huffman</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">HuffmanTree</span> huffmanTree <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HuffmanTree</span><span class="token punctuation">(</span><span class="token string">&quot;bibbity_bobbity&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        huffmanTree<span class="token punctuation">.</span><span class="token function">createTree</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> encoded <span class="token operator">=</span> huffmanTree<span class="token punctuation">.</span><span class="token function">encode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;Encoded String: &quot;</span> <span class="token operator">+</span> encoded<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;Decoded String: &quot;</span> <span class="token operator">+</span> huffmanTree<span class="token punctuation">.</span><span class="token function">decode</span><span class="token punctuation">(</span>encoded<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">TreeNode</span> <span class="token punctuation">{</span>
    <span class="token class-name">String</span> letter <span class="token operator">=</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span> frequency <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token class-name">TreeNode</span> left <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">,</span> right <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">TreeNode</span><span class="token punctuation">(</span><span class="token class-name">String</span> letter<span class="token punctuation">,</span> <span class="token keyword">int</span> frequency<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>letter <span class="token operator">=</span> letter<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>frequency <span class="token operator">=</span> frequency<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token class-name">TreeNode</span><span class="token punctuation">(</span><span class="token keyword">int</span> frequency<span class="token punctuation">,</span> <span class="token class-name">TreeNode</span> left<span class="token punctuation">,</span> <span class="token class-name">TreeNode</span> right<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>frequency <span class="token operator">=</span> frequency<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>left <span class="token operator">=</span> left<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>right <span class="token operator">=</span> right<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">HuffmanTree</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span> frequencyMap <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> codeBook <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> reverseCodeBook <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">TreeNode</span> root<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> stringToEncode<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">HuffmanTree</span><span class="token punctuation">(</span><span class="token class-name">String</span> stringToEncode<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>stringToEncode <span class="token operator">=</span> stringToEncode<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">createTree</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> stringToEncode<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">String</span> key <span class="token operator">=</span> <span class="token class-name">Character</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span>stringToEncode<span class="token punctuation">.</span><span class="token function">charAt</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>frequencyMap<span class="token punctuation">.</span><span class="token function">containsKey</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                frequencyMap<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                <span class="token keyword">int</span> frequency <span class="token operator">=</span> frequencyMap<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
                frequencyMap<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> frequency<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token class-name">Queue</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">TreeNode</span><span class="token punctuation">&gt;</span></span> priorityQueue <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PriorityQueue</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token class-name">Comparator</span><span class="token punctuation">.</span><span class="token function">comparingInt</span><span class="token punctuation">(</span>o <span class="token operator">-&gt;</span> o<span class="token punctuation">.</span>frequency<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Map<span class="token punctuation">.</span>Entry</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span> m <span class="token operator">:</span> frequencyMap<span class="token punctuation">.</span><span class="token function">entrySet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            priorityQueue<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">TreeNode</span><span class="token punctuation">(</span>m<span class="token punctuation">.</span><span class="token function">getKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> m<span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">while</span> <span class="token punctuation">(</span>priorityQueue<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">TreeNode</span> left <span class="token operator">=</span> priorityQueue<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">TreeNode</span> right <span class="token operator">=</span> priorityQueue<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            priorityQueue<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">TreeNode</span><span class="token punctuation">(</span>left<span class="token punctuation">.</span>frequency <span class="token operator">+</span> right<span class="token punctuation">.</span>frequency<span class="token punctuation">,</span> left<span class="token punctuation">,</span> right<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        root <span class="token operator">=</span> priorityQueue<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">traverse</span><span class="token punctuation">(</span><span class="token class-name">TreeNode</span> node<span class="token punctuation">,</span> <span class="token class-name">StringBuilder</span> code<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>node<span class="token punctuation">.</span>left <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> node<span class="token punctuation">.</span>right <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            codeBook<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>node<span class="token punctuation">.</span>letter<span class="token punctuation">,</span> code<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>node<span class="token punctuation">.</span>left <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">traverse</span><span class="token punctuation">(</span>node<span class="token punctuation">.</span>left<span class="token punctuation">,</span> code<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            code<span class="token punctuation">.</span><span class="token function">deleteCharAt</span><span class="token punctuation">(</span>code<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>node<span class="token punctuation">.</span>right <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">traverse</span><span class="token punctuation">(</span>node<span class="token punctuation">.</span>right<span class="token punctuation">,</span> code<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            code<span class="token punctuation">.</span><span class="token function">deleteCharAt</span><span class="token punctuation">(</span>code<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">printCodeBook</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;Code Book&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Map<span class="token punctuation">.</span>Entry</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> m <span class="token operator">:</span> codeBook<span class="token punctuation">.</span><span class="token function">entrySet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>m<span class="token punctuation">.</span><span class="token function">getKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;\t&quot;</span> <span class="token operator">+</span> m<span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token class-name">CodeBookReverse</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Map<span class="token punctuation">.</span>Entry</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> m <span class="token operator">:</span> codeBook<span class="token punctuation">.</span><span class="token function">entrySet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            reverseCodeBook<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>m<span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> m<span class="token punctuation">.</span><span class="token function">getKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">encode</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">traverse</span><span class="token punctuation">(</span>root<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">StringBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">StringBuilder</span> encode <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StringBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> stringToEncode<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">String</span> k <span class="token operator">=</span> <span class="token class-name">Character</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span>stringToEncode<span class="token punctuation">.</span><span class="token function">charAt</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            encode<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>codeBook<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>k<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token function">printCodeBook</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> encode<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">decode</span><span class="token punctuation">(</span><span class="token class-name">String</span> encoded<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">StringBuilder</span> decoded <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StringBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> key <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StringBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">CodeBookReverse</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> encoded<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            key <span class="token operator">=</span> key<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>encoded<span class="token punctuation">.</span><span class="token function">charAt</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>reverseCodeBook<span class="token punctuation">.</span><span class="token function">containsKey</span><span class="token punctuation">(</span>key<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                decoded<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>reverseCodeBook<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>key<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                key <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StringBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> decoded<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
</div><div class="code-method-sample" data-lang="go" data-name="Go"><pre class="language-"><code class="lang-go"><span class="token keyword">package</span> main

<span class="token keyword">import</span> <span class="token punctuation">(</span>
    <span class="token string">&quot;container/heap&quot;</span>
    <span class="token string">&quot;fmt&quot;</span>
<span class="token punctuation">)</span>

<span class="token keyword">type</span> node <span class="token keyword">struct</span> <span class="token punctuation">{</span>
    freq  <span class="token builtin">int</span>
    char  <span class="token builtin">rune</span>
    left  <span class="token operator">*</span>node
    right <span class="token operator">*</span>node
<span class="token punctuation">}</span>

<span class="token keyword">type</span> codebook <span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">rune</span><span class="token punctuation">]</span><span class="token builtin">string</span>
<span class="token keyword">type</span> nodeHeap <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">*</span>node

<span class="token keyword">func</span> <span class="token punctuation">(</span>n nodeHeap<span class="token punctuation">)</span> <span class="token function">Len</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token builtin">int</span>           <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token function">len</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span> <span class="token punctuation">}</span>
<span class="token keyword">func</span> <span class="token punctuation">(</span>n nodeHeap<span class="token punctuation">)</span> <span class="token function">Less</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> j <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token builtin">bool</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> n<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>freq <span class="token operator">&gt;</span> n<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">.</span>freq <span class="token punctuation">}</span>
<span class="token keyword">func</span> <span class="token punctuation">(</span>n nodeHeap<span class="token punctuation">)</span> <span class="token function">Swap</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> j <span class="token builtin">int</span><span class="token punctuation">)</span>      <span class="token punctuation">{</span> n<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> n<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">=</span> n<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">,</span> n<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token punctuation">(</span>n <span class="token operator">*</span>nodeHeap<span class="token punctuation">)</span> <span class="token function">Push</span><span class="token punctuation">(</span>x <span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> node<span class="token punctuation">,</span> ok <span class="token operator">:=</span> x<span class="token punctuation">.</span><span class="token punctuation">(</span><span class="token operator">*</span>node<span class="token punctuation">)</span><span class="token punctuation">;</span> ok <span class="token punctuation">{</span>
        <span class="token operator">*</span>n <span class="token operator">=</span> <span class="token function">append</span><span class="token punctuation">(</span><span class="token operator">*</span>n<span class="token punctuation">,</span> node<span class="token punctuation">)</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;I got a node of Type %T\n&quot;</span><span class="token punctuation">,</span> x<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token punctuation">(</span>n <span class="token operator">*</span>nodeHeap<span class="token punctuation">)</span> <span class="token function">Pop</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token punctuation">{</span>
    old <span class="token operator">:=</span> <span class="token operator">*</span>n
    l <span class="token operator">:=</span> <span class="token function">len</span><span class="token punctuation">(</span>old<span class="token punctuation">)</span>
    x <span class="token operator">:=</span> old<span class="token punctuation">[</span>l<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span>
    <span class="token operator">*</span>n <span class="token operator">=</span> old<span class="token punctuation">[</span><span class="token number">0</span> <span class="token punctuation">:</span> l<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span>
    <span class="token keyword">return</span> x
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">buildTree</span><span class="token punctuation">(</span>message <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token operator">*</span>node <span class="token punctuation">{</span>
    freqMap <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">rune</span><span class="token punctuation">]</span><span class="token operator">*</span>node<span class="token punctuation">)</span>
    h <span class="token operator">:=</span> <span class="token function">new</span><span class="token punctuation">(</span>nodeHeap<span class="token punctuation">)</span>
    heap<span class="token punctuation">.</span><span class="token function">Init</span><span class="token punctuation">(</span>h<span class="token punctuation">)</span> <span class="token comment">// really needed?</span>

    <span class="token keyword">for</span> <span class="token boolean">_</span><span class="token punctuation">,</span> char <span class="token operator">:=</span> <span class="token keyword">range</span> message <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token boolean">_</span><span class="token punctuation">,</span> ok <span class="token operator">:=</span> freqMap<span class="token punctuation">[</span>char<span class="token punctuation">]</span><span class="token punctuation">;</span> ok <span class="token punctuation">{</span>
            freqMap<span class="token punctuation">[</span>char<span class="token punctuation">]</span><span class="token punctuation">.</span>freq<span class="token operator">++</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            newNode <span class="token operator">:=</span> <span class="token function">new</span><span class="token punctuation">(</span>node<span class="token punctuation">)</span>
            newNode<span class="token punctuation">.</span>freq <span class="token operator">=</span> <span class="token number">1</span>
            newNode<span class="token punctuation">.</span>char <span class="token operator">=</span> char
            freqMap<span class="token punctuation">[</span>char<span class="token punctuation">]</span> <span class="token operator">=</span> newNode
            heap<span class="token punctuation">.</span><span class="token function">Push</span><span class="token punctuation">(</span>h<span class="token punctuation">,</span> newNode<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">for</span> h<span class="token punctuation">.</span><span class="token function">Len</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">1</span> <span class="token punctuation">{</span>
        left<span class="token punctuation">,</span> right <span class="token operator">:=</span> h<span class="token punctuation">.</span><span class="token function">Pop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token punctuation">(</span><span class="token operator">*</span>node<span class="token punctuation">)</span><span class="token punctuation">,</span> h<span class="token punctuation">.</span><span class="token function">Pop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token punctuation">(</span><span class="token operator">*</span>node<span class="token punctuation">)</span>
        branch <span class="token operator">:=</span> <span class="token function">new</span><span class="token punctuation">(</span>node<span class="token punctuation">)</span>
        branch<span class="token punctuation">.</span>freq <span class="token operator">=</span> right<span class="token punctuation">.</span>freq <span class="token operator">+</span> left<span class="token punctuation">.</span>freq
        branch<span class="token punctuation">.</span>left <span class="token operator">=</span> left
        branch<span class="token punctuation">.</span>right <span class="token operator">=</span> right
        heap<span class="token punctuation">.</span><span class="token function">Push</span><span class="token punctuation">(</span>h<span class="token punctuation">,</span> branch<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    root <span class="token operator">:=</span> heap<span class="token punctuation">.</span><span class="token function">Pop</span><span class="token punctuation">(</span>h<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token punctuation">(</span><span class="token operator">*</span>node<span class="token punctuation">)</span>
    <span class="token keyword">return</span> root
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">codebookRecurse</span><span class="token punctuation">(</span>node <span class="token operator">*</span>node<span class="token punctuation">,</span> cb <span class="token operator">*</span>codebook<span class="token punctuation">,</span> code <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">rune</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> node <span class="token operator">==</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">if</span> node<span class="token punctuation">.</span>left <span class="token operator">==</span> <span class="token boolean">nil</span> <span class="token operator">&amp;&amp;</span> node<span class="token punctuation">.</span>right <span class="token operator">==</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
        <span class="token punctuation">(</span><span class="token operator">*</span>cb<span class="token punctuation">)</span><span class="token punctuation">[</span>node<span class="token punctuation">.</span>char<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">string</span><span class="token punctuation">(</span>code<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    code <span class="token operator">=</span> <span class="token function">append</span><span class="token punctuation">(</span>code<span class="token punctuation">,</span> <span class="token char">&apos;0&apos;</span><span class="token punctuation">)</span>
    <span class="token function">codebookRecurse</span><span class="token punctuation">(</span>node<span class="token punctuation">.</span>left<span class="token punctuation">,</span> cb<span class="token punctuation">,</span> code<span class="token punctuation">)</span>
    code <span class="token operator">=</span> <span class="token function">append</span><span class="token punctuation">(</span>code<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token function">len</span><span class="token punctuation">(</span>code<span class="token punctuation">)</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token char">&apos;1&apos;</span><span class="token punctuation">)</span>
    <span class="token function">codebookRecurse</span><span class="token punctuation">(</span>node<span class="token punctuation">.</span>right<span class="token punctuation">,</span> cb<span class="token punctuation">,</span> code<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">encode</span><span class="token punctuation">(</span>message <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token builtin">string</span><span class="token punctuation">,</span> <span class="token operator">*</span>node<span class="token punctuation">,</span> codebook<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    ret <span class="token operator">:=</span> <span class="token string">&quot;&quot;</span>
    root <span class="token operator">:=</span> <span class="token function">buildTree</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span>
    cb <span class="token operator">:=</span> <span class="token function">generateCodebook</span><span class="token punctuation">(</span>root<span class="token punctuation">)</span>
    <span class="token keyword">for</span> <span class="token boolean">_</span><span class="token punctuation">,</span> char <span class="token operator">:=</span> <span class="token keyword">range</span> message <span class="token punctuation">{</span>
        ret <span class="token operator">+=</span> cb<span class="token punctuation">[</span>char<span class="token punctuation">]</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">return</span> ret<span class="token punctuation">,</span> root<span class="token punctuation">,</span> cb
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">decode</span><span class="token punctuation">(</span>message <span class="token builtin">string</span><span class="token punctuation">,</span> root <span class="token operator">*</span>node<span class="token punctuation">)</span> <span class="token builtin">string</span> <span class="token punctuation">{</span>
    cur <span class="token operator">:=</span> root
    ret <span class="token operator">:=</span> <span class="token string">&quot;&quot;</span>

    <span class="token keyword">for</span> <span class="token boolean">_</span><span class="token punctuation">,</span> char <span class="token operator">:=</span> <span class="token keyword">range</span> message <span class="token punctuation">{</span>
        <span class="token keyword">if</span> cur <span class="token operator">==</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> message
        <span class="token punctuation">}</span>

        <span class="token keyword">switch</span> <span class="token function">string</span><span class="token punctuation">(</span>char<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">case</span> <span class="token string">&quot;0&quot;</span><span class="token punctuation">:</span>
            <span class="token keyword">if</span> cur<span class="token punctuation">.</span>left <span class="token operator">==</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
                ret <span class="token operator">+=</span> <span class="token function">string</span><span class="token punctuation">(</span>cur<span class="token punctuation">.</span>char<span class="token punctuation">)</span>
                cur <span class="token operator">=</span> root<span class="token punctuation">.</span>left
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                cur <span class="token operator">=</span> cur<span class="token punctuation">.</span>left
            <span class="token punctuation">}</span>
        <span class="token keyword">case</span> <span class="token string">&quot;1&quot;</span><span class="token punctuation">:</span>
            <span class="token keyword">if</span> cur<span class="token punctuation">.</span>right <span class="token operator">==</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
                ret <span class="token operator">+=</span> <span class="token function">string</span><span class="token punctuation">(</span>cur<span class="token punctuation">.</span>char<span class="token punctuation">)</span>
                cur <span class="token operator">=</span> root<span class="token punctuation">.</span>right
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                cur <span class="token operator">=</span> cur<span class="token punctuation">.</span>right
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">if</span> cur<span class="token punctuation">.</span>char <span class="token operator">!=</span> <span class="token number">0</span> <span class="token punctuation">{</span>
        ret <span class="token operator">+=</span> <span class="token function">string</span><span class="token punctuation">(</span>cur<span class="token punctuation">.</span>char<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">return</span> ret
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">generateCodebook</span><span class="token punctuation">(</span>root <span class="token operator">*</span>node<span class="token punctuation">)</span> codebook <span class="token punctuation">{</span>
    cb <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span>codebook<span class="token punctuation">)</span>
    codeArr <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">rune</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
    <span class="token function">codebookRecurse</span><span class="token punctuation">(</span>root<span class="token punctuation">,</span> <span class="token operator">&amp;</span>cb<span class="token punctuation">,</span> codeArr<span class="token punctuation">)</span>
    <span class="token keyword">return</span> cb
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    enc<span class="token punctuation">,</span> root<span class="token punctuation">,</span> cb <span class="token operator">:=</span> <span class="token function">encode</span><span class="token punctuation">(</span><span class="token string">&quot;bibbity_bobbity&quot;</span><span class="token punctuation">)</span>
    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;Codebook:&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">for</span> r<span class="token punctuation">,</span> c <span class="token operator">:=</span> <span class="token keyword">range</span> cb <span class="token punctuation">{</span>
        fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token function">string</span><span class="token punctuation">(</span>r<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;-&gt;&quot;</span><span class="token punctuation">,</span> c<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;\nEncoded:&quot;</span><span class="token punctuation">,</span> enc<span class="token punctuation">)</span>
    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;Decoded:&quot;</span><span class="token punctuation">,</span> <span class="token function">decode</span><span class="token punctuation">(</span>enc<span class="token punctuation">,</span> root<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre>
</div><div class="code-method-sample" data-lang="asm-x64" data-name="X86-64 Assembly"><pre class="language-"><code class="lang-asm-x64">.intel_syntax noprefix

# System V calling convention cheatsheet
# Params: <span class="token register variable">rdi</span>, <span class="token register variable">rsi</span>, <span class="token register variable">rdx</span>, <span class="token register variable">rcx</span>, <span class="token register variable">r8</span>, <span class="token register variable">r9</span>, <span class="token register variable">xmm0</span><span class="token operator">-</span><span class="token number">7</span>
# Return: <span class="token register variable">rax</span> (int <span class="token number">64</span> bits), <span class="token register variable">rax</span>:<span class="token register variable">rdx</span> (int <span class="token number">128</span> bits), <span class="token register variable">xmm0</span> (float)
# Callee cleanup: <span class="token register variable">rbx</span>, <span class="token register variable">rbp</span>, <span class="token register variable">r12</span><span class="token operator">-</span><span class="token number">15</span>
# Scratch: <span class="token register variable">rax</span>, <span class="token register variable">rdi</span>, <span class="token register variable">rsi</span>, <span class="token register variable">rdx</span>, <span class="token register variable">rcx</span>, <span class="token register variable">r8</span>, <span class="token register variable">r9</span>, <span class="token register variable">r10</span>, <span class="token register variable">r11</span>

.section .rodata
  <span class="token label function">text:</span>       .string <span class="token string">&quot;bibbity bobbity&quot;</span>
  <span class="token label function">original:</span>   .string <span class="token string">&quot;Original message: %s\n&quot;</span>
  <span class="token label function">encoded:</span>    .string <span class="token string">&quot;Encoded message: &quot;</span>
  <span class="token label function">decoded:</span>    .string <span class="token string">&quot;Decoded message: %s\n&quot;</span>

  .equ bitstr_len,       <span class="token number">32</span>
  .equ bitstr_size,      <span class="token number">40</span>
  .equ codebook_size,    <span class="token number">256</span> <span class="token operator">*</span> bitstr_size

  .equ tree_left,        <span class="token number">0</span>
  .equ tree_right,       <span class="token number">8</span>
  .equ tree_count,       <span class="token number">16</span>
  .equ tree_value,       <span class="token number">20</span>
  .equ tree_size,        <span class="token number">24</span>

  .equ heap_len,         <span class="token number">0</span>
  .equ heap_data,        <span class="token number">4</span>
  .equ heap_size,        <span class="token number">512</span> <span class="token operator">*</span> <span class="token number">8</span> <span class="token operator">+</span> <span class="token number">16</span>         # <span class="token number">512</span> ptrs <span class="token operator">+</span> <span class="token number">4</span> byte length <span class="token operator">+</span> <span class="token number">12</span> byte padding
  .equ counts_size,      <span class="token number">256</span> <span class="token operator">*</span> <span class="token number">4</span>

  .equ msg_len,          <span class="token number">0</span>
  .equ msg_data,         <span class="token number">8</span>
.section .text
  .<span class="token keyword">global main</span>
  .<span class="token keyword">extern printf, calloc, malloc, memset, puts</span>

<span class="token label function">main:</span>
  push   <span class="token register variable">r12</span>
  push   <span class="token register variable">r13</span>
  sub    <span class="token register variable">rsp</span>, codebook_size <span class="token operator">+</span> <span class="token number">16</span>              # <span class="token number">8</span> extra bytes for the Huffman<span class="token operator">-</span>tree ptr, <span class="token number">8</span> bytes for padding

  # Print the original text
  mov    <span class="token register variable">rdi</span>, OFFSET original
  mov    <span class="token register variable">rsi</span>, OFFSET text
  xor    <span class="token register variable">rax</span>, <span class="token register variable">rax</span>
  call   printf

  # First encode the text. This will also initialize the Huffman<span class="token operator">-</span>tree and the codebook
  mov    <span class="token register variable">rdi</span>, OFFSET text
  mov    <span class="token register variable">rsi</span>, <span class="token register variable">rsp</span>
  lea    <span class="token register variable">rdx</span>, <span class="token operator">[</span><span class="token register variable">rsp</span> <span class="token operator">+</span> codebook_size<span class="token operator">]</span>
  call   encode
  mov    <span class="token register variable">r12</span>, <span class="token register variable">rax</span>                             # Save the returned message ptr

  # Print the codebook and the encoded message
  mov    <span class="token register variable">rdi</span>, <span class="token register variable">rsp</span>
  call   print_codebook
  mov    <span class="token register variable">rdi</span>, OFFSET encoded
  xor    <span class="token register variable">rax</span>, <span class="token register variable">rax</span>
  call   printf
  mov    <span class="token register variable">rdi</span>, <span class="token register variable">r12</span>
  call   print_message

  # Decode and print the message
  mov    <span class="token register variable">rdi</span>, <span class="token register variable">r12</span>
  mov    <span class="token register variable">rsi</span>, QWORD PTR <span class="token operator">[</span><span class="token register variable">rsp</span> <span class="token operator">+</span> codebook_size<span class="token operator">]</span>
  call   decode
  mov    <span class="token register variable">r13</span>, <span class="token register variable">rax</span>
  mov    <span class="token register variable">rdi</span>, OFFSET decoded
  mov    <span class="token register variable">rsi</span>, <span class="token register variable">r13</span>
  xor    <span class="token register variable">rax</span>, <span class="token register variable">rax</span>
  call   printf

  # Free allocated resources
  mov    <span class="token register variable">rdi</span>, <span class="token register variable">r12</span>
  call   free
  mov    <span class="token register variable">rdi</span>, <span class="token register variable">r13</span>
  call   free
  mov    <span class="token register variable">rdi</span>, QWORD PTR <span class="token operator">[</span><span class="token register variable">rsp</span> <span class="token operator">+</span> codebook_size<span class="token operator">]</span>
  call   free_tree

  add    <span class="token register variable">rsp</span>, codebook_size <span class="token operator">+</span> <span class="token number">16</span>
  pop    <span class="token register variable">r13</span>
  pop    <span class="token register variable">r12</span>

  # Indiciate success with a <span class="token number">0</span> exit code
  xor    <span class="token register variable">rax</span>, <span class="token register variable">rax</span>
  ret

# <span class="token register variable">rdi</span> <span class="token operator">-</span> text
# <span class="token register variable">rsi</span> <span class="token operator">-</span> codebook ptr
# <span class="token register variable">rdx</span> <span class="token operator">-</span> Huffman<span class="token operator">-</span>tree ptr
# RET <span class="token register variable">rax</span> <span class="token operator">-</span> encoded message ptr
<span class="token label function">encode:</span>
  push   <span class="token register variable">r12</span>
  push   <span class="token register variable">r13</span>
  push   <span class="token register variable">r14</span>
  mov    <span class="token register variable">r12</span>, <span class="token register variable">rdi</span>                             # Save the original arguments
  mov    <span class="token register variable">r13</span>, <span class="token register variable">rsi</span>
  mov    <span class="token register variable">r14</span>, <span class="token register variable">rdx</span>
  call   generate_tree                        # The text is already in <span class="token register variable">rdi</span>
  mov    QWORD PTR <span class="token operator">[</span><span class="token register variable">r14</span><span class="token operator">]</span>, <span class="token register variable">rax</span>                 # Save the Huffman<span class="token operator">-</span>tree&apos;s root
  mov    <span class="token register variable">rdi</span>, <span class="token register variable">r13</span>                             # Set up the parameters for codebook generation: codebook ptr, Huffman<span class="token operator">-</span>tree root
  mov    <span class="token register variable">rsi</span>, <span class="token register variable">rax</span>
  call   generate_codebook
  xor    <span class="token register variable">rax</span>, <span class="token register variable">rax</span>
  xor    <span class="token register variable">r14</span>, <span class="token register variable">r14</span>                             # We&apos;ll use <span class="token register variable">r14</span> to keep track of the length of the message
  mov    <span class="token register variable">rcx</span>, <span class="token register variable">r12</span>                             # Make a copy of the pointer to the message to be encoded
<span class="token label function">encode_calculate_length:</span>
  mov    <span class="token register variable">al</span>, BYTE PTR <span class="token operator">[</span><span class="token register variable">rcx</span><span class="token operator">]</span>
  test   <span class="token register variable">al</span>, <span class="token register variable">al</span>                               # If we<span class="token string">&apos;re at the terminating null character then we&apos;</span>re ready to encode
  jz     encode_message
  lea    <span class="token register variable">rdx</span>, <span class="token operator">[</span><span class="token register variable">rax</span> <span class="token operator">+</span> <span class="token number">4</span><span class="token operator">*</span><span class="token register variable">rax</span><span class="token operator">]</span>                   # We get the codebook entry at the specific index
  lea    <span class="token register variable">r8</span>, <span class="token operator">[</span><span class="token register variable">r13</span> <span class="token operator">+</span> <span class="token number">8</span><span class="token operator">*</span><span class="token register variable">rdx</span><span class="token operator">]</span>
  add    <span class="token register variable">r14</span>, QWORD PTR <span class="token operator">[</span><span class="token register variable">r8</span> <span class="token operator">+</span> bitstr_len<span class="token operator">]</span>     # And add the encoded word length to the total
  inc    <span class="token register variable">rcx</span>
  jmp    encode_calculate_length
<span class="token label function">encode_message:</span>
  mov    <span class="token register variable">rdi</span>, <span class="token number">1</span>
  lea    <span class="token register variable">rsi</span>, <span class="token operator">[</span><span class="token register variable">r14</span> <span class="token operator">+</span> <span class="token number">7</span><span class="token operator">]</span>                       # Calculate the number of bytes we need to allocate to fit all the bits
  shr    <span class="token register variable">rsi</span>, <span class="token number">3</span>                               # length <span class="token operator">%</span> <span class="token number">8</span> rounded up <span class="token operator">=</span> (length <span class="token operator">+</span> <span class="token number">8</span> <span class="token operator">-</span> <span class="token number">1</span>) <span class="token operator">/</span> <span class="token number">8</span>
  lea    <span class="token register variable">rsi</span>, <span class="token operator">[</span><span class="token register variable">rsi</span> <span class="token operator">+</span> <span class="token number">8</span><span class="token operator">]</span>                       # Make space for an <span class="token number">8</span><span class="token operator">-</span>byte length field
  call   calloc                               # Allocate the necessary memory, the message will be in <span class="token register variable">rax</span>
  mov    QWORD PTR <span class="token operator">[</span><span class="token register variable">rax</span><span class="token operator">]</span>, <span class="token register variable">r14</span>                 # Save the length of the message
  # Registers:
  #   <span class="token operator">-</span> <span class="token register variable">r12</span>: text
  #   <span class="token operator">-</span> <span class="token register variable">r13</span>: codebook_ptr
  #   <span class="token operator">-</span> <span class="token register variable">rax</span>: message ptr
  #   <span class="token operator">-</span> free to use: <span class="token register variable">rdi</span>, <span class="token register variable">rsi</span>, <span class="token register variable">rcx</span>, <span class="token register variable">rdx</span>, <span class="token register variable">r8</span>, <span class="token register variable">r9</span>, <span class="token register variable">r10</span>, <span class="token register variable">r11</span>, <span class="token register variable">r14</span>
  xor    <span class="token register variable">r8</span>, <span class="token register variable">r8</span>                               # Bit offset
  lea    <span class="token register variable">r9</span>, <span class="token operator">[</span><span class="token register variable">rax</span> <span class="token operator">+</span> <span class="token number">8</span><span class="token operator">]</span>                        # <span class="token number">8</span><span class="token operator">-</span>byte message block
<span class="token label function">encode_message_bits:</span>
  xor    <span class="token register variable">rdi</span>, <span class="token register variable">rdi</span>                             # We need to clear <span class="token register variable">rdi</span> because moving a single byte to dil doesn&apos;t do so
  mov    dil, BYTE PTR <span class="token operator">[</span><span class="token register variable">r12</span><span class="token operator">]</span>                  # Iterate the message again
  test   dil, dil                             # If we<span class="token string">&apos;re at the the null terminator we&apos;</span>re done
  jz     encode_done
  lea    <span class="token register variable">rdx</span>, <span class="token operator">[</span><span class="token register variable">rdi</span> <span class="token operator">+</span> <span class="token number">4</span><span class="token operator">*</span><span class="token register variable">rdi</span><span class="token operator">]</span>                   # Get the codebook entry
  lea    <span class="token register variable">r10</span>, <span class="token operator">[</span><span class="token register variable">r13</span> <span class="token operator">+</span> <span class="token number">8</span><span class="token operator">*</span><span class="token register variable">rdx</span><span class="token operator">]</span>
  mov    <span class="token register variable">r11</span>, QWORD PTR <span class="token operator">[</span><span class="token register variable">r10</span> <span class="token operator">+</span> bitstr_len<span class="token operator">]</span>    # Load the bitstring length
  lea    <span class="token register variable">r14</span>, <span class="token operator">[</span><span class="token register variable">r10</span><span class="token operator">]</span>                           # The bitstring qword we&apos;re currently processing
<span class="token label function">encode_message_bits_qword:</span>
  mov    <span class="token register variable">rdi</span>, QWORD PTR <span class="token operator">[</span><span class="token register variable">r14</span><span class="token operator">]</span>                 # Calculate the first mask: <span class="token operator">[</span>code qword<span class="token operator">]</span> <span class="token operator">&lt;</span><span class="token operator">&lt;</span> <span class="token operator">[</span>bit offset<span class="token operator">]</span>
  mov    <span class="token register variable">rsi</span>, <span class="token register variable">rdi</span>                             # Get a second copy of the code&apos;s current qword
  mov    <span class="token register variable">rcx</span>, <span class="token register variable">r8</span>
  shl    <span class="token register variable">rdi</span>, <span class="token register variable">cl</span>
  or     QWORD PTR <span class="token operator">[</span><span class="token register variable">r9</span><span class="token operator">]</span>, <span class="token register variable">rdi</span>                  # Apply the mask to the current block
  mov    <span class="token register variable">rcx</span>, <span class="token number">64</span>                              # Calculate the second mask: <span class="token operator">[</span>code qword<span class="token operator">]</span> <span class="token operator">&gt;</span><span class="token operator">&gt;</span> <span class="token operator">[</span><span class="token number">64</span> <span class="token operator">-</span> bit offset<span class="token operator">]</span>
  sub    <span class="token register variable">rcx</span>, <span class="token register variable">r8</span>
  shr    <span class="token register variable">rsi</span>, <span class="token register variable">cl</span>
  mov    <span class="token register variable">rcx</span>, <span class="token register variable">r11</span>                             # Copy the code length so we can manipulate it without destroying the original value
  sub    <span class="token register variable">rcx</span>, <span class="token number">64</span>
  jle    encode_message_bits_try_overflow     # If the length was less than or equal to <span class="token number">64</span>, check if the code qword would overflow the current message block
  mov    <span class="token register variable">r11</span>, <span class="token register variable">rcx</span>                             # We wanted to subtract <span class="token number">64</span> from the code length anyway
  lea    <span class="token register variable">r9</span>, <span class="token operator">[</span><span class="token register variable">r9</span> <span class="token operator">+</span> <span class="token number">8</span><span class="token operator">]</span>                         # Load the next message block
  or     QWORD PTR <span class="token operator">[</span><span class="token register variable">r9</span><span class="token operator">]</span>, <span class="token register variable">rsi</span>                  # Save the second mask to the new message block
  jmp    encode_message_bits_qword
<span class="token label function">encode_message_bits_try_overflow:</span>
  add    <span class="token register variable">rcx</span>, <span class="token register variable">r8</span>                              # Calculate <span class="token operator">[</span>code length<span class="token operator">]</span> <span class="token operator">+</span> <span class="token operator">[</span>bit offset<span class="token operator">]</span> <span class="token operator">-</span> <span class="token number">64</span>
  jl     encode_calculate_new_bit_offset      # If the result is less than <span class="token number">0</span> then we have no remaining bits <span class="token operator">-</span><span class="token operator">&gt;</span> calculate the new bit offset
  mov    <span class="token register variable">r8</span>, <span class="token register variable">rcx</span>                              # Otherwise this also happens to be our new bit offset
  lea    <span class="token register variable">r9</span>, <span class="token operator">[</span><span class="token register variable">r9</span> <span class="token operator">+</span> <span class="token number">8</span><span class="token operator">]</span>                         # Load the next message block
  or     QWORD PTR <span class="token operator">[</span><span class="token register variable">r9</span><span class="token operator">]</span>, <span class="token register variable">rsi</span>                  # Save the second mask to the new message block
  inc    <span class="token register variable">r12</span>                                  # Go to the next character in the input
  jmp    encode_message_bits
<span class="token label function">encode_calculate_new_bit_offset:</span>
  lea    <span class="token register variable">r8</span>, <span class="token operator">[</span><span class="token register variable">r8</span> <span class="token operator">+</span> <span class="token register variable">r11</span><span class="token operator">]</span>                       # Calculate the bit offset for the next code qword
  inc    <span class="token register variable">r12</span>
  jmp    encode_message_bits
<span class="token label function">encode_done:</span>
  pop    <span class="token register variable">r14</span>
  pop    <span class="token register variable">r13</span>
  pop    <span class="token register variable">r12</span>
  ret

# <span class="token register variable">rdi</span> <span class="token operator">-</span> encoded message
# <span class="token register variable">rsi</span> <span class="token operator">-</span> Huffman<span class="token operator">-</span>tree root (ptr)
# RET <span class="token register variable">rax</span> <span class="token operator">-</span> the decoded message
<span class="token label function">decode:</span>
  push   <span class="token register variable">r12</span>
  push   <span class="token register variable">r13</span>
  push   <span class="token register variable">r14</span>
  mov    <span class="token register variable">r12</span>, <span class="token register variable">rdi</span>
  mov    <span class="token register variable">r13</span>, <span class="token register variable">rsi</span>
  mov    <span class="token register variable">rdi</span>, QWORD PTR <span class="token operator">[</span><span class="token register variable">r12</span><span class="token operator">]</span>                 # Load the length of the message
  mov    <span class="token register variable">r14</span>, <span class="token register variable">rdi</span>                             # We&apos;ll use the length of the message as a loop counter later
  lea    <span class="token register variable">rdi</span>, <span class="token operator">[</span><span class="token register variable">rdi</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token operator">]</span>                       # The null terminator
  call   malloc                               # This will usually be more than enough memory to contain the whole decoded message (we don&apos;t handle pathological cases right now)
  mov    <span class="token register variable">rdi</span>, <span class="token register variable">r12</span>                             # The single<span class="token operator">-</span>character decoder doesn&apos;t touch <span class="token register variable">rdi</span> so we can hoist it before the loop
  xor    <span class="token register variable">rcx</span>, <span class="token register variable">rcx</span>
  mov    <span class="token register variable">rdx</span>, <span class="token register variable">rax</span>                             # The current byte in the output string
<span class="token label function">decode_loop:</span>
  cmp    <span class="token register variable">rcx</span>, <span class="token register variable">r14</span>                             # The encoded message bit counter
  jge    decode_done
  mov    <span class="token register variable">rsi</span>, <span class="token register variable">r13</span>                             # The current node in the Huffman<span class="token operator">-</span>tree
<span class="token label function">decode_loop_char:</span>
  test   <span class="token register variable">rsi</span>, <span class="token register variable">rsi</span>                             # If the Huffman<span class="token operator">-</span>tree node is null then we reached a dead<span class="token operator">-</span>end <span class="token operator">-</span><span class="token operator">&gt;</span> start over
  jz     decode_loop
  cmp    QWORD PTR <span class="token operator">[</span><span class="token register variable">rsi</span> <span class="token operator">+</span> tree_left<span class="token operator">]</span>, <span class="token number">0</span>       # If the node has either a left or a right child, treat it as a branch
  jnz    decode_loop_char_branch
  cmp    QWORD PTR <span class="token operator">[</span><span class="token register variable">rsi</span> <span class="token operator">+</span> tree_right<span class="token operator">]</span>, <span class="token number">0</span>
  jnz    decode_loop_char_branch
  mov    <span class="token register variable">r9d</span>, DWORD PTR <span class="token operator">[</span><span class="token register variable">rsi</span> <span class="token operator">+</span> tree_value<span class="token operator">]</span>    # Load the value in this node in case the next iteration needs it
  mov    BYTE PTR <span class="token operator">[</span><span class="token register variable">rdx</span><span class="token operator">]</span>, <span class="token register variable">r9b</span>                  # And save it to the output
  lea    <span class="token register variable">rdx</span>, <span class="token operator">[</span><span class="token register variable">rdx</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token operator">]</span>                       # Advance the output string
  jmp    decode_loop
<span class="token label function">decode_loop_char_branch:</span>
  mov    <span class="token register variable">r9</span>, <span class="token register variable">rcx</span>                              # First, load the byte of the message the current bit is in
  shr    <span class="token register variable">r9</span>, <span class="token number">3</span>
  mov    <span class="token register variable">r10b</span>, BYTE PTR <span class="token operator">[</span><span class="token register variable">rdi</span> <span class="token operator">+</span> <span class="token register variable">r9</span> <span class="token operator">+</span> msg_data<span class="token operator">]</span>
  mov    <span class="token register variable">r11</span>, <span class="token register variable">rcx</span>                             # Save <span class="token register variable">rcx</span> in another register temporarily so we can restore it without push<span class="token operator">/</span>pop
  and    <span class="token register variable">rcx</span>, <span class="token number">7</span>
  shr    <span class="token register variable">r10</span>, <span class="token register variable">cl</span>                              # Get the bit we&apos;re interested in to position <span class="token number">0</span>
  lea    <span class="token register variable">rcx</span>, <span class="token operator">[</span><span class="token register variable">r11</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token operator">]</span>                       # Restore <span class="token register variable">rcx</span> and immediately add <span class="token number">1</span> to get the next bit to decode
  and    <span class="token register variable">r10</span>, <span class="token number">0x1</span>                             # Zero out all other bits
  mov    <span class="token register variable">r8</span>, <span class="token register variable">rsi</span>
  mov    <span class="token register variable">rsi</span>, QWORD PTR <span class="token operator">[</span><span class="token register variable">r8</span> <span class="token operator">+</span> tree_left<span class="token operator">]</span>      # Take the left branch for <span class="token number">0</span>, the right branch for a non<span class="token operator">-</span>zero bit
  cmovnz <span class="token register variable">rsi</span>, QWORD PTR <span class="token operator">[</span><span class="token register variable">r8</span> <span class="token operator">+</span> tree_right<span class="token operator">]</span>
  jmp    decode_loop_char
<span class="token label function">decode_done:</span>
  mov    BYTE PTR <span class="token operator">[</span><span class="token register variable">rdx</span><span class="token operator">]</span>, <span class="token number">0</span>                    # Write the null terminator at the end of the string
  pop    <span class="token register variable">r14</span>
  pop    <span class="token register variable">r13</span>
  pop    <span class="token register variable">r12</span>
  ret

# <span class="token register variable">rdi</span> <span class="token operator">-</span> The starting address of the codebook we want to generate
# <span class="token register variable">rsi</span> <span class="token operator">-</span> Huffman<span class="token operator">-</span>tree root (ptr)
<span class="token label function">generate_codebook:</span>
  push   <span class="token register variable">r12</span>
  sub    <span class="token register variable">rsp</span>, bitstr_size <span class="token operator">+</span> <span class="token number">16</span>                # <span class="token number">16</span> extra bytes for alignment
  mov    <span class="token register variable">r12</span>, <span class="token register variable">rsi</span>
  xorps  <span class="token register variable">xmm0</span>, <span class="token register variable">xmm0</span>                           # Create a <span class="token number">0</span><span class="token operator">-</span>initialized bitstring. This will be
  movaps XMMWORD PTR <span class="token operator">[</span><span class="token register variable">rsp</span><span class="token operator">]</span>, <span class="token register variable">xmm0</span>              # used in the recursive function calls
  movaps XMMWORD PTR <span class="token operator">[</span><span class="token register variable">rsp</span> <span class="token operator">+</span> <span class="token number">16</span><span class="token operator">]</span>, <span class="token register variable">xmm0</span>
  mov    QWORD PTR <span class="token operator">[</span><span class="token register variable">rsp</span> <span class="token operator">+</span> <span class="token number">32</span><span class="token operator">]</span>, <span class="token number">0</span>
  xor    <span class="token register variable">rsi</span>, <span class="token register variable">rsi</span>
  mov    <span class="token register variable">rdx</span>, codebook_size
  call   memset
  mov    <span class="token register variable">rdi</span>, <span class="token register variable">rax</span>
  mov    <span class="token register variable">rsi</span>, <span class="token register variable">r12</span>
  mov    <span class="token register variable">rdx</span>, <span class="token register variable">rsp</span>
  call   generate_codebook_recurse
  add    <span class="token register variable">rsp</span>, bitstr_size <span class="token operator">+</span> <span class="token number">16</span>
  pop    <span class="token register variable">r12</span>
  ret

# <span class="token register variable">rdi</span> <span class="token operator">-</span> The codebook&apos;s starting address
# <span class="token register variable">rsi</span> <span class="token operator">-</span> The current Huffman<span class="token operator">-</span>tree node
# <span class="token register variable">rdx</span> <span class="token operator">-</span> The bitstring used for code generation
<span class="token label function">generate_codebook_recurse:</span>
  push   <span class="token register variable">rbp</span>
  push   <span class="token register variable">r12</span>
  push   <span class="token register variable">r13</span>
  test   <span class="token register variable">rsi</span>, <span class="token register variable">rsi</span>                             # If we reached a null pointer we&apos;re done
  jz     generate_codebook_recurse_done
  mov    <span class="token register variable">r12</span>, <span class="token register variable">rsi</span>
  cmp    QWORD PTR <span class="token operator">[</span><span class="token register variable">r12</span> <span class="token operator">+</span> tree_left<span class="token operator">]</span>, <span class="token number">0</span>       # If at least one of the children is not null
  jnz    generate_codebook_branch             # then we need to treat the current node as a branch
  cmp    QWORD PTR <span class="token operator">[</span><span class="token register variable">r12</span> <span class="token operator">+</span> tree_right<span class="token operator">]</span>, <span class="token number">0</span>
  jnz    generate_codebook_branch
  mov    <span class="token register variable">r8d</span>, DWORD PTR <span class="token operator">[</span><span class="token register variable">r12</span> <span class="token operator">+</span> tree_value<span class="token operator">]</span>    # Get the value of the current node
  movaps <span class="token register variable">xmm0</span>, XMMWORD PTR <span class="token operator">[</span><span class="token register variable">rdx</span><span class="token operator">]</span>              # Get the values of the current bitstring into some registers
  movaps <span class="token register variable">xmm1</span>, XMMWORD PTR <span class="token operator">[</span><span class="token register variable">rdx</span> <span class="token operator">+</span> <span class="token number">16</span><span class="token operator">]</span>
  mov    <span class="token register variable">r9</span>, QWORD PTR <span class="token operator">[</span><span class="token register variable">rdx</span> <span class="token operator">+</span> <span class="token number">32</span><span class="token operator">]</span>
  lea    <span class="token register variable">rax</span>, <span class="token operator">[</span><span class="token register variable">r8</span> <span class="token operator">+</span> <span class="token number">4</span><span class="token operator">*</span><span class="token register variable">r8</span><span class="token operator">]</span>                     # The index calculation needs to add <span class="token number">40</span> <span class="token operator">*</span> index. With lea arithmetic this can be represented as
  lea    <span class="token register variable">r10</span>, <span class="token operator">[</span><span class="token register variable">rdi</span> <span class="token operator">+</span> <span class="token number">8</span><span class="token operator">*</span><span class="token register variable">rax</span><span class="token operator">]</span>                   # base address <span class="token operator">+</span> <span class="token number">8</span> <span class="token operator">*</span> (<span class="token number">5</span> <span class="token operator">*</span> index). This is done in two lea instructions
  movups XMMWORD PTR <span class="token operator">[</span><span class="token register variable">r10</span><span class="token operator">]</span>, <span class="token register variable">xmm0</span>              # And copy the data over to it
  movups XMMWORD PTR <span class="token operator">[</span><span class="token register variable">r10</span> <span class="token operator">+</span> <span class="token number">16</span><span class="token operator">]</span>, <span class="token register variable">xmm1</span>
  mov    QWORD PTR <span class="token operator">[</span><span class="token register variable">r10</span> <span class="token operator">+</span> <span class="token number">32</span><span class="token operator">]</span>, <span class="token register variable">r9</span>
  jmp    generate_codebook_recurse_done
<span class="token label function">generate_codebook_branch:</span>
  # First, calculate the necessary indices and bitmask to use for the bitstring
  mov    <span class="token register variable">r13</span>, QWORD PTR <span class="token operator">[</span><span class="token register variable">rdx</span> <span class="token operator">+</span> bitstr_len<span class="token operator">]</span>    # Load the current length of the bitstring
  mov    <span class="token register variable">rcx</span>, <span class="token register variable">r13</span>                             # This will be used to index into the bitstring data. We&apos;ll need two copies for it
  shr    <span class="token register variable">r13</span>, <span class="token number">6</span>                               # We first get which <span class="token number">64</span> bit chunk of the bitstring we want to modify
  and    <span class="token register variable">rcx</span>, <span class="token number">63</span>                              # Then the bit we want to change
  mov    <span class="token register variable">rbp</span>, <span class="token number">1</span>                               # Generate the mask we&apos;ll use to set the correct bit
  shl    <span class="token register variable">rbp</span>, <span class="token register variable">cl</span>
  # We&apos;ll start with the right branch
  or     QWORD PTR <span class="token operator">[</span><span class="token register variable">rdx</span> <span class="token operator">+</span> <span class="token number">8</span><span class="token operator">*</span><span class="token register variable">r13</span><span class="token operator">]</span>, <span class="token register variable">rbp</span>         # Set the bit
  inc    QWORD PTR <span class="token operator">[</span><span class="token register variable">rdx</span> <span class="token operator">+</span> bitstr_len<span class="token operator">]</span>         # Increase the bitstring length
  mov    <span class="token register variable">rsi</span>, QWORD PTR <span class="token operator">[</span><span class="token register variable">r12</span> <span class="token operator">+</span> tree_right<span class="token operator">]</span>
  call   generate_codebook_recurse
  # Now we move on to the left branch: <span class="token register variable">rbx</span> <span class="token operator">-</span> left child, <span class="token register variable">r13</span> <span class="token operator">-</span> bitstring index, <span class="token register variable">rbp</span> <span class="token operator">-</span> mask
  not    <span class="token register variable">rbp</span>
  and    QWORD PTR <span class="token operator">[</span><span class="token register variable">rdx</span> <span class="token operator">+</span> <span class="token number">8</span><span class="token operator">*</span><span class="token register variable">r13</span><span class="token operator">]</span>, <span class="token register variable">rbp</span>
  mov    <span class="token register variable">rsi</span>, QWORD PTR <span class="token operator">[</span><span class="token register variable">r12</span> <span class="token operator">+</span> tree_left<span class="token operator">]</span>
  call   generate_codebook_recurse
  dec    QWORD PTR <span class="token operator">[</span><span class="token register variable">rdx</span> <span class="token operator">+</span> bitstr_len<span class="token operator">]</span>         # Decrease the bitstring length
<span class="token label function">generate_codebook_recurse_done:</span>
  pop    <span class="token register variable">r13</span>
  pop    <span class="token register variable">r12</span>
  pop    <span class="token register variable">rbp</span>
  ret

# <span class="token register variable">rdi</span> <span class="token operator">-</span> text
# RET <span class="token register variable">rax</span> <span class="token operator">-</span> Huffman<span class="token operator">-</span>tree root (ptr)
<span class="token label function">generate_tree:</span>
  push   <span class="token register variable">r12</span>
  push   <span class="token register variable">r13</span>
  sub    <span class="token register variable">rsp</span>, <span class="token number">5128</span>                            # <span class="token number">1024</span> bytes for the char counts, <span class="token number">4</span> bytes for heap length, <span class="token number">4096</span> bytes for the heap, <span class="token number">4</span> byte padding
  mov    <span class="token register variable">r12</span>, <span class="token register variable">rdi</span>                             # Save the original text so it doesn&apos;t get clobbered
  mov    <span class="token register variable">rdi</span>, <span class="token register variable">rsp</span>                             # Zero out the character counts and the heap length
  xor    <span class="token register variable">rsi</span>, <span class="token register variable">rsi</span>
  mov    <span class="token register variable">rdx</span>, <span class="token number">1040</span>
  call   memset
  xor    <span class="token register variable">rax</span>, <span class="token register variable">rax</span>
<span class="token label function">generate_tree_count_chars:</span>
  mov    <span class="token register variable">al</span>, BYTE PTR <span class="token operator">[</span><span class="token register variable">r12</span><span class="token operator">]</span>
  test   <span class="token register variable">al</span>, <span class="token register variable">al</span>
  jz     generate_tree_leaves_setup
  inc    DWORD PTR <span class="token operator">[</span><span class="token register variable">rsp</span> <span class="token operator">+</span> <span class="token number">4</span><span class="token operator">*</span><span class="token register variable">rax</span><span class="token operator">]</span>
  inc    <span class="token register variable">r12</span>
  jmp    generate_tree_count_chars
<span class="token label function">generate_tree_leaves_setup:</span>
  mov    <span class="token register variable">r12</span>, <span class="token number">255</span>                             # The loop counter. We can only get here if the <span class="token string">&quot;test&quot;</span> on line <span class="token number">301</span> resulted in a zero so the next jl instruction will do the right thing
<span class="token label function">generate_tree_leaves:</span>
  jl     generate_tree_one_leaf               # If not then it&apos;s time to generate the branches
  mov    <span class="token register variable">r13d</span>, DWORD PTR <span class="token operator">[</span><span class="token register variable">rsp</span> <span class="token operator">+</span> <span class="token number">4</span><span class="token operator">*</span><span class="token register variable">r12</span><span class="token operator">]</span>        # Load the count at the ith position
  test   <span class="token register variable">r13d</span>, <span class="token register variable">r13d</span>                           # And check if it&apos;s zero
  jz     generate_tree_leaves_counters        # If it is we can skip this iteration
  mov    <span class="token register variable">rdi</span>, <span class="token number">1</span>                               # If not, we need to allocate a new leaf node
  mov    <span class="token register variable">rsi</span>, tree_size
  call   calloc
  mov    DWORD PTR <span class="token operator">[</span><span class="token register variable">rax</span> <span class="token operator">+</span> tree_value<span class="token operator">]</span>, <span class="token register variable">r12d</span>   # Save the value and the count to the tree
  mov    DWORD PTR <span class="token operator">[</span><span class="token register variable">rax</span> <span class="token operator">+</span> tree_count<span class="token operator">]</span>, <span class="token register variable">r13d</span>
  lea    <span class="token register variable">rdi</span>, <span class="token operator">[</span><span class="token register variable">rsp</span> <span class="token operator">+</span> counts_size<span class="token operator">]</span>             # Then push it onto the heap
  mov    <span class="token register variable">rsi</span>, <span class="token register variable">rax</span>
  call   heap_push
<span class="token label function">generate_tree_leaves_counters:</span>
  dec    <span class="token register variable">r12</span>                                  # Decrement the loop counter and start over
  jmp    generate_tree_leaves
<span class="token label function">generate_tree_one_leaf:</span>
  cmp    DWORD PTR <span class="token operator">[</span><span class="token register variable">rsp</span> <span class="token operator">+</span> counts_size<span class="token operator">]</span>, <span class="token number">1</span>     # Check if there is only one element in the heap
  jne    generate_tree_branches
  lea    <span class="token register variable">rdi</span>, <span class="token operator">[</span><span class="token register variable">rsp</span> <span class="token operator">+</span> counts_size<span class="token operator">]</span>             # Get the element
  call   heap_pop
  mov    <span class="token register variable">r12</span>, <span class="token register variable">rax</span>
  mov    <span class="token register variable">rdi</span>, tree_size                       # Create the new tree node, the pointer to it will be in <span class="token register variable">rax</span>
  call   malloc
  mov    QWORD PTR <span class="token operator">[</span><span class="token register variable">rax</span> <span class="token operator">+</span> tree_left<span class="token operator">]</span>, <span class="token register variable">r12</span>     # Save element in the left node
  mov    <span class="token register variable">ecx</span>, DWORD PTR <span class="token operator">[</span><span class="token register variable">r12</span> <span class="token operator">+</span> tree_count<span class="token operator">]</span>    # Save element count in branch
  mov    DWORD PTR <span class="token operator">[</span><span class="token register variable">rax</span> <span class="token operator">+</span> tree_count<span class="token operator">]</span>, <span class="token register variable">ecx</span>
  jmp    generate_tree_ret                    # Returning
<span class="token label function">generate_tree_branches:</span>
  cmp    DWORD PTR <span class="token operator">[</span><span class="token register variable">rsp</span> <span class="token operator">+</span> counts_size<span class="token operator">]</span>, <span class="token number">1</span>     # Check if there are still at least two elements in the heap
  jle    generate_tree_done                   # If not, we&apos;re done
  lea    <span class="token register variable">rdi</span>, <span class="token operator">[</span><span class="token register variable">rsp</span> <span class="token operator">+</span> counts_size<span class="token operator">]</span>             # Get the left child
  call   heap_pop
  mov    <span class="token register variable">r12</span>, <span class="token register variable">rax</span>
  lea    <span class="token register variable">rdi</span>, <span class="token operator">[</span><span class="token register variable">rsp</span> <span class="token operator">+</span> counts_size<span class="token operator">]</span>             # Get the right child
  call   heap_pop
  mov    <span class="token register variable">r13</span>, <span class="token register variable">rax</span>
  mov    <span class="token register variable">rdi</span>, tree_size                       # Create the new tree node, the pointer to it will be in <span class="token register variable">rax</span>
  call   malloc
  mov    <span class="token register variable">ecx</span>, DWORD PTR <span class="token operator">[</span><span class="token register variable">r12</span> <span class="token operator">+</span> tree_count<span class="token operator">]</span>    # The new node&apos;s count: left count <span class="token operator">+</span> right count
  add    <span class="token register variable">ecx</span>, DWORD PTR <span class="token operator">[</span><span class="token register variable">r13</span> <span class="token operator">+</span> tree_count<span class="token operator">]</span>
  mov    QWORD PTR <span class="token operator">[</span><span class="token register variable">rax</span> <span class="token operator">+</span> tree_left<span class="token operator">]</span>, <span class="token register variable">r12</span>     # Save the new node<span class="token string">&apos;s fields: left, right, count (leave value unititialized, it shouldn&apos;</span>t be used with branch nodes)
  mov    QWORD PTR <span class="token operator">[</span><span class="token register variable">rax</span> <span class="token operator">+</span> tree_right<span class="token operator">]</span>, <span class="token register variable">r13</span>
  mov    DWORD PTR <span class="token operator">[</span><span class="token register variable">rax</span> <span class="token operator">+</span> tree_count<span class="token operator">]</span>, <span class="token register variable">ecx</span>
  lea    <span class="token register variable">rdi</span>, <span class="token operator">[</span><span class="token register variable">rsp</span> <span class="token operator">+</span> counts_size<span class="token operator">]</span>             # Add the branch to the heap
  mov    <span class="token register variable">rsi</span>, <span class="token register variable">rax</span>
  call   heap_push
  jmp    generate_tree_branches
<span class="token label function">generate_tree_done:</span>
  lea    <span class="token register variable">rdi</span>, <span class="token operator">[</span><span class="token register variable">rsp</span> <span class="token operator">+</span> counts_size<span class="token operator">]</span>             # The tree&apos;s root will be in <span class="token register variable">rax</span> after the pop
  call   heap_pop
<span class="token label function">generate_tree_ret:</span>
  add    <span class="token register variable">rsp</span>, <span class="token number">5128</span>
  pop    <span class="token register variable">r13</span>
  pop    <span class="token register variable">r12</span>
  ret

# <span class="token register variable">rdi</span> <span class="token operator">-</span> heap ptr
# <span class="token register variable">rsi</span> <span class="token operator">-</span> tree ptr
<span class="token label function">heap_push:</span>
  lea    <span class="token register variable">rax</span>, QWORD PTR <span class="token operator">[</span><span class="token register variable">rdi</span> <span class="token operator">+</span> heap_data<span class="token operator">]</span>     # We load the heap&apos;s data ptr and length to the respective registers
  mov    <span class="token register variable">ecx</span>, DWORD PTR <span class="token operator">[</span><span class="token register variable">rdi</span> <span class="token operator">+</span> heap_len<span class="token operator">]</span>      # Load the current length
  lea    <span class="token register variable">edx</span>, <span class="token operator">[</span><span class="token register variable">ecx</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token operator">]</span>                       # First, calculate the new length (length <span class="token operator">+</span> <span class="token number">1</span>)
  mov    DWORD PTR <span class="token operator">[</span><span class="token register variable">rdi</span> <span class="token operator">+</span> heap_len<span class="token operator">]</span>, <span class="token register variable">edx</span>      # Then save it
  mov    QWORD PTR <span class="token operator">[</span><span class="token register variable">rax</span> <span class="token operator">+</span> <span class="token number">8</span><span class="token operator">*</span><span class="token register variable">rcx</span><span class="token operator">]</span>, <span class="token register variable">rsi</span>         # And finally add the new value at the end of the array
<span class="token label function">heap_push_sift_up:</span>
  test   <span class="token register variable">rcx</span>, <span class="token register variable">rcx</span>                             # Test if we got to the root (index <span class="token operator">=</span><span class="token operator">=</span> <span class="token number">0</span>)
  jz     heap_push_done
  lea    <span class="token register variable">rdx</span>, <span class="token operator">[</span><span class="token register variable">rcx</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token operator">]</span>                       # Calculate the parent index: (index <span class="token operator">-</span> <span class="token number">1</span>) <span class="token operator">/</span> <span class="token number">2</span>
  shr    <span class="token register variable">rdx</span>, <span class="token number">1</span>
  lea    <span class="token register variable">r8</span>, <span class="token operator">[</span><span class="token register variable">rax</span> <span class="token operator">+</span> <span class="token number">8</span><span class="token operator">*</span><span class="token register variable">rcx</span><span class="token operator">]</span>                    # Get the pointer to the current and parent elements
  lea    <span class="token register variable">r9</span>, <span class="token operator">[</span><span class="token register variable">rax</span> <span class="token operator">+</span> <span class="token number">8</span><span class="token operator">*</span><span class="token register variable">rdx</span><span class="token operator">]</span>
  mov    <span class="token register variable">r10</span>, QWORD PTR <span class="token operator">[</span><span class="token register variable">r8</span><span class="token operator">]</span>                  # Load the current and the parent elements
  mov    <span class="token register variable">r11</span>, QWORD PTR <span class="token operator">[</span><span class="token register variable">r9</span><span class="token operator">]</span>
  mov    <span class="token register variable">esi</span>, DWORD PTR <span class="token operator">[</span><span class="token register variable">r10</span> <span class="token operator">+</span> tree_count<span class="token operator">]</span>    # Load the current tree&apos;s count
  cmp    DWORD PTR <span class="token operator">[</span><span class="token register variable">r11</span> <span class="token operator">+</span> tree_count<span class="token operator">]</span>, <span class="token register variable">esi</span>    # If parent count <span class="token operator">&lt;</span><span class="token operator">=</span> current count
  jle    heap_push_done                       # Then we&apos;re done
  mov    QWORD PTR <span class="token operator">[</span><span class="token register variable">r8</span><span class="token operator">]</span>, <span class="token register variable">r11</span>                  # Otherwise swap the two elements
  mov    QWORD PTR <span class="token operator">[</span><span class="token register variable">r9</span><span class="token operator">]</span>, <span class="token register variable">r10</span>
  mov    <span class="token register variable">rcx</span>, <span class="token register variable">rdx</span>
  jmp    heap_push_sift_up
<span class="token label function">heap_push_done:</span>
  ret

# <span class="token register variable">rdi</span> <span class="token operator">-</span> heap ptr
# RET <span class="token register variable">rax</span> <span class="token operator">-</span> tree ptr
<span class="token label function">heap_pop:</span>
  mov    <span class="token register variable">r8d</span>, DWORD PTR <span class="token operator">[</span><span class="token register variable">rdi</span> <span class="token operator">+</span> heap_len<span class="token operator">]</span>      # Load the heap&apos;s length
  test   <span class="token register variable">r8d</span>, <span class="token register variable">r8d</span>                             # If it<span class="token string">&apos;s 0 then the heap&apos;</span>s empty
  jz     heap_empty
  lea    <span class="token register variable">rdx</span>, <span class="token operator">[</span><span class="token register variable">rdi</span> <span class="token operator">+</span> heap_data<span class="token operator">]</span>               # Get the heap&apos;s data ptr
  mov    <span class="token register variable">rax</span>, QWORD PTR <span class="token operator">[</span><span class="token register variable">rdx</span><span class="token operator">]</span>                 # The return value will be the tree&apos;s current root
  lea    <span class="token register variable">r8d</span>, <span class="token operator">[</span><span class="token register variable">r8d</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token operator">]</span>                       # Calculate the new length
  mov    DWORD PTR <span class="token operator">[</span><span class="token register variable">rdi</span> <span class="token operator">+</span> heap_len<span class="token operator">]</span>, <span class="token register variable">r8d</span>      # And save it
  mov    <span class="token register variable">rsi</span>, QWORD PTR <span class="token operator">[</span><span class="token register variable">rdx</span> <span class="token operator">+</span> <span class="token number">8</span><span class="token operator">*</span><span class="token register variable">r8</span><span class="token operator">]</span>          # Load the element we&apos;re going to swap with the root
  mov    QWORD PTR <span class="token operator">[</span><span class="token register variable">rdx</span><span class="token operator">]</span>, <span class="token register variable">rsi</span>                 # Swap the root and the last element
  mov    QWORD PTR <span class="token operator">[</span><span class="token register variable">rdx</span> <span class="token operator">+</span> <span class="token number">8</span><span class="token operator">*</span><span class="token register variable">r8</span><span class="token operator">]</span>, <span class="token register variable">rax</span>
  xor    <span class="token register variable">r9</span>, <span class="token register variable">r9</span>                               # The loop index
<span class="token label function">heap_pop_sift_down:</span>
  mov    <span class="token register variable">rcx</span>, <span class="token register variable">r9</span>                              # Save the target index at the start of the loop
  lea    <span class="token register variable">r10</span>, <span class="token operator">[</span><span class="token register variable">r9</span> <span class="token operator">+</span> <span class="token register variable">r9</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token operator">]</span>                   # The left child index
  lea    <span class="token register variable">r11</span>, <span class="token operator">[</span><span class="token register variable">r9</span> <span class="token operator">+</span> <span class="token register variable">r9</span> <span class="token operator">+</span> <span class="token number">2</span><span class="token operator">]</span>                   # The right child index
  cmp    <span class="token register variable">r10</span>, <span class="token register variable">r8</span>
  jge    heap_pop_check_right
  mov    <span class="token register variable">rdi</span>, QWORD PTR <span class="token operator">[</span><span class="token register variable">rdx</span> <span class="token operator">+</span> <span class="token number">8</span><span class="token operator">*</span><span class="token register variable">r10</span><span class="token operator">]</span>         # Load the left child
  mov    <span class="token register variable">rsi</span>, QWORD PTR <span class="token operator">[</span><span class="token register variable">rdx</span> <span class="token operator">+</span> <span class="token number">8</span><span class="token operator">*</span><span class="token register variable">rcx</span><span class="token operator">]</span>         # Load the target
  mov    <span class="token register variable">esi</span>, DWORD PTR <span class="token operator">[</span><span class="token register variable">rsi</span> <span class="token operator">+</span> tree_count<span class="token operator">]</span>    # Load the target tree count
  cmp    DWORD PTR <span class="token operator">[</span><span class="token register variable">rdi</span> <span class="token operator">+</span> tree_count<span class="token operator">]</span>, <span class="token register variable">esi</span>    # If the left tree count <span class="token operator">&lt;</span> target tree count
  jge    heap_pop_check_right
  mov    <span class="token register variable">rcx</span>, <span class="token register variable">r10</span>
<span class="token label function">heap_pop_check_right:</span>
  cmp    <span class="token register variable">r11</span>, <span class="token register variable">r8</span>
  jge    heap_pop_compare_indices
  mov    <span class="token register variable">rdi</span>, QWORD PTR <span class="token operator">[</span><span class="token register variable">rdx</span> <span class="token operator">+</span> <span class="token number">8</span><span class="token operator">*</span><span class="token register variable">r11</span><span class="token operator">]</span>         # Load the right child
  mov    <span class="token register variable">rsi</span>, QWORD PTR <span class="token operator">[</span><span class="token register variable">rdx</span> <span class="token operator">+</span> <span class="token number">8</span><span class="token operator">*</span><span class="token register variable">rcx</span><span class="token operator">]</span>         # Load the target
  mov    <span class="token register variable">esi</span>, DWORD PTR <span class="token operator">[</span><span class="token register variable">rsi</span> <span class="token operator">+</span> tree_count<span class="token operator">]</span>    # Load the target tree count
  cmp    DWORD PTR <span class="token operator">[</span><span class="token register variable">rdi</span> <span class="token operator">+</span> tree_count<span class="token operator">]</span>, <span class="token register variable">esi</span>    # If the right tree count <span class="token operator">&lt;</span> target tree count
  jge    heap_pop_compare_indices
  mov    <span class="token register variable">rcx</span>, <span class="token register variable">r11</span>
<span class="token label function">heap_pop_compare_indices:</span>
  cmp    <span class="token register variable">r9</span>, <span class="token register variable">rcx</span>                              # If the target index <span class="token operator">=</span><span class="token operator">=</span> current index we&apos;re done
  je     heap_pop_done
  mov    <span class="token register variable">rdi</span>, QWORD PTR <span class="token operator">[</span><span class="token register variable">rdx</span> <span class="token operator">+</span> <span class="token number">8</span><span class="token operator">*</span><span class="token register variable">r9</span><span class="token operator">]</span>          # Otherwise we swap the values
  mov    <span class="token register variable">rsi</span>, QWORD PTR <span class="token operator">[</span><span class="token register variable">rdx</span> <span class="token operator">+</span> <span class="token number">8</span><span class="token operator">*</span><span class="token register variable">rcx</span><span class="token operator">]</span>
  mov    QWORD PTR <span class="token operator">[</span><span class="token register variable">rdx</span> <span class="token operator">+</span> <span class="token number">8</span><span class="token operator">*</span><span class="token register variable">r9</span><span class="token operator">]</span>, <span class="token register variable">rsi</span>
  mov    QWORD PTR <span class="token operator">[</span><span class="token register variable">rdx</span> <span class="token operator">+</span> <span class="token number">8</span><span class="token operator">*</span><span class="token register variable">rcx</span><span class="token operator">]</span>, <span class="token register variable">rdi</span>
  mov    <span class="token register variable">r9</span>, <span class="token register variable">rcx</span>
  jmp    heap_pop_sift_down
<span class="token label function">heap_empty:</span>
  xor    <span class="token register variable">rax</span>, <span class="token register variable">rax</span>                             # Return a null pointer to indicate the heap was empty
<span class="token label function">heap_pop_done:</span>
  ret

# <span class="token register variable">rdi</span> <span class="token operator">-</span> codebook start ptr
<span class="token label function">print_codebook:</span>
  push   <span class="token register variable">rbx</span>
  push   <span class="token register variable">r12</span>
  sub    <span class="token register variable">rsp</span>, <span class="token number">272</span>                             # The bitstring we&apos;re going to print
  mov    <span class="token register variable">r12</span>, <span class="token register variable">rdi</span>
  xor    <span class="token register variable">rbx</span>, <span class="token register variable">rbx</span>                             # Save the loop counter into a register that doesn&apos;t get clobbered
<span class="token label function">print_codebook_loop:</span>
  cmp    <span class="token register variable">rbx</span>, <span class="token number">255</span>
  jg     print_codebook_done
  lea    <span class="token register variable">rax</span>, <span class="token operator">[</span><span class="token register variable">rbx</span> <span class="token operator">+</span> <span class="token number">4</span><span class="token operator">*</span><span class="token register variable">rbx</span><span class="token operator">]</span>                   # We get the codebook entry at the specific index
  lea    <span class="token register variable">r10</span>, <span class="token operator">[</span><span class="token register variable">r12</span> <span class="token operator">+</span> <span class="token number">8</span><span class="token operator">*</span><span class="token register variable">rax</span><span class="token operator">]</span>
  mov    <span class="token register variable">rdx</span>, QWORD PTR <span class="token operator">[</span><span class="token register variable">r10</span> <span class="token operator">+</span> bitstr_len<span class="token operator">]</span>    # Load the length of the bitstring
  test   <span class="token register variable">rdx</span>, <span class="token register variable">rdx</span>                             # If it<span class="token string">&apos;s zero then the codepoint didn&apos;</span>t exist in the original alphabet, skip
  jz     print_codebook_counters
<span class="token label function">print_codebook_char:</span>
  mov    BYTE PTR <span class="token operator">[</span><span class="token register variable">rsp</span><span class="token operator">]</span>, <span class="token register variable">bl</span>                   # First, the character we&apos;re printing the code for
  mov    WORD PTR <span class="token operator">[</span><span class="token register variable">rsp</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token operator">]</span>, <span class="token number">0x203a</span>           # Then <span class="token string">&quot;: &quot;</span>
  mov    BYTE PTR <span class="token operator">[</span><span class="token register variable">rsp</span> <span class="token operator">+</span> <span class="token register variable">rdx</span> <span class="token operator">+</span> <span class="token number">3</span><span class="token operator">]</span>, <span class="token number">0x00</span>       # At the end add the null terminator
<span class="token label function">print_codebook_generate_binary:</span>
  dec    <span class="token register variable">rdx</span>
  jl     print_codebook_binary
  mov    <span class="token register variable">r9</span>, <span class="token register variable">rdx</span>                              # Two copies of the loop counter
  mov    <span class="token register variable">rcx</span>, <span class="token register variable">rdx</span>
  shr    <span class="token register variable">r9</span>, <span class="token number">6</span>                                # Calculate the bitstring part we&apos;re going to load
  and    <span class="token register variable">rcx</span>, <span class="token number">63</span>                              # The bit we&apos;re interested in
  mov    <span class="token register variable">rsi</span>, QWORD PTR <span class="token operator">[</span><span class="token register variable">r10</span> <span class="token operator">+</span> <span class="token register variable">r9</span><span class="token operator">]</span>            # One of the <span class="token number">4</span>, <span class="token number">64</span> bit parts of the bitstring we&apos;re going to print
  shr    <span class="token register variable">rsi</span>, <span class="token register variable">cl</span>                              # Get the relevant bit into the 0th position
  and    <span class="token register variable">rsi</span>, <span class="token number">1</span>                               # Mask the rest of the bits
  add    <span class="token register variable">rsi</span>, <span class="token string">&apos;0&apos;</span>                             # Convert it to ASCII
  mov    BYTE PTR <span class="token operator">[</span><span class="token register variable">rsp</span> <span class="token operator">+</span> <span class="token register variable">rdx</span> <span class="token operator">+</span> <span class="token number">3</span><span class="token operator">]</span>, sil        # And copy it into the string
  jmp    print_codebook_generate_binary
<span class="token label function">print_codebook_binary:</span>
  mov    <span class="token register variable">rdi</span>, <span class="token register variable">rsp</span>                             # Print the current bitstring
  call   puts
<span class="token label function">print_codebook_counters:</span>
  inc    <span class="token register variable">rbx</span>                                  # And go to the next codebook entry
  jmp    print_codebook_loop
<span class="token label function">print_codebook_done:</span>
  add    <span class="token register variable">rsp</span>, <span class="token number">272</span>
  pop    <span class="token register variable">r12</span>
  pop    <span class="token register variable">rbx</span>
  ret

# <span class="token register variable">rdi</span> <span class="token operator">-</span> message ptr
# This would run out of stack space for long messages but it will do for now
<span class="token label function">print_message:</span>
  push   <span class="token register variable">r12</span>
  push   <span class="token register variable">r13</span>
  mov    <span class="token register variable">r12</span>, <span class="token register variable">rdi</span>
  mov    <span class="token register variable">r13</span>, QWORD PTR <span class="token operator">[</span><span class="token register variable">rdi</span><span class="token operator">]</span>                 # Get the length of the message
  lea    <span class="token register variable">rdi</span>, <span class="token operator">[</span><span class="token register variable">r13</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token operator">]</span>                       # For the length of the string we&apos;ll need an additional the null terminator
  call   malloc
  xor    <span class="token register variable">rdx</span>, <span class="token register variable">rdx</span>
<span class="token label function">print_message_generate_string:</span>
  cmp    <span class="token register variable">rdx</span>, <span class="token register variable">r13</span>
  jge    print_message_puts
  mov    <span class="token register variable">r8</span>, <span class="token register variable">rdx</span>                              # Get two copies of the current index
  mov    <span class="token register variable">rcx</span>, <span class="token register variable">rdx</span>
  shr    <span class="token register variable">r8</span>, <span class="token number">3</span>                                # We first get the byte we want to print
  mov    <span class="token register variable">r10b</span>, BYTE PTR <span class="token operator">[</span><span class="token register variable">r12</span> <span class="token operator">+</span> <span class="token register variable">r8</span> <span class="token operator">+</span> msg_data<span class="token operator">]</span>
  and    <span class="token register variable">rcx</span>, <span class="token number">7</span>                               # Then the bit in that byte
  shr    <span class="token register variable">r10</span>, <span class="token register variable">cl</span>
  and    <span class="token register variable">r10</span>, <span class="token number">0x1</span>                             # Mask it so only the bit we&apos;re interested in is visible
  add    <span class="token register variable">r10</span>, <span class="token string">&apos;0&apos;</span>                             # Convert it to ASCII
  mov    BYTE PTR <span class="token operator">[</span><span class="token register variable">rax</span> <span class="token operator">+</span> <span class="token register variable">rdx</span><span class="token operator">]</span>, <span class="token register variable">r10b</span>           # Write it into the printable string
  inc    <span class="token register variable">rdx</span>
  jmp    print_message_generate_string
<span class="token label function">print_message_puts:</span>
  mov    BYTE PTR <span class="token operator">[</span><span class="token register variable">rax</span> <span class="token operator">+</span> <span class="token register variable">rdx</span><span class="token operator">]</span>, <span class="token number">0x00</span>           # Write the null terminator
  mov    <span class="token register variable">rdi</span>, <span class="token register variable">rax</span>                             # And print the string
  call   puts
  pop    <span class="token register variable">r13</span>
  pop    <span class="token register variable">r12</span>
  ret

# <span class="token register variable">rdi</span> <span class="token operator">-</span> tree ptr
<span class="token label function">free_tree:</span>
  push   <span class="token register variable">rbx</span>
  mov    <span class="token register variable">rbx</span>, <span class="token register variable">rdi</span>
  test   <span class="token register variable">rbx</span>, <span class="token register variable">rbx</span>                             # When the tree ptr we&apos;re trying to free is already null we reached the termination condition
  jz     free_tree_done
  mov    <span class="token register variable">rdi</span>, <span class="token operator">[</span><span class="token register variable">rbx</span> <span class="token operator">+</span> tree_left<span class="token operator">]</span>               # Otherwise free the left child first
  call   free_tree
  mov    <span class="token register variable">rdi</span>, <span class="token operator">[</span><span class="token register variable">rbx</span> <span class="token operator">+</span> tree_right<span class="token operator">]</span>              # Then the right child
  call   free_tree
  mov    <span class="token register variable">rdi</span>, <span class="token register variable">rbx</span>                             # And finally, the node itself
  call   free
<span class="token label function">free_tree_done:</span>
  pop    <span class="token register variable">rbx</span>
  ret
</code></pre>
</div><div class="code-method-sample" data-lang="scala" data-name="Scala"><pre class="language-"><code class="lang-scala"><span class="token keyword">import</span> <span class="token namespace">scala<span class="token punctuation">.</span>collection<span class="token punctuation">.</span>mutable<span class="token punctuation">.</span></span><span class="token punctuation">{</span>Map<span class="token punctuation">,</span> PriorityQueue<span class="token punctuation">}</span>

<span class="token keyword">object</span> HuffmanEncoding <span class="token punctuation">{</span>

  <span class="token keyword">trait</span> Node <span class="token punctuation">{</span>
    <span class="token keyword">var</span> weight<span class="token operator">:</span> <span class="token builtin">Int</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">case</span> <span class="token keyword">class</span> Leaf<span class="token punctuation">(</span>char<span class="token operator">:</span> <span class="token builtin">Char</span><span class="token punctuation">,</span> <span class="token keyword">var</span> weight<span class="token operator">:</span> <span class="token builtin">Int</span><span class="token punctuation">)</span> <span class="token keyword">extends</span> Node

  <span class="token keyword">case</span> <span class="token keyword">class</span> Branch<span class="token punctuation">(</span>left<span class="token operator">:</span> Node<span class="token punctuation">,</span> right<span class="token operator">:</span> Node<span class="token punctuation">,</span> <span class="token keyword">var</span> weight<span class="token operator">:</span> <span class="token builtin">Int</span><span class="token punctuation">)</span> <span class="token keyword">extends</span> Node

  <span class="token keyword">def</span> createTree<span class="token punctuation">(</span>phrase<span class="token operator">:</span> <span class="token builtin">String</span><span class="token punctuation">)</span><span class="token operator">:</span> Option<span class="token punctuation">[</span>Node<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span>

    <span class="token keyword">val</span> tree <span class="token operator">=</span> PriorityQueue<span class="token punctuation">[</span>Node<span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">(</span>Ordering<span class="token punctuation">.</span>by<span class="token punctuation">(</span><span class="token operator">-</span>_<span class="token punctuation">.</span>weight<span class="token punctuation">)</span><span class="token punctuation">)</span>
    tree <span class="token operator">++</span><span class="token operator">=</span> phrase
      <span class="token punctuation">.</span>groupBy<span class="token punctuation">(</span>identity<span class="token punctuation">)</span>
      <span class="token punctuation">.</span>mapValues<span class="token punctuation">(</span>_<span class="token punctuation">.</span>length<span class="token punctuation">)</span>
      <span class="token punctuation">.</span>map<span class="token punctuation">{</span>
        <span class="token keyword">case</span> <span class="token punctuation">(</span>char<span class="token punctuation">,</span> count<span class="token punctuation">)</span> <span class="token keyword">=&gt;</span> Leaf<span class="token punctuation">(</span>char<span class="token punctuation">,</span> count<span class="token punctuation">)</span>
      <span class="token punctuation">}</span>

    <span class="token keyword">while</span> <span class="token punctuation">(</span>tree<span class="token punctuation">.</span>size <span class="token operator">&gt;</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">val</span> node1 <span class="token operator">=</span> tree<span class="token punctuation">.</span>dequeue<span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token keyword">val</span> node2 <span class="token operator">=</span> tree<span class="token punctuation">.</span>dequeue<span class="token punctuation">(</span><span class="token punctuation">)</span>
      tree <span class="token operator">+=</span> Branch<span class="token punctuation">(</span>node1<span class="token punctuation">,</span> node2<span class="token punctuation">,</span> node1<span class="token punctuation">.</span>weight <span class="token operator">+</span> node2<span class="token punctuation">.</span>weight<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    tree<span class="token punctuation">.</span>headOption
  <span class="token punctuation">}</span>


  <span class="token keyword">def</span> createCodeBook<span class="token punctuation">(</span>maybeRoot<span class="token operator">:</span> Option<span class="token punctuation">[</span>Node<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">:</span> Map<span class="token punctuation">[</span><span class="token builtin">Char</span><span class="token punctuation">,</span> <span class="token builtin">String</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token keyword">val</span> codeBook <span class="token operator">=</span> Map<span class="token punctuation">[</span><span class="token builtin">Char</span><span class="token punctuation">,</span> <span class="token builtin">String</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> codeBookRecurse<span class="token punctuation">(</span>node<span class="token operator">:</span> Node<span class="token punctuation">,</span> code<span class="token operator">:</span> <span class="token builtin">String</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Unit</span> <span class="token operator">=</span>
      node <span class="token keyword">match</span> <span class="token punctuation">{</span>
        <span class="token keyword">case</span> Leaf<span class="token punctuation">(</span>symbol<span class="token punctuation">,</span> _<span class="token punctuation">)</span> <span class="token keyword">=&gt;</span> codeBook<span class="token punctuation">.</span>put<span class="token punctuation">(</span>symbol<span class="token punctuation">,</span> code<span class="token punctuation">)</span>
        <span class="token keyword">case</span> Branch<span class="token punctuation">(</span>left<span class="token punctuation">,</span> right<span class="token punctuation">,</span> _<span class="token punctuation">)</span> <span class="token keyword">=&gt;</span> <span class="token punctuation">{</span>
          codeBookRecurse<span class="token punctuation">(</span>left<span class="token punctuation">,</span> code <span class="token operator">+</span> <span class="token string">&quot;0&quot;</span><span class="token punctuation">)</span>
          codeBookRecurse<span class="token punctuation">(</span>right<span class="token punctuation">,</span> code <span class="token operator">+</span> <span class="token string">&quot;1&quot;</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>

    maybeRoot<span class="token punctuation">.</span>foreach<span class="token punctuation">(</span>c <span class="token keyword">=&gt;</span> codeBookRecurse<span class="token punctuation">(</span>c<span class="token punctuation">,</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

    codeBook
  <span class="token punctuation">}</span>


  <span class="token keyword">def</span> encode<span class="token punctuation">(</span>phrase<span class="token operator">:</span> <span class="token builtin">String</span><span class="token punctuation">,</span> codeBook<span class="token operator">:</span> Map<span class="token punctuation">[</span><span class="token builtin">Char</span><span class="token punctuation">,</span> <span class="token builtin">String</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">String</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
    phrase<span class="token punctuation">.</span>flatMap<span class="token punctuation">(</span>c <span class="token keyword">=&gt;</span> codeBook<span class="token punctuation">.</span>getOrElse<span class="token punctuation">(</span>c<span class="token punctuation">,</span> <span class="token string">&quot;?&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">def</span> decode<span class="token punctuation">(</span>encoded<span class="token operator">:</span> <span class="token builtin">String</span><span class="token punctuation">,</span> maybeRoot<span class="token operator">:</span> Option<span class="token punctuation">[</span>Node<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">String</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token keyword">val</span> root <span class="token operator">=</span> maybeRoot<span class="token punctuation">.</span>getOrElse<span class="token punctuation">(</span>Leaf<span class="token punctuation">(</span><span class="token char">&apos;?&apos;</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">var</span> currentNode <span class="token operator">=</span> root

    <span class="token keyword">def</span> chooseTreeBranch<span class="token punctuation">(</span>bit<span class="token operator">:</span> <span class="token builtin">Char</span><span class="token punctuation">)</span> <span class="token operator">=</span>
      currentNode <span class="token keyword">match</span> <span class="token punctuation">{</span>
        <span class="token keyword">case</span> Branch<span class="token punctuation">(</span>left<span class="token punctuation">,</span> right<span class="token punctuation">,</span> _<span class="token punctuation">)</span> <span class="token keyword">=&gt;</span>
          currentNode <span class="token operator">=</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>bit <span class="token operator">==</span> <span class="token char">&apos;0&apos;</span><span class="token punctuation">)</span> left <span class="token keyword">else</span> right
        <span class="token keyword">case</span> _ <span class="token keyword">=&gt;</span>
      <span class="token punctuation">}</span>

    <span class="token keyword">def</span> maybeGetACharacter <span class="token operator">=</span>
      currentNode <span class="token keyword">match</span> <span class="token punctuation">{</span>
        <span class="token keyword">case</span> Leaf<span class="token punctuation">(</span>c<span class="token punctuation">,</span> _<span class="token punctuation">)</span> <span class="token keyword">=&gt;</span> <span class="token punctuation">{</span>
          currentNode <span class="token operator">=</span> root
          Some<span class="token punctuation">(</span>c<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">case</span> _ <span class="token keyword">=&gt;</span> None
      <span class="token punctuation">}</span>

    encoded
      <span class="token punctuation">.</span>flatMap<span class="token punctuation">(</span>bit <span class="token keyword">=&gt;</span> <span class="token punctuation">{</span>
        chooseTreeBranch<span class="token punctuation">(</span>bit<span class="token punctuation">)</span>
        maybeGetACharacter
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">def</span> main<span class="token punctuation">(</span>args<span class="token operator">:</span> Array<span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Unit</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token keyword">val</span> originalText <span class="token operator">=</span> <span class="token string">&quot;bibbity_bobbity&quot;</span>
    println<span class="token punctuation">(</span><span class="token string">&quot;Original Text: &quot;</span> <span class="token operator">+</span> originalText<span class="token punctuation">)</span>

    <span class="token keyword">val</span> tree <span class="token operator">=</span> createTree<span class="token punctuation">(</span>originalText<span class="token punctuation">)</span>
    <span class="token keyword">val</span> codeBook <span class="token operator">=</span> createCodeBook<span class="token punctuation">(</span>tree<span class="token punctuation">)</span>
    println<span class="token punctuation">(</span><span class="token string">&quot;CodeBook is: &quot;</span> <span class="token operator">+</span> codeBook<span class="token punctuation">)</span>

    <span class="token keyword">val</span> encoded <span class="token operator">=</span> encode<span class="token punctuation">(</span>originalText<span class="token punctuation">,</span> codeBook<span class="token punctuation">)</span>
    println<span class="token punctuation">(</span><span class="token string">&quot;Encoded text: &quot;</span> <span class="token operator">+</span> encoded<span class="token punctuation">)</span>

    <span class="token keyword">val</span> decoded <span class="token operator">=</span> decode<span class="token punctuation">(</span>encoded<span class="token punctuation">,</span> tree<span class="token punctuation">)</span>
    println<span class="token punctuation">(</span><span class="token string">&quot;Decoded text: &quot;</span> <span class="token operator">+</span> decoded<span class="token punctuation">)</span>

  <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre>
</div><div class="code-method-sample" data-lang="scratch" data-name="Scratch"><p>The code snippet was taken from this <a href="https://scratch.mit.edu/projects/389604255/" target="_blank">scratch project</a></p>
<p>
    <img class="center" src="code/scratch/huffman.svg" width="700">
</p></div><div class="code-method-sample" data-lang="coco" data-name="Coconut"><pre class="language-"><code class="lang-coconut">from collections import Counter, deque
from bisect import bisect

class Tree

data Empty() from Tree
data Leaf(char, int(n)) from Tree:
    def __str__(self):
        return f&apos;Leaf({self.char}, {self.n})&apos;

    __repr__ = __str__

data Node(Tree(left), Tree(right)) from Tree:
    def __str__(self):
        return f&apos;Node({str(self.left)}, {str(self.right)})&apos;
    __repr__ = __str__

def weight(Tree()) = 0
addpattern def weight(Leaf(char, n)) = n
addpattern def weight(Node(left, right)) = weight(left) + weight(right)

def build_huffman_tree(message):

    # get sorted list of character and frequency pairs
    frequencies = Counter(message)
    trees = frequencies.most_common() |&gt; map$(t -&gt; Leaf(*t)) |&gt; reversed |&gt; deque

    if not trees:
        return Empty()

    # while there is more than one tree
    while len(trees) &gt; 1:

        # pop off the two trees of least weight from the trees list
        tree_left = trees.popleft()
        tree_right = trees.popleft()

        # combine the nodes and add back to the nodes list
        new_tree = Node(tree_left, tree_right)

        # find the first tree that has a weight smaller than new_weight
        # and returns its index in the list.
        # If no such tree can be found, use len(trees) instead to append
        index = bisect(trees |&gt; map$(weight) |&gt; list, weight(new_tree))

        # insert the new tree there
        trees.insert(index, new_tree)

    huffman_tree = trees[0]
    return huffman_tree


def build_codebook(Empty(), code=&apos;&apos;) = []
addpattern def build_codebook(Leaf(char, n), code=&apos;&apos;) = [(char, code)]
addpattern def build_codebook(Node(left, right), code=&apos;&apos;) =
    build_codebook(left, code+&apos;0&apos;) + build_codebook(right, code+&apos;1&apos;)

def huffman_encode(codebook, message):

    if len(codebook) == 1:
        return &apos;0&apos; * len(message)

    # build a char -&gt; code dictionary
    forward_dict = dict(codebook)

    return &apos;&apos;.join(message |&gt; map$(forward_dict[]))

def huffman_decode(codebook, encoded_message):

    decoded_message = []
    key = &apos;&apos;

    if not codebook:
        return &apos;&apos;
    elif len(codebook) == 1:
        return codebook[0][0] * len(encoded_message)

    # build a code -&gt; char dictionary
    inverse_dict = dict((v, k) for k, v in codebook)

    # for each bit in the encoding
    # if the bit is in the dictionary, replace the bit with the paired
    # character else look at the bit and the following bits together
    # until a match occurs move to the next bit not yet looked at.
    if encoded_message == &apos;&apos;:
        return inverse_dict[&apos;&apos;]

    for bit in encoded_message:
        key += bit
        if key in inverse_dict:
            decoded_message.append(inverse_dict[key])
            key = &apos;&apos;

    return &apos;&apos;.join(decoded_message)


if __name__ == &apos;__main__&apos;:
    # test example
    message = &apos;bibbity_bobbity&apos;
    tree = build_huffman_tree(message)
    codebook = build_codebook(tree)
    encoded_message = huffman_encode(codebook, message)
    decoded_message = huffman_decode(codebook, encoded_message)

    print(&apos;message:&apos;, message)
    print(&apos;huffman tree:&apos;, tree)
    print(&apos;codebook:&apos;, codebook)
    print(&apos;encoded message:&apos;, encoded_message)
    print(&apos;decoded message:&apos;, decoded_message)

    # prints the following:
    #
    #  message: bibbity_bobbity
    #  huffman_tree: Node(Leaf(b, 6), Node(Node(Leaf(y, 2), Leaf(t, 2)),
    #                     Node(Node(Leaf(o, 1), Leaf(_, 1)), Leaf(i, 3))))
    #  codebook: [(&apos;b&apos;, &apos;0&apos;), (&apos;y&apos;, &apos;100&apos;), (&apos;t&apos;, &apos;101&apos;),
    #             (&apos;o&apos;, &apos;1100&apos;), (&apos;_&apos;, &apos;1101&apos;), (&apos;i&apos;, &apos;111&apos;)]
    #  encoded_message: 01110011110110011010110000111101100
    #  decoded_message: bibbity_bobbity
</code></pre>
</div></div></div>

<script>
MathJax.Hub.Queue(["Typeset",MathJax.Hub]);
</script>

<h2 id="license">License</h2>
<h5 id="code-examples">Code Examples</h5>
<p>The code examples are licensed under the MIT license (found in <a href="https://github.com/algorithm-archivists/algorithm-archive/blob/main/LICENSE.md" target="_blank">LICENSE.md</a>).</p>
<h5 id="text">Text</h5>
<p>The text of this chapter was written by <a href="https://github.com/leios" target="_blank">James Schloss</a> and is licensed under the <a href="https://creativecommons.org/licenses/by-sa/4.0/legalcode" target="_blank">Creative Commons Attribution-ShareAlike 4.0 International License</a>.</p>
<p><a href="https://creativecommons.org/licenses/by-sa/4.0/" target="_blank"><p><img class="center" src="../cc/CC-BY-SA_icon.svg"></p></a></p>
<h5 id="imagesgraphics">Images/Graphics</h5>
<ul>
<li>The image &quot;<a href="res/huffman_tree.png">huffman_tree</a>&quot; was created by <a href="https://github.com/julianschacher" target="_blank">Julian Schacher</a> and is licensed under the <a href="https://creativecommons.org/licenses/by-sa/4.0/legalcode" target="_blank">Creative Commons Attribution-ShareAlike 4.0 International License</a>.</li>
</ul>
<h5 id="pull-requests">Pull Requests</h5>
<p>After initial licensing (<a href="https://github.com/algorithm-archivists/algorithm-archive/pull/560" target="_blank">#560</a>), the following pull requests have modified the text or graphics of this chapter:</p>
<ul>
<li>none</li>
</ul>

                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="../data_compression/data_compression.html" class="navigation navigation-prev " aria-label="Previous page: Data Compression">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
                <a href="../computer_graphics/computer_graphics.html" class="navigation navigation-next " aria-label="Next page: Computer Graphics">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"Huffman Encoding","level":"1.15.1","depth":2,"next":{"title":"Computer Graphics","level":"1.16","depth":1,"path":"contents/computer_graphics/computer_graphics.md","ref":"contents/computer_graphics/computer_graphics.md","articles":[{"title":"Flood Fill","level":"1.16.1","depth":2,"path":"contents/flood_fill/flood_fill.md","ref":"contents/flood_fill/flood_fill.md","articles":[]}]},"previous":{"title":"Data Compression","level":"1.15","depth":1,"path":"contents/data_compression/data_compression.md","ref":"contents/data_compression/data_compression.md","articles":[{"title":"Huffman Encoding","level":"1.15.1","depth":2,"path":"contents/huffman_encoding/huffman_encoding.md","ref":"contents/huffman_encoding/huffman_encoding.md","articles":[]}]},"dir":"ltr"},"config":{"plugins":["mathjax@https://github.com/algorithm-archivists/plugin-mathjax","bibtex-cite","wordcount","api-language-selector@https://github.com/algorithm-archivists/gitbook-plugin-api-language-selector.git","include-codeblock","bulk-redirect","prism","-highlight"],"root":"./","styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"pluginsConfig":{"api-language-selector":{"languages":[{"lang":"jl","name":"Julia","default":true},{"lang":"bash","name":"Bash"},{"lang":"cs","name":"C#"},{"lang":"cpp","name":"C++"},{"lang":"c","name":"C"},{"lang":"c8","name":"chip-8"},{"lang":"py","name":"Python"},{"lang":"js","name":"JavaScript"},{"lang":"scratch","name":"Scratch"},{"lang":"hs","name":"Haskell"},{"lang":"rs","name":"Rust"},{"lang":"ml","name":"OCaml"},{"lang":"java","name":"Java"},{"lang":"clj","name":"Clojure"},{"lang":"elm","name":"Elm"},{"lang":"LabVIEW","name":"LabVIEW"},{"lang":"d","name":"D"},{"lang":"go","name":"Go"},{"lang":"swift","name":"Swift"},{"lang":"racket","name":"Racket"},{"lang":"m","name":"Matlab"},{"lang":"r","name":"R"},{"lang":"ti83b","name":"TI-83 Basic"},{"lang":"lua","name":"Lua"},{"lang":"crystal","name":"Crystal"},{"lang":"php","name":"PHP"},{"lang":"lisp","name":"Common Lisp"},{"lang":"nim","name":"Nim"},{"lang":"asm-x64","name":"X86-64 Assembly"},{"lang":"f90","name":"Fortran90"},{"lang":"factor","name":"Factor"},{"lang":"ws","name":"Whitespace"},{"lang":"scala","name":"Scala"},{"lang":"emojic","name":"Emojicode"},{"lang":"lolcode","name":"LOLCODE"},{"lang":"piet","name":"Piet"},{"lang":"ss","name":"Scheme"},{"lang":"ps1","name":"PowerShell"},{"lang":"v","name":"Vlang"},{"lang":"coffee","name":"CoffeeScript"},{"lang":"kotlin","name":"Kotlin"},{"lang":"ts","name":"TypeScript"},{"lang":"vim","name":"VimL"},{"lang":"coco","name":"Coconut"},{"lang":"dart","name":"Dart"}]},"prism":{"lang":{"asm-x64":"nasm"},"ignore":["emojicode","text"],"css":["prismjs/themes/prism-tomorrow.css"]},"wordcount":{},"search":{},"lunr":{"maxIndexSize":1000000,"ignoreSpecialCharacters":false},"fontsettings":{"theme":"white","family":"sans","size":2},"bulk-redirect":{"basepath":"/","redirectsFile":"redirects.json"},"bibtex-cite":{},"mathjax":{"forceSVG":false,"version":"2.6.1"},"include-codeblock":{"check":false,"edit":false,"lang":"","fixlang":true,"template":"default","theme":"chrome","unindent":true},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false}},"theme":"default","lunr":{"maxIndexSize":1000000000},"honkit":">= 3.0.0","pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56},"embedFonts":false},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"bibCount":0,"variables":{},"title":"Arcane Algorithm Archive","bib":[{"citationKey":"CT1965","entryType":"ARTICLE","entryTags":{"TITLE":"An algorithm for the machine calculation of complex Fourier series","AUTHOR":"Cooley, James W and Tukey, John W","JOURNAL":"Mathematics of computation","VOLUME":"19","NUMBER":"90","PAGES":"297--301","YEAR":"1965","PUBLISHER":"JSTOR"}},{"citationKey":"JM1973","entryType":"ARTICLE","entryTags":{"TITLE":"On the identification of the convex hull of a finite set of points in the plane","AUTHOR":"Jarvis, Ray A","JOURNAL":"Information processing letters","VOLUME":"2","NUMBER":"1","PAGES":"18--21","YEAR":"1973","PUBLISHER":"Elsevier"}},{"citationKey":"GS1972","entryType":"ARTICLE","entryTags":{"TITLE":"An efficient algorithm for determining the convex hull of a finite planar set","AUTHOR":"Graham, Ronald L","JOURNAL":"Information processing letters","VOLUME":"1","NUMBER":"4","PAGES":"132--133","YEAR":"1972","PUBLISHER":"Elsevier"}},{"citationKey":"GNUPLOT","entryType":"MISC","entryTags":{"TITLE":"Gnuplot 5.0: An Interactive Plotting Program, Official Gnuplot Documentation","AUTHOR":"Williams, T and Kelley, C","YEAR":"2015"}},{"citationKey":"BEDE725","entryType":"BOOK","entryTags":{"TITLE":"Bede, the Reckoning of Time","AUTHOR":"Venerabilis, Beda and others","VOLUME":"29","YEAR":"1999","PUBLISHER":"Liverpool University Press"}},{"citationKey":"DICTCOMPUTUS","entryType":"MISC","entryTags":{"TITLE":"Dictionary.com definition of computus","URL":"https://www.merriam-webster.com/dictionary/computus","YEAR":"2020"}},{"citationKey":"COMPUTUS1876","entryType":"ARTICLE","entryTags":{"TITLE":"To find Easter: a new York correspondent sends us the following","AUTHOR":"unknown","JOURNAL":"Nature","YEAR":"1876"}},{"citationKey":"BIEN2004","entryType":"ARTICLE","entryTags":{"TITLE":"Gauss and beyond: The making of Easter algorithms","AUTHOR":"Bien, Reinhold","JOURNAL":"Archive for history of exact sciences","VOLUME":"58","NUMBER":"5","PAGES":"439--452","YEAR":"2004","PUBLISHER":"Springer"}},{"citationKey":"SERVOIS","entryType":"INPROCEEDINGS","entryTags":{"TITLE":"84 Calendrier","AUTHOR":"Servois, M","BOOKTITLE":"Annales de MathÃ©matiques pures et appliquÃ©es","VOLUME":"4","NUMBER":"1813-1814","PAGES":"84--90"}},{"citationKey":"STANDISH2004","entryType":"ARTICLE","entryTags":{"TITLE":"The astronomical unit now","AUTHOR":"Standish, EM","JOURNAL":"Proceedings of the International Astronomical Union","VOLUME":"2004","NUMBER":"IAUC196","PAGES":"163--179","YEAR":"2004","PUBLISHER":"Cambridge University Press"}},{"citationKey":"LUNAR_MONTH_WIKI","entryType":"MISC","entryTags":{"TITLE":"Wikipedia: Lunar Month","URL":"https://en.wikipedia.org/wiki/Lunar_month","YEAR":"2020"}},{"citationKey":"SELF-SIMILAR","entryType":"MISC","entryTags":{"TITLE":"Wikipedia: Self-similarity","URL":"https://en.wikipedia.org/wiki/Self-similarity","YEAR":"2019"}},{"citationKey":"HAUSDORFF","entryType":"MISC","entryTags":{"TITLE":"Wikipedia: Hausdorff dimension","URL":"https://en.wikipedia.org/wiki/Hausdorff_dimension","YEAR":"2019"}},{"citationKey":"3B1BFRACTAL","entryType":"MISC","entryTags":{"AUTHOR":"Sanderson, G","TITLE":"3blue1brown: Fractals are typically not self-similar","URL":"https://www.youtube.com/watch?v=gB9n2gHsHN4","YEAR":"2017"}},{"citationKey":"MANDELBROT1983FRACTAL","entryType":"BOOK","entryTags":{"TITLE":"The fractal geometry of nature","AUTHOR":"Mandelbrot, Benoit B","VOLUME":"173","YEAR":"1983","PUBLISHER":"WH freeman New York"}},{"citationKey":"MANDELBROT1967LONG","entryType":"ARTICLE","entryTags":{"TITLE":"How long is the coast of Britain? Statistical self-similarity and fractional dimension","AUTHOR":"Mandelbrot, Benoit","JOURNAL":"science","VOLUME":"156","NUMBER":"3775","PAGES":"636--638","YEAR":"1967","PUBLISHER":"American Association for the Advancement of Science"}},{"citationKey":"JAMPOUR2010NEW","entryType":"ARTICLE","entryTags":{"TITLE":"A new fast technique for fingerprint identification with fractal and chaos game theory","AUTHOR":"Jampour, Mahdi and Yaghoobi, Mahdi and Ashourzadeh, Maryam and Soleimani, Adel","JOURNAL":"Fractals","VOLUME":"18","NUMBER":"03","PAGES":"293--300","YEAR":"2010","PUBLISHER":"World Scientific"}},{"citationKey":"FRACTAL-COMPRESSION","entryType":"MISC","entryTags":{"TITLE":"Wikipedia: Fractal Compression","URL":"https://en.wikipedia.org/wiki/Fractal_compression","YEAR":"2019"}},{"citationKey":"SAUPE1994REVIEW","entryType":"ARTICLE","entryTags":{"TITLE":"A review of the fractal image compression literature","AUTHOR":"Saupe, Dietmar and Hamzaoui, Raouf","JOURNAL":"ACM SIGGRAPH Computer Graphics","VOLUME":"28","NUMBER":"4","PAGES":"268--276","YEAR":"1994","PUBLISHER":"ACM"}},{"citationKey":"GNEITING2012ESTIMATORS","entryType":"ARTICLE","entryTags":{"TITLE":"Estimators of fractal dimension: Assessing the roughness of time series and spatial data","AUTHOR":"Gneiting, Tilmann and Å evÄÃ­kovÃ¡, Hana and Percival, Donald B","JOURNAL":"Statistical Science","PAGES":"247--277","YEAR":"2012","PUBLISHER":"JSTOR"}},{"citationKey":"HUTCHINSON1981FRACTALS","entryType":"ARTICLE","entryTags":{"TITLE":"Fractals and self similarity","AUTHOR":"Hutchinson, John E","JOURNAL":"Indiana University Mathematics Journal","VOLUME":"30","NUMBER":"5","PAGES":"713--747","YEAR":"1981","PUBLISHER":"JSTOR"}},{"citationKey":"HUTCHINSON-OPERATOR","entryType":"MISC","entryTags":{"TITLE":"Wikipedia: Hutchinson Operator","URL":"https://en.wikipedia.org/wiki/Hutchinson_operator","YEAR":"2019"}},{"citationKey":"CHAOS-GAME","entryType":"MISC","entryTags":{"TITLE":"Wikipedia: Chaos Game","URL":"https://en.wikipedia.org/wiki/Chaos_game","YEAR":"2019"}},{"citationKey":"CHAOS-GAME-WOLF","entryType":"MISC","entryTags":{"TITLE":"Wolfram: Chaos Game","URL":"http://mathworld.wolfram.com/ChaosGame.html","YEAR":"2019"}},{"citationKey":"BARNSLEY2014FRACTALS","entryType":"BOOK","entryTags":{"TITLE":"Fractals everywhere","AUTHOR":"Barnsley, Michael F","YEAR":"2014","PUBLISHER":"Academic press"}},{"citationKey":"HSV","entryType":"MISC","entryTags":{"TITLE":"Wikipedia: HSL and HSV","URL":"https://en.wikipedia.org/wiki/HSL_and_HSV","YEAR":"2020"}},{"citationKey":"SCHLOSS2019","entryType":"ARTICLE","entryTags":{"TITLE":"Massively parallel split-step Fourier techniques for simulating quantum systems on graphics processing units","AUTHOR":"Schloss, James","YEAR":"2019"}},{"citationKey":"PETHICK2008","entryType":"BOOK","entryTags":{"TITLE":"Bose--Einstein condensation in dilute gases","AUTHOR":"Pethick, Christopher J and Smith, Henrik","YEAR":"2008","PUBLISHER":"Cambridge university press"}},{"citationKey":"WEGERT2012","entryType":"BOOK","entryTags":{"TITLE":"Visual complex functions: an introduction with phase portraits","AUTHOR":"Wegert, Elias","YEAR":"2012","PUBLISHER":"Springer Science \\& Business Media"}},{"citationKey":"POELKEDOMAIN","entryType":"ARTICLE","entryTags":{"TITLE":"Domain Coloring of Complex Functions","AUTHOR":"Poelke, Konstantin and Polthier, Konrad"}},{"citationKey":"LUNDMARK2004","entryType":"ARTICLE","entryTags":{"TITLE":"Visualizing complex analytic functions using domain coloring","AUTHOR":"Lundmark, Hans","JOURNAL":"Recuperado el","VOLUME":"24","YEAR":"2004"}},{"citationKey":"GIMP_BUCKET","entryType":"MISC","entryTags":{"TITLE":"Bucket Fill in Gimp","URL":"https://docs.gimp.org/2.10/en/gimp-tool-bucket-fill.html","YEAR":"2020"}},{"citationKey":"TORBERT2016","entryType":"BOOK","entryTags":{"TITLE":"Applied computer science","AUTHOR":"Torbert, Shane","YEAR":"2016","PAGES":"158","PUBLISHER":"Springer"}},{"citationKey":"CANNY1986COMPUTATIONAL","entryType":"ARTICLE","entryTags":{"TITLE":"A computational approach to edge detection","AUTHOR":"Canny, John","JOURNAL":"IEEE Transactions on pattern analysis and machine intelligence","NUMBER":"6","PAGES":"679--698","YEAR":"1986","PUBLISHER":"Ieee"}},{"citationKey":"MORRIS1978COUNTING","entryType":"ARTICLE","entryTags":{"TITLE":"Counting large numbers of events in small registers","AUTHOR":"Morris, R","JOURNAL":"Communications of the ACM","VOLUME":"21","NUMBER":"10","PAGES":"840--842","YEAR":"1978","PUBLISHER":"ACM New York, NY, USA"}},{"citationKey":"FLAJOLET1985APPROXIMATE","entryType":"ARTICLE","entryTags":{"TITLE":"Approximate counting: a detailed analysis","AUTHOR":"Flajolet, P","JOURNAL":"BIT Numerical Mathematics","VOLUME":"25","NUMBER":"1","PAGES":"113--134","YEAR":"1985","PUBLISHER":"Springer"}},{"citationKey":"ARPIT_COUNTING","entryType":"MISC","entryTags":{"TITLE":"Morris's Algorithm for Approximate Counting","AUTHOR":"Bhayani, A","URL":"https://arpitbhayani.me/blogs/morris-counter","YEAR":"2020"}},{"citationKey":"GREGGUNDERSON_COUNTING","entryType":"MISC","entryTags":{"TITLE":"Approximate Counting with Morris's Algorithm","AUTHOR":"Gundersen, G","URL":"http://gregorygundersen.com/blog/2019/11/11/morris-algorithm/","YEAR":"2019"}},{"citationKey":"3B1B_FINGER_COUNT","entryType":"MISC","entryTags":{"TITLE":"How to count to 1000 on two hands","AUTHOR":"Sanderson, G","URL":"https://youtu.be/1SMmc9gQmHQ","YEAR":"2015"}},{"citationKey":"METROPOLIS1953EQUATION","entryType":"ARTICLE","entryTags":{"PAGES":"1087-1092","EPRINT":"https://doi.org/10.1063/1.1699114\n    \n","NUMBER":"6","AUTHOR":"Metropolis,Nicholas  and Rosenbluth,Arianna W.  and Rosenbluth,Marshall N.  and Teller,Augusta H.  and Teller,Edward ","URL":"https://doi.org/10.1063/1.1699114\n    \n","JOURNAL":"The Journal of Chemical Physics","TITLE":"Equation of State Calculations by Fast Computing Machines","VOLUME":"21","YEAR":"1953","DOI":"10.1063/1.1699114"}},{"citationKey":"ROSENTHAL2011OPTIMAL","entryType":"ARTICLE","entryTags":{"TITLE":"Optimal proposal distributions and adaptive MCMC","AUTHOR":"Rosenthal, Jeffrey S and others","JOURNAL":"Handbook of Markov Chain Monte Carlo","VOLUME":"4","NUMBER":"10.1201","YEAR":"2011","PUBLISHER":"Chapman & Hall/CRC Boca Raton, FL"}},{"citationKey":"GARETH2001OPTIMAL","entryType":"ARTICLE","entryTags":{"PAGES":"351 -- 367","NUMBER":"4","AUTHOR":"Gareth O. Roberts and Jeffrey S. Rosenthal","URL":"https://doi.org/10.1214/ss/1015346320","JOURNAL":"Statistical Science","TITLE":"Optimal scaling for various Metropolis-Hastings algorithms","VOLUME":"16","PUBLISHER":"Institute of Mathematical Statistics","YEAR":"2001","DOI":"10.1214/ss/1015346320"}},{"citationKey":"POTENTIAL_ENERGY_WIKI","entryType":"MISC","entryTags":{"TITLE":"Wikipedia: Potential Energy","URL":"https://en.wikipedia.org/wiki/Potential_energy","YEAR":"2021"}},{"citationKey":"LUDWIG_BOLTZMANN_WIKI","entryType":"MISC","entryTags":{"TITLE":"Wikipedia: Ludwig Boltzmann","URL":"https://en.wikipedia.org/wiki/Ludwig_Boltzmann","YEAR":"2021"}},{"citationKey":"BOLTZMANN_DISTRIBUTION_WIKI","entryType":"MISC","entryTags":{"TITLE":"Wikipedia: Boltzmann distribution","URL":"https://en.wikipedia.org/wiki/Boltzmann_distribution","YEAR":"2021"}},{"citationKey":"HASTINGS1970MONTE","entryType":"ARTICLE","entryTags":{"MONTH":"04","ABSTRACT":"{A generalization of the sampling method introduced by Metropolis et al. (1953) is presented along with an exposition of the relevant theory, techniques of application and methods and difficulties of assessing the error in Monte Carlo estimates. Examples of the methods, including the generation of random orthogonal matrices and potential applications of the methods to numerical problems arising in statistics, are discussed.}","PAGES":"97-109","ISSN":"0006-3444","EPRINT":"https://academic.oup.com/biomet/article-pdf/57/1/97/23940249/57-1-97.pdf","NUMBER":"1","AUTHOR":"Hastings, W. K.","URL":"https://doi.org/10.1093/biomet/57.1.97","JOURNAL":"Biometrika","TITLE":"Monte Carlo sampling methods using Markov chains and their applications","VOLUME":"57","YEAR":"1970","DOI":"10.1093/biomet/57.1.97"}},{"citationKey":"MALA_WIKI","entryType":"MISC","entryTags":{"TITLE":"Wikipedia: Metropolis-adjusted Langevin Algorithm","URL":"https://en.wikipedia.org/wiki/Metropolis-adjusted_Langevin_algorithm","YEAR":"2021"}},{"citationKey":"HMC_WIKI","entryType":"MISC","entryTags":{"TITLE":"Wikipedia: Hamiltonian Monte Carlo","URL":"https://en.wikipedia.org/wiki/Hamiltonian_Monte_Carlo","YEAR":"2021"}},{"citationKey":"RMSD_WIKI","entryType":"MISC","entryTags":{"TITLE":"Wikipedia: Root Mean Square Deviation","URL":"https://en.wikipedia.org/wiki/Root-mean-square_deviation","YEAR":"2021"}},{"citationKey":"CEASAR_CIPHER_WIKI","entryType":"MISC","entryTags":{"TITLE":"Wikipedia: Ceasar Cipher","URL":"https://en.wikipedia.org/wiki/Caesar_cipher","YEAR":"2022"}},{"citationKey":"POST-QUANTUM_CRYPTO_WIKI","entryType":"MISC","entryTags":{"TITLE":"Wikipedia: Post-quantum Cryptography","URL":"https://en.wikipedia.org/wiki/Post-quantum_cryptography","YEAR":"2022"}},{"citationKey":"KERCKHOFFS_PRINCIPLE_WIKI","entryType":"MISC","entryTags":{"TITLE":"Wikipedia: Kerckhoffs's principle","URL":"https://en.wikipedia.org/wiki/Kerckhoffs%27s_principle","YEAR":"2022"}},{"citationKey":"ROT13_WIKI","entryType":"MISC","entryTags":{"TITLE":"Wikipedia: ROT13","URL":"https://en.wikipedia.org/wiki/ROT13","YEAR":"2022"}},{"citationKey":"CC_PERMUTATION","entryType":"MISC","entryTags":{"TITLE":"Crypto Corner: Permutation Cipher","URL":"https://crypto.interactive-maths.com/permutation-cipher.html","YEAR":"2022"}},{"citationKey":"XOR_CIPHER_WIKI","entryType":"MISC","entryTags":{"TITLE":"Wikipedia: XOR cipher","URL":"https://en.wikipedia.org/wiki/XOR_cipher","YEAR":"2022"}},{"citationKey":"DES_WIKI","entryType":"MISC","entryTags":{"TITLE":"Wikipedia: Data Encryption Standard","URL":"https://en.wikipedia.org/wiki/Data_Encryption_Standard","YEAR":"2022"}},{"citationKey":"AES_WIKI","entryType":"MISC","entryTags":{"TITLE":"Wikipedia: Advanced Encryption Standard","URL":"https://en.wikipedia.org/wiki/Advanced_Encryption_Standard","YEAR":"2022"}},{"citationKey":"BLOWFISH_CIPHER_WIKI","entryType":"MISC","entryTags":{"TITLE":"Wikipedia: Blowfish (cipher)","URL":"https://en.wikipedia.org/wiki/Blowfish_(cipher)","YEAR":"2022"}},{"citationKey":"RSA_WIKI","entryType":"MISC","entryTags":{"TITLE":"Wikipedia: RSA (cryptosystem)","URL":"https://en.wikipedia.org/wiki/RSA_(cryptosystem)","YEAR":"2022"}},{"citationKey":"ECC_CRYPTO_WIKI","entryType":"MISC","entryTags":{"TITLE":"Wikipedia: Elliptic-curve cryptography","URL":"https://en.wikipedia.org/wiki/Elliptic-curve_cryptography","YEAR":"2022"}},{"citationKey":"BOX1958","entryType":"ARTICLE","entryTags":{"TITLE":"A note on the generation of random normal deviates","AUTHOR":"Box, George EP","JOURNAL":"Ann. Math. Statist.","VOLUME":"29","PAGES":"610--611","YEAR":"1958"}},{"citationKey":"MARSAGLIA_WIKI","entryType":"MISC","entryTags":{"TITLE":"Wikipedia: Marsaglia Transform","URL":"https://en.wikipedia.org/wiki/Marsaglia_polar_method","YEAR":"2022"}},{"citationKey":"BOX_MULLER_WIKI","entryType":"MISC","entryTags":{"TITLE":"Wikipedia: Box-Muller Transform","URL":"https://en.wikipedia.org/wiki/Box%E2%80%93Muller_transform","YEAR":"2022"}}],"gitbook":"*"},"file":{"path":"contents/huffman_encoding/huffman_encoding.md","mtime":"2023-10-31T21:24:44.486Z","type":"markdown"},"gitbook":{"version":"3.7.5","time":"2023-10-31T21:25:10.327Z"},"basePath":"../..","book":{"language":""}});
        });
    </script>
</div>

        
    <noscript>
        <style>
            .honkit-cloak {
                display: block !important;
            }
        </style>
    </noscript>
    <script>
        // Restore sidebar state as critical path for prevent layout shift
        function __init__getSidebarState(defaultValue){
            var baseKey = "";
            var key = baseKey + ":sidebar";
            try {
                var value = localStorage[key];
                if (value === undefined) {
                    return defaultValue;
                }
                var parsed = JSON.parse(value);
                return parsed == null ? defaultValue : parsed;
            } catch (e) {
                return defaultValue;
            }
        }
        function __init__restoreLastSidebarState() {
            var isMobile = window.matchMedia("(max-width: 600px)").matches;
            if (isMobile) {
                // Init last state if not mobile
                return;
            }
            var sidebarState = __init__getSidebarState(true);
            var book = document.querySelector(".book");
            // Show sidebar if it enabled
            if (sidebarState && book) {
                book.classList.add("without-animation", "with-summary");
            }
        }

        try {
            __init__restoreLastSidebarState();
        } finally {
            var book = document.querySelector(".book");
            book.classList.remove("honkit-cloak");
        }
    </script>
    <script src="../../gitbook/gitbook.js"></script>
    <script src="../../gitbook/theme.js"></script>
    
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.6.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-mathjax/plugin.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-api-language-selector/api-language-selector.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-search/search-engine.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-search/search.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

    </body>
</html>

